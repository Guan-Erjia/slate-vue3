import{i as S,j,k as b,p as W,q as L,d as N,o as m,c as y,g as H,F as w,x as q,e as R,y as I,z as D,b as E,t as X,m as T,_ as Z,f as F,w as C,h as v,a as i,l as G,v as J,u as Q,s as O,n as ee}from"./index-cO_khfoC.js";import{u as U,w as te,c as oe,N as ae,T as re,S as se,b as ne}from"./editable-OBw7MXqz.js";import{w as ie,a as le,Y as K,c as ce,g as ue,b as de}from"./index-FzwapiRn.js";import{C as P,u as fe,g as z,a as pe,w as me}from"./utils-CDy_PNCt.js";import{T as ve}from"./Toolbar-DItQkW23.js";import{_ as k,a as h}from"./BlockButton.vue_vue_type_script_setup_true_lang-HG5hzToY.js";import{f as M}from"./chunk-MVUZLZE2-BVB7fs3M.js";import"./Button-Bz1s__lT.js";const B=new WeakMap;function he(){const f=U(),c=b({}),n=new Set,r=n.add.bind(n),u=a=>{if(a.added.forEach(r),a.removed.forEach(r),a.updated.forEach(r),n.size===0)return c;n.forEach(s=>{const o=P.cursorState(f,s);if(o===null){delete c.value[s.toString()];return}c.value[s]=o}),n.clear()},t=()=>P.on(f,"change",u),d=()=>P.off(f,"change",u),e=B.get(f);return e||(S(()=>{t()}),j(()=>{d()}),B.set(f,c),c)}const V=Object.freeze([]);function ye(f,c){const n=U(),r=he(),u=b(new WeakMap),t=b({}),d=()=>{if(!f.value)return;const s=f.value.getBoundingClientRect(),o=s?.x??0,_=s?.y??0;let l=Object.keys(t.value).length!==Object.keys(r.value).length;const p=Object.fromEntries(Object.entries(r.value).map(([g,Y])=>{const x=Y.selection&&z(n,Y);if(!x)return[g,V];const A=u.value.get(x);if(A)return[g,A];const $=pe(n,x,{xOffset:o,yOffset:_,shouldGenerateOverlay:c});return l=!0,u.value.set(x,$),[g,$]}));l&&(t.value=p)},e=()=>{u.value=new WeakMap,d()};return fe(f,e),W(d),[L(()=>Object.entries(r.value).map(([s,o])=>{const _=o.selection&&z(n,o),l=t.value[s];return{...o,range:_,caretPosition:l?.caretPosition??null,selectionRects:l?.selectionRects??V}})),e]}const _e={ref:"overlay",style:{position:"relative"}},ge={class:"label"},be=N({__name:"RemoteOverlay",setup(f){const c=I("overlay"),[n]=ye(c);return(r,u)=>(m(),y("div",_e,[H(r.$slots,"default",{},void 0,!0),(m(!0),y(w,null,q(R(n),(t,d)=>(m(),y(w,{key:d},[(m(!0),y(w,null,q(t.selectionRects,(e,a)=>(m(),y("div",{class:"selection",style:D({height:e.height+"px",top:e.top+"px",left:e.left+"px",width:e.width+"px"}),key:a},null,4))),128)),t.caretPosition&&t.data?(m(),y("div",{key:0,class:"cursor",style:D({height:t.caretPosition.height+"px",top:t.caretPosition.top+"px",left:t.caretPosition.left+"px"})},[E("div",ge,X(t.data.name),1)],4)):T("",!0)],64))),128))],512))}}),xe=Z(be,[["__scopeId","data-v-8a1eb6b3"]]),ke=N({__name:"YjsEditor",props:{sharedType:{},provider:{}},setup(f){const c=[{type:"paragraph",children:[{text:""}]}],n=({attributes:e,children:a,element:s})=>{const o={...e,style:{"text-align":"align"in s?s.align||"left":""}};switch(s.type){case"block-quote":return v("blockquote",o,a);case"bulleted-list":return v("ul",o,a);case"heading-one":return v("h1",o,a);case"heading-two":return v("h2",o,a);case"heading-three":return v("h3",o,a);case"list-item":return v("li",o,a);case"numbered-list":return v("ol",o,a);default:return v("p",o,a)}},r=({leaf:e,attributes:a,children:s})=>{const o={};return"bold"in e&&(o.fontWeight="bold"),"italic"in e&&(o.fontStyle="italic"),"underline"in e&&(o.borderBottom="1px solid black"),"delete"in e&&(o.textDecoration="line-through"),v("code"in e?"code":"bold"in e?"strong":"span",{...a,style:o},s)},u=f,t=me(ie(le(te(oe()),u.sharedType)),u.provider.awareness,{data:{name:`${M.person.firstName()} ${M.person.lastName()}`}});t.children=c;const{normalizeNode:d}=t;return t.normalizeNode=e=>{const[a]=e;if(ae.isElement(a)&&a.children.length>0)return d(e);re.insertNodes(t,c[0],{at:[0]})},S(()=>{K.connect(t)}),j(()=>{K.disconnect(t)}),(e,a)=>(m(),F(R(se),{editor:R(t),"render-element":n,"render-leaf":r},{default:C(()=>[i(xe,null,{default:C(()=>[i(ve,null,{default:C(()=>[i(k,{format:"bold",icon:"format_bold"}),i(k,{format:"italic",icon:"format_italic"}),i(k,{format:"underline",icon:"format_underlined"}),i(k,{format:"code",icon:"code"}),i(h,{format:"heading-one",icon:"looks_one"}),i(h,{format:"heading-two",icon:"looks_two"}),i(h,{format:"block-quote",icon:"format_quote"}),i(h,{format:"numbered-list",icon:"format_list_numbered"}),i(h,{format:"bulleted-list",icon:"format_list_bulleted"}),i(h,{format:"left",icon:"format_align_left"}),i(h,{format:"center",icon:"format_align_center"}),i(h,{format:"right",icon:"format_align_right"}),i(h,{format:"justify",icon:"format_align_justify"})]),_:1}),i(R(ne),{placeholder:"Enter some rich textâ€¦",spellcheck:""})]),_:1})]),_:1},8,["editor"]))}}),we={style:{display:"flex",width:"100%"}},Re={key:1,style:{height:"300px"}},Ye=N({__name:"index",setup(f){const c=Q(),n=ee(),r=b(c.query.publicApiKey||""),u=O(),t=O(),d=O(),e=b(!1),a=l=>e.value=l,s=()=>{try{const l=ce({publicApiKey:r.value}).enterRoom("remote-cursor"),p=ue(l.room);p.on("sync",a),u.value=l,t.value=p,d.value=p.getYDoc().get("slate",de)}catch(l){alert(l),n.push({name:"remote-cursor",query:{publicApiKey:""}})}},o=()=>{u.value?.leave(),t.value?.off("sync",a),u.value=void 0,t.value=void 0,d.value=void 0,e.value=!1,r.value=""};S(()=>{r.value&&s()}),j(()=>{o()});const _=l=>{l.key==="Enter"&&(n.push({name:"remote-cursor",query:{publicApiKey:r.value}}),s())};return(l,p)=>(m(),y(w,null,[p[1]||(p[1]=E("a",{href:"https://liveblocks.io/dashboard",style:{"margin-bottom":"12px",display:"block"},target:"_blank"}," ðŸ‘‰ Click it and get a publicApiKey from liveblocks",-1)),E("div",we,[G(E("input",{"onUpdate:modelValue":p[0]||(p[0]=g=>r.value=g),onKeyup:_,placeholder:"paste your liveblocks publicApiKey, and press Enter to connect",style:{width:"100%","margin-bottom":"10px"}},null,544),[[J,r.value]])]),d.value&&e.value&&t.value?(m(),F(ke,{key:0,sharedType:d.value,provider:t.value},null,8,["sharedType","provider"])):T("",!0),d.value&&!e.value?(m(),y("div",Re,"Loading...")):T("",!0)],64))}});export{Ye as default};
