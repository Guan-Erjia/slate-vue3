import{i as _i,N as tt,P as rs,E as rr,L as Hu,T as Fu}from"./editable-OBw7MXqz.js";const Ot=()=>new Map,Si=e=>{const t=Ot();return e.forEach((n,s)=>{t.set(s,n)}),t},ve=(e,t,n)=>{let s=e.get(t);return s===void 0&&e.set(t,s=n()),s},ju=(e,t)=>{const n=[];for(const[s,r]of e)n.push(t(r,s));return n},Ku=(e,t)=>{for(const[n,s]of e)if(t(s,n))return!0;return!1},Ze=()=>new Set,Wr=e=>e[e.length-1],zu=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},be=Array.from,Ji=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},Zi=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},qu=(e,t)=>{const n=new Array(e);for(let s=0;s<e;s++)n[s]=t(s,n);return n},xn=Array.isArray;class ea{constructor(){this._observers=Ot()}on(t,n){return ve(this._observers,t,Ze).add(n),n}once(t,n){const s=(...r)=>{this.off(t,s),n(...r)};this.on(t,s)}off(t,n){const s=this._observers.get(t);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(t))}emit(t,n){return be((this._observers.get(t)||Ot()).values()).forEach(s=>s(...n))}destroy(){this._observers=Ot()}}let Wu=class{constructor(){this._observers=Ot()}on(t,n){ve(this._observers,t,Ze).add(n)}once(t,n){const s=(...r)=>{this.off(t,s),n(...r)};this.on(t,s)}off(t,n){const s=this._observers.get(t);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(t))}emit(t,n){return be((this._observers.get(t)||Ot()).values()).forEach(s=>s(...n))}destroy(){this._observers=Ot()}};const ne=Math.floor,Xs=Math.abs,na=(e,t)=>e<t?e:t,rn=(e,t)=>e>t?e:t,sa=e=>e!==0?e<0:1/e<0,qo=1,Wo=2,Gr=4,Yr=8,is=32,pe=64,Pt=128,_r=31,Ei=63,Ge=127,Gu=2147483647,ir=Number.MAX_SAFE_INTEGER,Go=Number.MIN_SAFE_INTEGER,Yu=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ne(e)===e),Ju=String.fromCharCode,Zu=e=>e.toLowerCase(),Xu=/^\s*/g,Qu=e=>e.replace(Xu,""),td=/([A-Z])/g,Yo=(e,t)=>Qu(e.replace(td,n=>`${t}${Zu(n)}`)),ed=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let r=0;r<n;r++)s[r]=t.codePointAt(r);return s},os=typeof TextEncoder<"u"?new TextEncoder:null,nd=e=>os.encode(e),sd=os?nd:ed;let ns=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ns&&ns.decode(new Uint8Array).length===1&&(ns=null);const rd=(e,t)=>qu(t,()=>e).join("");class Cs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ks=()=>new Cs,id=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Gt=e=>{const t=new Uint8Array(id(e));let n=0;for(let s=0;s<e.bufs.length;s++){const r=e.bufs[s];t.set(r,n),n+=r.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},od=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(rn(n,t)*2),e.cpos=0)},ft=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},cs=ft,H=(e,t)=>{for(;t>Ge;)ft(e,Pt|Ge&t),t=ne(t/128);ft(e,Ge&t)},Sr=(e,t)=>{const n=sa(t);for(n&&(t=-t),ft(e,(t>Ei?Pt:0)|(n?pe:0)|Ei&t),t=ne(t/64);t>0;)ft(e,(t>Ge?Pt:0)|Ge&t),t=ne(t/128)},vi=new Uint8Array(3e4),cd=vi.length/3,ad=(e,t)=>{if(t.length<cd){const n=os.encodeInto(t,vi).written||0;H(e,n);for(let s=0;s<n;s++)ft(e,vi[s])}else Rt(e,sd(t))},ld=(e,t)=>{const n=unescape(encodeURIComponent(t)),s=n.length;H(e,s);for(let r=0;r<s;r++)ft(e,n.codePointAt(r))},Ye=os&&os.encodeInto?ad:ld,Er=(e,t)=>{const n=e.cbuf.length,s=e.cpos,r=na(n-s,t.length),i=t.length-r;e.cbuf.set(t.subarray(0,r),s),e.cpos+=r,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(rn(n*2,i)),e.cbuf.set(t.subarray(r)),e.cpos=i)},Rt=(e,t)=>{H(e,t.byteLength),Er(e,t)},Xi=(e,t)=>{od(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},ud=(e,t)=>Xi(e,4).setFloat32(0,t,!1),dd=(e,t)=>Xi(e,8).setFloat64(0,t,!1),hd=(e,t)=>Xi(e,8).setBigInt64(0,t,!1),Jo=new DataView(new ArrayBuffer(4)),fd=e=>(Jo.setFloat32(0,e),Jo.getFloat32(0)===e),as=(e,t)=>{switch(typeof t){case"string":ft(e,119),Ye(e,t);break;case"number":Yu(t)&&Xs(t)<=Gu?(ft(e,125),Sr(e,t)):fd(t)?(ft(e,124),ud(e,t)):(ft(e,123),dd(e,t));break;case"bigint":ft(e,122),hd(e,t);break;case"object":if(t===null)ft(e,126);else if(xn(t)){ft(e,117),H(e,t.length);for(let n=0;n<t.length;n++)as(e,t[n])}else if(t instanceof Uint8Array)ft(e,116),Rt(e,t);else{ft(e,118);const n=Object.keys(t);H(e,n.length);for(let s=0;s<n.length;s++){const r=n[s];Ye(e,r),as(e,t[r])}}break;case"boolean":ft(e,t?120:121);break;default:ft(e,127)}};class Zo extends Cs{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&H(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Xo=e=>{e.count>0&&(Sr(e.encoder,e.count===1?e.s:-e.s),e.count>1&&H(e.encoder,e.count-2))};class Qs{constructor(){this.encoder=new Cs,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Xo(this),this.count=1,this.s=t)}toUint8Array(){return Xo(this),Gt(this.encoder)}}const Qo=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Sr(e.encoder,t),e.count>1&&H(e.encoder,e.count-2)}};class Jr{constructor(){this.encoder=new Cs,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Qo(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Qo(this),Gt(this.encoder)}}class pd{constructor(){this.sarr=[],this.s="",this.lensE=new Qs}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Cs;return this.sarr.push(this.s),this.s="",Ye(t,this.sarr.join("")),Er(t,this.lensE.toUint8Array()),Gt(t)}}const Zt=e=>new Error(e),Yt=()=>{throw Zt("Method unimplemented")},Dt=()=>{throw Zt("Unexpected case")},ra=Zt("Unexpected end of array"),ia=Zt("Integer out of Range");class vr{constructor(t){this.arr=t,this.pos=0}}const _e=e=>new vr(e),oa=e=>e.pos!==e.arr.length,gd=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Lt=e=>gd(e,B(e)),Rn=e=>e.arr[e.pos++],B=e=>{let t=0,n=1;const s=e.arr.length;for(;e.pos<s;){const r=e.arr[e.pos++];if(t=t+(r&Ge)*n,n*=128,r<Pt)return t;if(t>ir)throw ia}throw ra},Cr=e=>{let t=e.arr[e.pos++],n=t&Ei,s=64;const r=(t&pe)>0?-1:1;if((t&Pt)===0)return r*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&Ge)*s,s*=128,t<Pt)return r*n;if(n>ir)throw ia}throw ra},md=e=>{let t=B(e);if(t===0)return"";{let n=String.fromCodePoint(Rn(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Rn(e));else for(;t>0;){const s=t<1e4?t:1e4,r=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,r),t-=s}return decodeURIComponent(escape(n))}},yd=e=>ns.decode(Lt(e)),Je=ns?yd:md,Qi=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},wd=e=>Qi(e,4).getFloat32(0,!1),bd=e=>Qi(e,8).getFloat64(0,!1),_d=e=>Qi(e,8).getBigInt64(0,!1),Sd=[e=>{},e=>null,Cr,wd,bd,_d,e=>!1,e=>!0,Je,e=>{const t=B(e),n={};for(let s=0;s<t;s++){const r=Je(e);n[r]=ls(e)}return n},e=>{const t=B(e),n=[];for(let s=0;s<t;s++)n.push(ls(e));return n},Lt],ls=e=>Sd[127-Rn(e)](e);class tc extends vr{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),oa(this)?this.count=B(this)+1:this.count=-1),this.count--,this.s}}class tr extends vr{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Cr(this);const t=sa(this.s);this.count=1,t&&(this.s=-this.s,this.count=B(this)+2)}return this.count--,this.s}}class Zr extends vr{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Cr(this),n=t&1;this.diff=ne(t/2),this.count=1,n&&(this.count=B(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ed{constructor(t){this.decoder=new tr(t),this.str=Je(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const vd=crypto.getRandomValues.bind(crypto),ca=()=>vd(new Uint32Array(1))[0],Cd="10000000-1000-4000-8000"+-1e11,kd=()=>Cd.replace(/[018]/g,e=>(e^ca()&15>>e/4).toString(16)),Id=Date.now,Ln=e=>new Promise(e);Promise.all.bind(Promise);const ec=e=>e===void 0?null:e;class Ad{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let aa=new Ad,Td=!0;try{typeof localStorage<"u"&&localStorage&&(aa=localStorage,Td=!1)}catch{}const Od=aa,us=Symbol("Equality"),la=(e,t)=>e===t||!!e?.[us]?.(t)||!1,Dd=e=>typeof e=="object",xd=Object.assign,Rd=Object.keys,Ld=(e,t)=>{for(const n in e)t(e[n],n)},or=e=>Rd(e).length,Pd=e=>{for(const t in e)return!1;return!0},Is=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},to=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Nd=(e,t)=>e===t||or(e)===or(t)&&Is(e,(n,s)=>(n!==void 0||to(t,s))&&la(t[s],n)),Ud=Object.freeze,ua=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&ua(e[t])}return Ud(e)},eo=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&eo(e,t,n+1)}},Md=e=>e,er=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(e[us]!=null)return e[us](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!er(e.get(n),t.get(n)))return!1;break}case void 0:case Object:if(or(e)!==or(t))return!1;for(const n in e)if(!to(e,n)||!er(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!er(e[n],t[n]))return!1;break;default:return!1}return!0},$d=(e,t)=>t.includes(e);var da={};const ds=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let te;const Bd=()=>{if(te===void 0)if(ds){te=Ot();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const s=e[n];s[0]==="-"?(t!==null&&te.set(t,""),t=s):t!==null&&(te.set(t,s),t=null)}t!==null&&te.set(t,"")}else typeof location=="object"?(te=Ot(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");te.set(`--${Yo(t,"-")}`,n),te.set(`-${Yo(t,"-")}`,n)}})):te=Ot();return te},Ci=e=>Bd().has(e),cr=e=>ec(ds?da[e.toUpperCase().replaceAll("-","_")]:Od.getItem(e)),ha=e=>Ci("--"+e)||cr(e)!==null,Vd=ha("production"),Hd=ds&&$d(da.FORCE_COLOR,["true","1","2"]),Fd=Hd||!Ci("--no-colors")&&!ha("no-color")&&(!ds||process.stdout.isTTY)&&(!ds||Ci("--color")||cr("COLORTERM")!==null||(cr("TERM")||"").includes("color")),jd=e=>new Uint8Array(e),Kd=e=>{const t=jd(e.byteLength);return t.set(e),t};class zd{constructor(t,n){this.left=t,this.right=n}}const le=(e,t)=>new zd(e,t),nc=e=>e.next()>=.5,Xr=(e,t,n)=>ne(e.next()*(n+1-t)+t),fa=(e,t,n)=>ne(e.next()*(n+1-t)+t),no=(e,t,n)=>fa(e,t,n),qd=e=>Ju(no(e,97,122)),Wd=(e,t=0,n=20)=>{const s=no(e,t,n);let r="";for(let i=0;i<s;i++)r+=qd(e);return r},Qr=(e,t)=>t[no(e,0,t.length-1)],Gd=Symbol("0schema");class Yd{constructor(){this._rerrs=[]}extend(t,n,s,r=null){this._rerrs.push({path:t,expected:n,has:s,message:r})}toString(){const t=[];for(let n=this._rerrs.length-1;n>0;n--){const s=this._rerrs[n];t.push(rd(" ",(this._rerrs.length-n)*2)+`${s.path!=null?`[${s.path}] `:""}${s.has} doesn't match ${s.expected}. ${s.message}`)}return t.join(`
`)}}const ki=(e,t)=>e===t?!0:e==null||t==null||e.constructor!==t.constructor?!1:e[us]?la(e,t):xn(e)?Ji(e,n=>Zi(t,s=>ki(n,s))):Dd(e)?Is(e,(n,s)=>ki(n,t[s])):!1;class It{static _dilutes=!1;extends(t){let[n,s]=[this.shape,t.shape];return this.constructor._dilutes&&([s,n]=[n,s]),ki(n,s)}equals(t){return this.constructor===t.constructor&&er(this.shape,t.shape)}[Gd](){return!0}[us](t){return this.equals(t)}validate(t){return this.check(t)}check(t,n){Yt()}get nullable(){return Vn(this,Or)}get optional(){return new ma(this)}cast(t){return sc(t,this),t}expect(t){return sc(t,this),t}}class so extends It{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n=void 0){const s=t?.constructor===this.shape&&(this._c==null||this._c(t));return!s&&n?.extend(null,this.shape.name,t?.constructor.name,t?.constructor!==this.shape?"Constructor match failed":"Check failed"),s}}const at=(e,t=null)=>new so(e,t);at(so);class ro extends It{constructor(t){super(),this.shape=t}check(t,n){const s=this.shape(t);return!s&&n?.extend(null,"custom prop",t?.constructor.name,"failed to check custom prop"),s}}const gt=e=>new ro(e);at(ro);class kr extends It{constructor(t){super(),this.shape=t}check(t,n){const s=this.shape.some(r=>r===t);return!s&&n?.extend(null,this.shape.join(" | "),t.toString()),s}}const Ir=(...e)=>new kr(e),pa=at(kr),Jd=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,t=>"\\"+t)),ga=e=>{if(Pn.check(e))return[Jd(e)];if(pa.check(e))return e.shape.map(t=>t+"");if(ka.check(e))return["[+-]?\\d+.?\\d*"];if(Ia.check(e))return[".*"];if(ar.check(e))return e.shape.map(ga).flat(1);Dt()};class Zd extends It{constructor(t){super(),this.shape=t,this._r=new RegExp("^"+t.map(ga).map(n=>`(${n.join("|")})`).join("")+"$")}check(t,n){const s=this._r.exec(t)!=null;return!s&&n?.extend(null,this._r.toString(),t.toString(),"String doesn't match string template."),s}}at(Zd);const Xd=Symbol("optional");class ma extends It{constructor(t){super(),this.shape=t}check(t,n){const s=t===void 0||this.shape.check(t);return!s&&n?.extend(null,"undefined (optional)","()"),s}get[Xd](){return!0}}const Qd=at(ma);class th extends It{check(t,n){return n?.extend(null,"never",typeof t),!1}}at(th);class Ar extends It{constructor(t,n=!1){super(),this.shape=t,this._isPartial=n}static _dilutes=!0;get partial(){return new Ar(this.shape,!0)}check(t,n){return t==null?(n?.extend(null,"object","null"),!1):Is(this.shape,(s,r)=>{const i=this._isPartial&&!to(t,r)||s.check(t[r],n);return!i&&n?.extend(r.toString(),s.toString(),typeof t[r],"Object property does not match"),i})}}const eh=e=>new Ar(e),nh=at(Ar),sh=gt(e=>e!=null&&(e.constructor===Object||e.constructor==null));class ya extends It{constructor(t,n){super(),this.shape={keys:t,values:n}}check(t,n){return t!=null&&Is(t,(s,r)=>{const i=this.shape.keys.check(r,n);return!i&&n?.extend(r+"","Record",typeof t,i?"Key doesn't match schema":"Value doesn't match value"),i&&this.shape.values.check(s,n)})}}const wa=(e,t)=>new ya(e,t),rh=at(ya);class ba extends It{constructor(t){super(),this.shape=t}check(t,n){return t!=null&&Is(this.shape,(s,r)=>{const i=s.check(t[r],n);return!i&&n?.extend(r.toString(),"Tuple",typeof s),i})}}const ih=(...e)=>new ba(e);at(ba);class _a extends It{constructor(t){super(),this.shape=t.length===1?t[0]:new io(t)}check(t,n){const s=xn(t)&&Ji(t,r=>this.shape.check(r));return!s&&n?.extend(null,"Array",""),s}}const Sa=(...e)=>new _a(e),oh=at(_a),ch=gt(e=>xn(e));class Ea extends It{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n){const s=t instanceof this.shape&&(this._c==null||this._c(t));return!s&&n?.extend(null,this.shape.name,t?.constructor.name),s}}const ah=(e,t=null)=>new Ea(e,t);at(Ea);const lh=ah(It);class uh extends It{constructor(t){super(),this.len=t.length-1,this.args=ih(...t.slice(-1)),this.res=t[this.len]}check(t,n){const s=t.constructor===Function&&t.length<=this.len;return!s&&n?.extend(null,"function",typeof t),s}}const dh=at(uh),hh=gt(e=>typeof e=="function");class fh extends It{constructor(t){super(),this.shape=t}check(t,n){const s=Ji(this.shape,r=>r.check(t,n));return!s&&n?.extend(null,"Intersectinon",typeof t),s}}at(fh,e=>e.shape.length>0);class io extends It{static _dilutes=!0;constructor(t){super(),this.shape=t}check(t,n){const s=Zi(this.shape,r=>r.check(t,n));return n?.extend(null,"Union",typeof t),s}}const Vn=(...e)=>e.findIndex(t=>ar.check(t))>=0?Vn(...e.map(t=>hs(t)).map(t=>ar.check(t)?t.shape:[t]).flat(1)):e.length===1?e[0]:new io(e),ar=at(io),va=()=>!0,lr=gt(va),ph=at(ro,e=>e.shape===va),oo=gt(e=>typeof e=="bigint"),gh=gt(e=>e===oo),Ca=gt(e=>typeof e=="symbol");gt(e=>e===Ca);const kn=gt(e=>typeof e=="number"),ka=gt(e=>e===kn),Pn=gt(e=>typeof e=="string"),Ia=gt(e=>e===Pn),Tr=gt(e=>typeof e=="boolean"),mh=gt(e=>e===Tr),Aa=Ir(void 0);at(kr,e=>e.shape.length===1&&e.shape[0]===void 0);Ir(void 0);const Or=Ir(null),yh=at(kr,e=>e.shape.length===1&&e.shape[0]===null);at(Uint8Array);at(so,e=>e.shape===Uint8Array);const wh=Vn(kn,Pn,Or,Aa,oo,Tr,Ca);(()=>{const e=Sa(lr),t=wa(Pn,lr),n=Vn(kn,Pn,Or,Tr,e,t);return e.shape=n,t.shape.values=n,n})();const hs=e=>{if(lh.check(e))return e;if(sh.check(e)){const t={};for(const n in e)t[n]=hs(e[n]);return eh(t)}else{if(ch.check(e))return Vn(...e.map(hs));if(wh.check(e))return Ir(e);if(hh.check(e))return at(e)}Dt()},sc=Vd?()=>{}:(e,t)=>{const n=new Yd;if(!t.check(e,n))throw Zt(`Expected value to be of type ${t.constructor.name}.
${n.toString()}`)};class bh{constructor(t){this.patterns=[],this.$state=t}if(t,n){return this.patterns.push({if:hs(t),h:n}),this}else(t){return this.if(lr,t)}done(){return(t,n)=>{for(let s=0;s<this.patterns.length;s++){const r=this.patterns[s];if(r.if.check(t))return r.h(t,n)}throw Zt("Unhandled pattern")}}}const _h=e=>new bh(e),Ta=_h(lr).if(ka,(e,t)=>Xr(t,Go,ir)).if(Ia,(e,t)=>Wd(t)).if(mh,(e,t)=>nc(t)).if(gh,(e,t)=>BigInt(Xr(t,Go,ir))).if(ar,(e,t)=>pn(t,Qr(t,e.shape))).if(nh,(e,t)=>{const n={};for(const s in e.shape){let r=e.shape[s];if(Qd.check(r)){if(nc(t))continue;r=r.shape}n[s]=Ta(r,t)}return n}).if(oh,(e,t)=>{const n=[],s=fa(t,0,42);for(let r=0;r<s;r++)n.push(pn(t,e.shape));return n}).if(pa,(e,t)=>Qr(t,e.shape)).if(yh,(e,t)=>null).if(dh,(e,t)=>{const n=pn(t,e.res);return()=>n}).if(ph,(e,t)=>pn(t,Qr(t,[kn,Pn,Or,Aa,oo,Tr,Sa(kn),wa(Vn("a","b","c"),kn)]))).if(rh,(e,t)=>{const n={},s=Xr(t,0,3);for(let r=0;r<s;r++){const i=pn(t,e.shape.keys),o=pn(t,e.shape.values);n[i]=o}return n}).done(),pn=(e,t)=>Ta(hs(t),e),Dr=typeof document<"u"?document:{};gt(e=>e.nodeType===kh);typeof DOMParser<"u"&&new DOMParser;gt(e=>e.nodeType===Eh);gt(e=>e.nodeType===vh);const Sh=e=>ju(e,(t,n)=>`${n}:${t};`).join(""),Eh=Dr.ELEMENT_NODE,vh=Dr.TEXT_NODE,Ch=Dr.DOCUMENT_NODE,kh=Dr.DOCUMENT_FRAGMENT_NODE;gt(e=>e.nodeType===Ch);const Ce=Symbol,Oa=Ce(),Da=Ce(),Ih=Ce(),Ah=Ce(),Th=Ce(),xa=Ce(),Oh=Ce(),co=Ce(),Dh=Ce(),xh=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[];let s=0;for(;s<e.length;s++){const r=e[s];if(r===void 0)break;if(r.constructor===String||r.constructor===Number)t.push(r);else if(r.constructor===Object)break}for(s>0&&n.push(t.join(""));s<e.length;s++){const r=e[s];r instanceof Symbol||n.push(r)}return n},Rh={[Oa]:le("font-weight","bold"),[Da]:le("font-weight","normal"),[Ih]:le("color","blue"),[Th]:le("color","green"),[Ah]:le("color","grey"),[xa]:le("color","red"),[Oh]:le("color","purple"),[co]:le("color","orange"),[Dh]:le("color","black")},Lh=e=>{e.length===1&&e[0]?.constructor===Function&&(e=e[0]());const t=[],n=[],s=Ot();let r=[],i=0;for(;i<e.length;i++){const o=e[i],c=Rh[o];if(c!==void 0)s.set(c.left,c.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const l=Sh(s);i>0||l.length>0?(t.push("%c"+o),n.push(l)):t.push(o)}else break}}for(i>0&&(r=n,r.unshift(t.join("")));i<e.length;i++){const o=e[i];o instanceof Symbol||r.push(o)}return r},Ra=Fd?Lh:xh,Ph=(...e)=>{console.log(...Ra(e)),Pa.forEach(t=>t.print(e))},La=(...e)=>{console.warn(...Ra(e)),e.unshift(co),Pa.forEach(t=>t.print(e))},Pa=Ze(),Na=e=>({[Symbol.iterator](){return this},next:e}),Nh=(e,t)=>Na(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),ti=(e,t)=>Na(()=>{const{done:n,value:s}=e.next();return{done:n,value:n?void 0:t(s)}});class ao{constructor(t,n){this.clock=t,this.len=n}}class Hn{constructor(){this.clients=new Map}}const Nn=(e,t,n)=>t.clients.forEach((s,r)=>{const i=e.doc.store.clients.get(r);if(i!=null){const o=i[i.length-1],c=o.id.clock+o.length;for(let l=0,u=s[l];l<s.length&&u.clock<c;u=s[++l])Ja(e,i,u.clock,u.len,n)}}),Uh=(e,t)=>{let n=0,s=e.length-1;for(;n<=s;){const r=ne((n+s)/2),i=e[r],o=i.clock;if(o<=t){if(t<o+i.len)return r;n=r+1}else s=r-1}return null},Fn=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Uh(n,t.clock)!==null},lo=e=>{e.clients.forEach(t=>{t.sort((r,i)=>r.clock-i.clock);let n,s;for(n=1,s=1;n<t.length;n++){const r=t[s-1],i=t[n];r.clock+r.len>=i.clock?r.len=rn(r.len,i.clock+i.len-r.clock):(s<n&&(t[s]=i),s++)}t.length=s})},fs=e=>{const t=new Hn;for(let n=0;n<e.length;n++)e[n].clients.forEach((s,r)=>{if(!t.clients.has(r)){const i=s.slice();for(let o=n+1;o<e.length;o++)zu(i,e[o].clients.get(r)||[]);t.clients.set(r,i)}});return lo(t),t},ps=(e,t,n,s)=>{ve(e.clients,t,()=>[]).push(new ao(n,s))},Ua=()=>new Hn,Ma=e=>{const t=Ua();return e.clients.forEach((n,s)=>{const r=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const c=o.id.clock;let l=o.length;if(i+1<n.length)for(let u=n[i+1];i+1<n.length&&u.deleted;u=n[++i+1])l+=u.length;r.push(new ao(c,l))}}r.length>0&&t.clients.set(s,r)}),t},Se=(e,t)=>{H(e.restEncoder,t.clients.size),be(t.clients.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{e.resetDsCurVal(),H(e.restEncoder,n);const r=s.length;H(e.restEncoder,r);for(let i=0;i<r;i++){const o=s[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},gs=e=>{const t=new Hn,n=B(e.restDecoder);for(let s=0;s<n;s++){e.resetDsCurVal();const r=B(e.restDecoder),i=B(e.restDecoder);if(i>0){const o=ve(t.clients,r,()=>[]);for(let c=0;c<i;c++)o.push(new ao(e.readDsClock(),e.readDsLen()))}}return t},rc=(e,t,n)=>{const s=new Hn,r=B(e.restDecoder);for(let i=0;i<r;i++){e.resetDsCurVal();const o=B(e.restDecoder),c=B(e.restDecoder),l=n.clients.get(o)||[],u=it(n,o);for(let a=0;a<c;a++){const d=e.readDsClock(),f=d+e.readDsLen();if(d<u){u<f&&ps(s,o,u,f-u);let g=se(l,d),m=l[g];for(!m.deleted&&m.id.clock<d&&(l.splice(g+1,0,yr(t,m,d-m.id.clock)),g++);g<l.length&&(m=l[g++],m.id.clock<f);)m.deleted||(f<m.id.clock+m.length&&l.splice(g,0,yr(t,m,f-m.id.clock)),m.delete(t))}else ps(s,o,d,f-d)}}if(s.clients.size>0){const i=new Xe;return H(i.restEncoder,0),Se(i,s),i.toUint8Array()}return null},$a=ca;class on extends ea{constructor({guid:t=kd(),collectionid:n=null,gc:s=!0,gcFilter:r=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=s,this.gcFilter=r,this.clientID=$a(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Ga,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ln(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>Ln(u=>{const a=d=>{(d===void 0||d===!0)&&(this.off("sync",a),u())};this.on("sync",a)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const t=this._item;t!==null&&!this.shouldLoad&&J(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(be(this.subdocs).map(t=>t.guid))}transact(t,n=null){return J(this,t,n)}get(t,n=pt){const s=ve(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),r=s.constructor;if(n!==pt&&r!==n)if(r===pt){const i=new n;i._map=s._map,s._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=s._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=s._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return s}getArray(t=""){return this.get(t,Ne)}getText(t=""){return this.get(t,Mn)}getMap(t=""){return this.get(t,Qe)}getXmlElement(t=""){return this.get(t,$n)}getXmlFragment(t=""){return this.get(t,tn)}toJSON(){const t={};return this.share.forEach((n,s)=>{t[s]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,be(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new on({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,J(t.parent.doc,s=>{const r=n.doc;t.deleted||s.subdocsAdded.add(r),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class ur{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return B(this.restDecoder)}readDsLen(){return B(this.restDecoder)}}class Ba extends ur{readLeftID(){return M(B(this.restDecoder),B(this.restDecoder))}readRightID(){return M(B(this.restDecoder),B(this.restDecoder))}readClient(){return B(this.restDecoder)}readInfo(){return Rn(this.restDecoder)}readString(){return Je(this.restDecoder)}readParentInfo(){return B(this.restDecoder)===1}readTypeRef(){return B(this.restDecoder)}readLen(){return B(this.restDecoder)}readAny(){return ls(this.restDecoder)}readBuf(){return Kd(Lt(this.restDecoder))}readJSON(){return JSON.parse(Je(this.restDecoder))}readKey(){return Je(this.restDecoder)}}class Mh{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=B(this.restDecoder),this.dsCurrVal}readDsLen(){const t=B(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Un extends Mh{constructor(t){super(t),this.keys=[],B(t),this.keyClockDecoder=new Zr(Lt(t)),this.clientDecoder=new tr(Lt(t)),this.leftClockDecoder=new Zr(Lt(t)),this.rightClockDecoder=new Zr(Lt(t)),this.infoDecoder=new tc(Lt(t),Rn),this.stringDecoder=new Ed(Lt(t)),this.parentInfoDecoder=new tc(Lt(t),Rn),this.typeRefDecoder=new tr(Lt(t)),this.lenDecoder=new tr(Lt(t))}readLeftID(){return new In(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new In(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ls(this.restDecoder)}readBuf(){return Lt(this.restDecoder)}readJSON(){return ls(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class ms{constructor(){this.restEncoder=ks()}toUint8Array(){return Gt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){H(this.restEncoder,t)}writeDsLen(t){H(this.restEncoder,t)}}class As extends ms{writeLeftID(t){H(this.restEncoder,t.client),H(this.restEncoder,t.clock)}writeRightID(t){H(this.restEncoder,t.client),H(this.restEncoder,t.clock)}writeClient(t){H(this.restEncoder,t)}writeInfo(t){cs(this.restEncoder,t)}writeString(t){Ye(this.restEncoder,t)}writeParentInfo(t){H(this.restEncoder,t?1:0)}writeTypeRef(t){H(this.restEncoder,t)}writeLen(t){H(this.restEncoder,t)}writeAny(t){as(this.restEncoder,t)}writeBuf(t){Rt(this.restEncoder,t)}writeJSON(t){Ye(this.restEncoder,JSON.stringify(t))}writeKey(t){Ye(this.restEncoder,t)}}class uo{constructor(){this.restEncoder=ks(),this.dsCurrVal=0}toUint8Array(){return Gt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,H(this.restEncoder,n)}writeDsLen(t){t===0&&Dt(),H(this.restEncoder,t-1),this.dsCurrVal+=t}}class Xe extends uo{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Jr,this.clientEncoder=new Qs,this.leftClockEncoder=new Jr,this.rightClockEncoder=new Jr,this.infoEncoder=new Zo(cs),this.stringEncoder=new pd,this.parentInfoEncoder=new Zo(cs),this.typeRefEncoder=new Qs,this.lenEncoder=new Qs}toUint8Array(){const t=ks();return H(t,0),Rt(t,this.keyClockEncoder.toUint8Array()),Rt(t,this.clientEncoder.toUint8Array()),Rt(t,this.leftClockEncoder.toUint8Array()),Rt(t,this.rightClockEncoder.toUint8Array()),Rt(t,Gt(this.infoEncoder)),Rt(t,this.stringEncoder.toUint8Array()),Rt(t,Gt(this.parentInfoEncoder)),Rt(t,this.typeRefEncoder.toUint8Array()),Rt(t,this.lenEncoder.toUint8Array()),Er(t,Gt(this.restEncoder)),Gt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){as(this.restEncoder,t)}writeBuf(t){Rt(this.restEncoder,t)}writeJSON(t){as(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const $h=(e,t,n,s)=>{s=rn(s,t[0].id.clock);const r=se(t,s);H(e.restEncoder,t.length-r),e.writeClient(n),H(e.restEncoder,s);const i=t[r];i.write(e,s-i.id.clock);for(let o=r+1;o<t.length;o++)t[o].write(e,0)},ho=(e,t,n)=>{const s=new Map;n.forEach((r,i)=>{it(t,i)>r&&s.set(i,r)}),Ts(t).forEach((r,i)=>{n.has(i)||s.set(i,0)}),H(e.restEncoder,s.size),be(s.entries()).sort((r,i)=>i[0]-r[0]).forEach(([r,i])=>{$h(e,t.clients.get(r),r,i)})},Bh=(e,t)=>{const n=Ot(),s=B(e.restDecoder);for(let r=0;r<s;r++){const i=B(e.restDecoder),o=new Array(i),c=e.readClient();let l=B(e.restDecoder);n.set(c,{i:0,refs:o});for(let u=0;u<i;u++){const a=e.readInfo();switch(_r&a){case 0:{const d=e.readLen();o[u]=new Bt(M(c,l),d),l+=d;break}case 10:{const d=B(e.restDecoder);o[u]=new Vt(M(c,l),d),l+=d;break}default:{const d=(a&(pe|Pt))===0,f=new X(M(c,l),null,(a&Pt)===Pt?e.readLeftID():null,null,(a&pe)===pe?e.readRightID():null,d?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,d&&(a&is)===is?e.readString():null,yl(e,a));o[u]=f,l+=f.length}}}}return n},Vh=(e,t,n)=>{const s=[];let r=be(n.keys()).sort((g,m)=>g-m);if(r.length===0)return null;const i=()=>{if(r.length===0)return null;let g=n.get(r[r.length-1]);for(;g.refs.length===g.i;)if(r.pop(),r.length>0)g=n.get(r[r.length-1]);else return null;return g};let o=i();if(o===null)return null;const c=new Ga,l=new Map,u=(g,m)=>{const _=l.get(g);(_==null||_>m)&&l.set(g,m)};let a=o.refs[o.i++];const d=new Map,f=()=>{for(const g of s){const m=g.id.client,_=n.get(m);_?(_.i--,c.clients.set(m,_.refs.slice(_.i)),n.delete(m),_.i=0,_.refs=[]):c.clients.set(m,[g]),r=r.filter(N=>N!==m)}s.length=0};for(;;){if(a.constructor!==Vt){const m=ve(d,a.id.client,()=>it(t,a.id.client))-a.id.clock;if(m<0)s.push(a),u(a.id.client,a.id.clock-1),f();else{const _=a.getMissing(e,t);if(_!==null){s.push(a);const N=n.get(_)||{refs:[],i:0};if(N.refs.length===N.i)u(_,it(t,_)),f();else{a=N.refs[N.i++];continue}}else(m===0||m<a.length)&&(a.integrate(e,m),d.set(a.id.client,a.id.clock+a.length))}}if(s.length>0)a=s.pop();else if(o!==null&&o.i<o.refs.length)a=o.refs[o.i++];else{if(o=i(),o===null)break;a=o.refs[o.i++]}}if(c.clients.size>0){const g=new Xe;return ho(g,c,new Map),H(g.restEncoder,0),{missing:l,update:g.toUint8Array()}}return null},Hh=(e,t)=>ho(e,t.doc.store,t.beforeState),Fh=(e,t,n,s=new Un(e))=>J(t,r=>{r.local=!1;let i=!1;const o=r.doc,c=o.store,l=Bh(s,o),u=Vh(r,c,l),a=c.pendingStructs;if(a){for(const[f,g]of a.missing)if(g<it(c,f)){i=!0;break}if(u){for(const[f,g]of u.missing){const m=a.missing.get(f);(m==null||m>g)&&a.missing.set(f,g)}a.update=hr([a.update,u.update])}}else c.pendingStructs=u;const d=rc(s,r,c);if(c.pendingDs){const f=new Un(_e(c.pendingDs));B(f.restDecoder);const g=rc(f,r,c);d&&g?c.pendingDs=hr([d,g]):c.pendingDs=d||g}else c.pendingDs=d;if(i){const f=c.pendingStructs.update;c.pendingStructs=null,fo(r.doc,f)}},n,!1),fo=(e,t,n,s=Un)=>{const r=_e(t);Fh(r,e,n,new s(r))},Va=(e,t,n)=>fo(e,t,n,Ba),jh=(e,t,n=new Map)=>{ho(e,t.store,n),Se(e,Ma(t.store))},Ha=(e,t=new Uint8Array([0]),n=new Xe)=>{const s=Fa(t);jh(n,e,s);const r=[n.toUint8Array()];if(e.store.pendingDs&&r.push(e.store.pendingDs),e.store.pendingStructs&&r.push(mf(e.store.pendingStructs.update,t)),r.length>1){if(n.constructor===As)return pf(r.map((i,o)=>o===0?i:wf(i)));if(n.constructor===Xe)return hr(r)}return r[0]},po=(e,t)=>Ha(e,t,new As),Kh=e=>{const t=new Map,n=B(e.restDecoder);for(let s=0;s<n;s++){const r=B(e.restDecoder),i=B(e.restDecoder);t.set(r,i)}return t},Fa=e=>Kh(new ur(_e(e))),go=(e,t)=>(H(e.restEncoder,t.size),be(t.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{H(e.restEncoder,n),H(e.restEncoder,s)}),e),zh=(e,t)=>go(e,Ts(t.store)),qh=(e,t=new uo)=>(e instanceof Map?go(t,e):zh(t,e),t.toUint8Array()),Wh=e=>qh(e,new ms);class Gh{constructor(){this.l=[]}}const ic=()=>new Gh,oc=(e,t)=>e.l.push(t),cc=(e,t)=>{const n=e.l,s=n.length;e.l=n.filter(r=>t!==r),s===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ja=(e,t,n)=>eo(e.l,[t,n]);class In{constructor(t,n){this.client=t,this.clock=n}}const Sn=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,M=(e,t)=>new In(e,t),ac=(e,t)=>{H(e,t.client),H(e,t.clock)},lc=e=>M(B(e),B(e)),Ka=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Dt()},dr=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1};class Yh{constructor(t,n=t.getMap("users")){const s=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=s;const r=(i,o)=>{const c=i.get("ds"),l=i.get("ids"),u=a=>this.clients.set(a,o);c.observe(a=>{a.changes.added.forEach(d=>{d.content.getContent().forEach(f=>{f instanceof Uint8Array&&this.dss.set(o,fs([this.dss.get(o)||Ua(),gs(new ur(_e(f)))]))})})}),this.dss.set(o,fs(c.map(a=>gs(new ur(_e(a)))))),l.observe(a=>a.changes.added.forEach(d=>d.content.getContent().forEach(u))),l.forEach(u)};n.observe(i=>{i.keysChanged.forEach(o=>r(n.get(o),o))}),n.forEach(r)}setUserMapping(t,n,s,{filter:r=()=>!0}={}){const i=this.yusers;let o=i.get(s);o||(o=new Qe,o.set("ids",new Ne),o.set("ds",new Ne),i.set(s,o)),o.get("ids").push([n]),i.observe(c=>{setTimeout(()=>{const l=i.get(s);if(l!==o){o=l,this.clients.forEach((d,f)=>{s===d&&o.get("ids").push([f])});const u=new ms,a=this.dss.get(s);a&&(Se(u,a),o.get("ds").push([u.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{const l=o.get("ds"),u=c.deleteSet;if(c.local&&u.clients.size>0&&r(c,u)){const a=new ms;Se(a,u),l.push([a.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[n,s]of this.dss.entries())if(Fn(s,t))return n;return null}}class mo{constructor(t,n,s,r=0){this.type=t,this.tname=n,this.item=s,this.assoc=r}}const Jh=e=>new mo(e.type==null?null:M(e.type.client,e.type.clock),e.tname??null,e.item==null?null:M(e.item.client,e.item.clock),e.assoc==null?0:e.assoc);class Zh{constructor(t,n,s=0){this.type=t,this.index=n,this.assoc=s}}const Xh=(e,t,n=0)=>new Zh(e,t,n),Hs=(e,t,n)=>{let s=null,r=null;return e._item===null?r=Ka(e):s=M(e._item.id.client,e._item.id.clock),new mo(s,r,t,n)},za=(e,t,n=0)=>{let s=e._start;if(n<0){if(t===0)return Hs(e,null,n);t--}for(;s!==null;){if(!s.deleted&&s.countable){if(s.length>t)return Hs(e,M(s.id.client,s.id.clock+t),n);t-=s.length}if(s.right===null&&n<0)return Hs(e,s.lastId,n);s=s.right}return Hs(e,null,n)},Qh=(e,t)=>{const{type:n,tname:s,item:r,assoc:i}=t;if(r!==null)H(e,0),ac(e,r);else if(s!==null)cs(e,1),Ye(e,s);else if(n!==null)cs(e,2),ac(e,n);else throw Dt();return Sr(e,i),e},tf=e=>{const t=ks();return Qh(t,e),Gt(t)},ef=e=>{let t=null,n=null,s=null;switch(B(e)){case 0:s=lc(e);break;case 1:n=Je(e);break;case 2:t=lc(e)}const r=oa(e)?Cr(e):0;return new mo(t,n,s,r)},qa=e=>ef(_e(e)),nf=(e,t)=>{const n=An(e,t),s=t.clock-n.id.clock;return{item:n,diff:s}},Wa=(e,t,n=!0)=>{const s=t.store,r=e.item,i=e.type,o=e.tname,c=e.assoc;let l=null,u=0;if(r!==null){if(it(s,r.client)<=r.clock)return null;const a=n?Di(s,r):nf(s,r),d=a.item;if(!(d instanceof X))return null;if(l=d.parent,l._item===null||!l._item.deleted){u=d.deleted||!d.countable?0:a.diff+(c>=0?0:1);let f=d.left;for(;f!==null;)!f.deleted&&f.countable&&(u+=f.length),f=f.left}}else{if(o!==null)l=t.get(o);else if(i!==null){if(it(s,i.client)<=i.clock)return null;const{item:a}=n?Di(s,i):{item:An(s,i)};if(a instanceof X&&a.content instanceof oe)l=a.content.type;else return null}else throw Dt();c>=0?u=l._length:u=0}return Xh(l,u,e.assoc)},r1=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Sn(e.item,t.item)&&Sn(e.type,t.type)&&e.assoc===t.assoc;class sf{constructor(t,n){this.ds=t,this.sv=n}}const Ii=(e,t=new uo)=>(Se(t,e.ds),go(t,e.sv),t.toUint8Array()),uc=e=>Ii(e,new ms),rf=(e,t)=>new sf(e,t),Fs=e=>rf(Ma(e.store),Ts(e.store)),wn=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Fn(t.ds,e.id),Ai=(e,t)=>{const n=ve(e.meta,Ai,Ze),s=e.doc.store;n.has(t)||(t.sv.forEach((r,i)=>{r<it(s,i)&&Tt(e,M(i,r))}),Nn(e,t.ds,r=>{}),n.add(t))};class Ga{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ts=e=>{const t=new Map;return e.clients.forEach((n,s)=>{const r=n[n.length-1];t.set(s,r.id.clock+r.length)}),t},it=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const s=n[n.length-1];return s.id.clock+s.length},Ya=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const s=n[n.length-1];if(s.id.clock+s.length!==t.id.clock)throw Dt()}n.push(t)},se=(e,t)=>{let n=0,s=e.length-1,r=e[s],i=r.id.clock;if(i===t)return s;let o=ne(t/(i+r.length-1)*s);for(;n<=s;){if(r=e[o],i=r.id.clock,i<=t){if(t<i+r.length)return o;n=o+1}else s=o-1;o=ne((n+s)/2)}throw Dt()},of=(e,t)=>{const n=e.clients.get(t.client);return n[se(n,t.clock)]},An=of,Ti=(e,t,n)=>{const s=se(t,n),r=t[s];return r.id.clock<n&&r instanceof X?(t.splice(s+1,0,yr(e,r,n-r.id.clock)),s+1):s},Tt=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Ti(e,n,t.clock)]},dc=(e,t,n)=>{const s=t.clients.get(n.client),r=se(s,n.clock),i=s[r];return n.clock!==i.id.clock+i.length-1&&i.constructor!==Bt&&s.splice(r+1,0,yr(e,i,n.clock-i.id.clock+1)),i},cf=(e,t,n)=>{const s=e.clients.get(t.id.client);s[se(s,t.id.clock)]=n},Ja=(e,t,n,s,r)=>{if(s===0)return;const i=n+s;let o=Ti(e,t,n),c;do c=t[o++],i<c.id.clock+c.length&&Ti(e,t,i),r(c);while(o<t.length&&t[o].id.clock<i)};class af{constructor(t,n,s){this.doc=t,this.deleteSet=new Hn,this.beforeState=Ts(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const hc=(e,t)=>t.deleteSet.clients.size===0&&!Ku(t.afterState,(n,s)=>t.beforeState.get(s)!==n)?!1:(lo(t.deleteSet),Hh(e,t),Se(e,t.deleteSet),!0),fc=(e,t,n)=>{const s=t._item;(s===null||s.id.clock<(e.beforeState.get(s.id.client)||0)&&!s.deleted)&&ve(e.changed,t,Ze).add(n)},nr=(e,t)=>{let n=e[t],s=e[t-1],r=t;for(;r>0;n=s,s=e[--r-1]){if(s.deleted===n.deleted&&s.constructor===n.constructor&&s.mergeWith(n)){n instanceof X&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,s);continue}break}const i=t-r;return i&&e.splice(t+1-i,i),i},lf=(e,t,n)=>{for(const[s,r]of e.clients.entries()){const i=t.clients.get(s);for(let o=r.length-1;o>=0;o--){const c=r[o],l=c.clock+c.len;for(let u=se(i,c.clock),a=i[u];u<i.length&&a.id.clock<l;a=i[++u]){const d=i[u];if(c.clock+c.len<=d.id.clock)break;d instanceof X&&d.deleted&&!d.keep&&n(d)&&d.gc(t,!1)}}}},uf=(e,t)=>{e.clients.forEach((n,s)=>{const r=t.clients.get(s);for(let i=n.length-1;i>=0;i--){const o=n[i],c=na(r.length-1,1+se(r,o.clock+o.len-1));for(let l=c,u=r[l];l>0&&u.id.clock>=o.clock;u=r[l])l-=1+nr(r,l)}})},Za=(e,t)=>{if(t<e.length){const n=e[t],s=n.doc,r=s.store,i=n.deleteSet,o=n._mergeStructs;try{lo(i),n.afterState=Ts(n.doc.store),s.emit("beforeObserverCalls",[n,s]);const c=[];n.changed.forEach((l,u)=>c.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(a=>a.target._item===null||!a.target._item.deleted),l.forEach(a=>{a.currentTarget=u,a._path=null}),l.sort((a,d)=>a.path.length-d.path.length),c.push(()=>{ja(u._dEH,l,n)}))}),c.push(()=>s.emit("afterTransaction",[n,s])),c.push(()=>{n._needFormattingCleanup&&Rf(n)})}),eo(c,[])}finally{s.gc&&lf(i,r,s.gcFilter),uf(i,r),n.afterState.forEach((a,d)=>{const f=n.beforeState.get(d)||0;if(f!==a){const g=r.clients.get(d),m=rn(se(g,f),1);for(let _=g.length-1;_>=m;)_-=1+nr(g,_)}});for(let a=o.length-1;a>=0;a--){const{client:d,clock:f}=o[a].id,g=r.clients.get(d),m=se(g,f);m+1<g.length&&nr(g,m+1)>1||m>0&&nr(g,m)}if(!n.local&&n.afterState.get(s.clientID)!==n.beforeState.get(s.clientID)&&(Ph(co,Oa,"[yjs] ",Da,xa,"Changed the client-id because another client seems to be using it."),s.clientID=$a()),s.emit("afterTransactionCleanup",[n,s]),s._observers.has("update")){const a=new As;hc(a,n)&&s.emit("update",[a.toUint8Array(),n.origin,s,n])}if(s._observers.has("updateV2")){const a=new Xe;hc(a,n)&&s.emit("updateV2",[a.toUint8Array(),n.origin,s,n])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:u}=n;(c.size>0||u.size>0||l.size>0)&&(c.forEach(a=>{a.clientID=s.clientID,a.collectionid==null&&(a.collectionid=s.collectionid),s.subdocs.add(a)}),u.forEach(a=>s.subdocs.delete(a)),s.emit("subdocs",[{loaded:l,added:c,removed:u},s,n]),u.forEach(a=>a.destroy())),e.length<=t+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,e])):Za(e,t+1)}}},J=(e,t,n=null,s=!0)=>{const r=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new af(e,n,s),r.push(e._transaction),r.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const c=e._transaction===r[0];e._transaction=null,c&&Za(r,0)}}return o};class df{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const pc=(e,t,n)=>{Nn(e,n.deletions,s=>{s instanceof X&&t.scope.some(r=>r===e.doc||dr(r,s))&&Co(s,!1)})},gc=(e,t,n)=>{let s=null;const r=e.doc,i=e.scope;J(r,c=>{for(;t.length>0&&e.currStackItem===null;){const l=r.store,u=t.pop(),a=new Set,d=[];let f=!1;Nn(c,u.insertions,g=>{if(g instanceof X){if(g.redone!==null){let{item:m,diff:_}=Di(l,g.id);_>0&&(m=Tt(c,M(m.id.client,m.id.clock+_))),g=m}!g.deleted&&i.some(m=>m===c.doc||dr(m,g))&&d.push(g)}}),Nn(c,u.deletions,g=>{g instanceof X&&i.some(m=>m===c.doc||dr(m,g))&&!Fn(u.insertions,g.id)&&a.add(g)}),a.forEach(g=>{f=ml(c,g,a,u.insertions,e.ignoreRemoteMapChanges,e)!==null||f});for(let g=d.length-1;g>=0;g--){const m=d[g];e.deleteFilter(m)&&(m.delete(c),f=!0)}e.currStackItem=f?u:null}c.changed.forEach((l,u)=>{l.has(null)&&u._searchMarker&&(u._searchMarker.length=0)}),s=c},e);const o=e.currStackItem;if(o!=null){const c=s.changedParentTypes;e.emit("stack-item-popped",[{stackItem:o,type:n,changedParentTypes:c,origin:e},e]),e.currStackItem=null}return o};class hf extends ea{constructor(t,{captureTimeout:n=500,captureTransaction:s=l=>!0,deleteFilter:r=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=xn(t)?t[0].doc:t instanceof on?t:t.doc}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=r,i.add(this),this.trackedOrigins=i,this.captureTransaction=s,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(N=>l.changedParentTypes.has(N)||N===this.doc)||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;const u=this.undoing,a=this.redoing,d=u?this.redoStack:this.undoStack;u?this.stopCapturing():a||this.clear(!1,!0);const f=new Hn;l.afterState.forEach((N,P)=>{const v=l.beforeState.get(P)||0,U=N-v;U>0&&ps(f,P,v,U)});const g=Id();let m=!1;if(this.lastChange>0&&g-this.lastChange<this.captureTimeout&&d.length>0&&!u&&!a){const N=d[d.length-1];N.deletions=fs([N.deletions,l.deleteSet]),N.insertions=fs([N.insertions,f])}else d.push(new df(l.deleteSet,f)),m=!0;!u&&!a&&(this.lastChange=g),Nn(l,l.deleteSet,N=>{N instanceof X&&this.scope.some(P=>P===l.doc||dr(P,N))&&Co(N,!0)});const _=[{stackItem:d[d.length-1],origin:l.origin,type:u?"redo":"undo",changedParentTypes:l.changedParentTypes},this];m?this.emit("stack-item-added",_):this.emit("stack-item-updated",_)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){const n=new Set(this.scope);t=xn(t)?t:[t],t.forEach(s=>{n.has(s)||(n.add(s),(s instanceof pt?s.doc!==this.doc:s!==this.doc)&&La("[yjs#509] Not same Y.Doc"),this.scope.push(s))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(s=>{t&&(this.undoStack.forEach(r=>pc(s,this,r)),this.undoStack=[]),n&&(this.redoStack.forEach(r=>pc(s,this,r)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=gc(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=gc(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*ff(e){const t=B(e.restDecoder);for(let n=0;n<t;n++){const s=B(e.restDecoder),r=e.readClient();let i=B(e.restDecoder);for(let o=0;o<s;o++){const c=e.readInfo();if(c===10){const l=B(e.restDecoder);yield new Vt(M(r,i),l),i+=l}else if((_r&c)!==0){const l=(c&(pe|Pt))===0,u=new X(M(r,i),null,(c&Pt)===Pt?e.readLeftID():null,null,(c&pe)===pe?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&is)===is?e.readString():null,yl(e,c));yield u,i+=u.length}else{const l=e.readLen();yield new Bt(M(r,i),l),i+=l}}}}class yo{constructor(t,n){this.gen=ff(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Vt);return this.curr}}class wo{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const pf=e=>hr(e,Ba,As),gf=(e,t)=>{if(e.constructor===Bt){const{client:n,clock:s}=e.id;return new Bt(M(n,s+t),e.length-t)}else if(e.constructor===Vt){const{client:n,clock:s}=e.id;return new Vt(M(n,s+t),e.length-t)}else{const n=e,{client:s,clock:r}=n.id;return new X(M(s,r+t),null,M(s,r+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},hr=(e,t=Un,n=Xe)=>{if(e.length===1)return e[0];const s=e.map(a=>new t(_e(a)));let r=s.map(a=>new yo(a,!0)),i=null;const o=new n,c=new wo(o);for(;r=r.filter(f=>f.curr!==null),r.sort((f,g)=>{if(f.curr.id.client===g.curr.id.client){const m=f.curr.id.clock-g.curr.id.clock;return m===0?f.curr.constructor===g.curr.constructor?0:f.curr.constructor===Vt?1:-1:m}else return g.curr.id.client-f.curr.id.client}),r.length!==0;){const a=r[0],d=a.curr.id.client;if(i!==null){let f=a.curr,g=!1;for(;f!==null&&f.id.clock+f.length<=i.struct.id.clock+i.struct.length&&f.id.client>=i.struct.id.client;)f=a.next(),g=!0;if(f===null||f.id.client!==d||g&&f.id.clock>i.struct.id.clock+i.struct.length)continue;if(d!==i.struct.id.client)Re(c,i.struct,i.offset),i={struct:f,offset:0},a.next();else if(i.struct.id.clock+i.struct.length<f.id.clock)if(i.struct.constructor===Vt)i.struct.length=f.id.clock+f.length-i.struct.id.clock;else{Re(c,i.struct,i.offset);const m=f.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Vt(M(d,i.struct.id.clock+i.struct.length),m),offset:0}}else{const m=i.struct.id.clock+i.struct.length-f.id.clock;m>0&&(i.struct.constructor===Vt?i.struct.length-=m:f=gf(f,m)),i.struct.mergeWith(f)||(Re(c,i.struct,i.offset),i={struct:f,offset:0},a.next())}}else i={struct:a.curr,offset:0},a.next();for(let f=a.curr;f!==null&&f.id.client===d&&f.id.clock===i.struct.id.clock+i.struct.length&&f.constructor!==Vt;f=a.next())Re(c,i.struct,i.offset),i={struct:f,offset:0}}i!==null&&(Re(c,i.struct,i.offset),i=null),bo(c);const l=s.map(a=>gs(a)),u=fs(l);return Se(o,u),o.toUint8Array()},mf=(e,t,n=Un,s=Xe)=>{const r=Fa(t),i=new s,o=new wo(i),c=new n(_e(e)),l=new yo(c,!1);for(;l.curr;){const a=l.curr,d=a.id.client,f=r.get(d)||0;if(l.curr.constructor===Vt){l.next();continue}if(a.id.clock+a.length>f)for(Re(o,a,rn(f-a.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)Re(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=f;)l.next()}bo(o);const u=gs(c);return Se(i,u),i.toUint8Array()},Xa=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Gt(e.encoder.restEncoder)}),e.encoder.restEncoder=ks(),e.written=0)},Re=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Xa(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),H(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},bo=e=>{Xa(e);const t=e.encoder.restEncoder;H(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const s=e.clientStructs[n];H(t,s.written),Er(t,s.restEncoder)}},yf=(e,t,n,s)=>{const r=new n(_e(e)),i=new yo(r,!1),o=new s,c=new wo(o);for(let u=i.curr;u!==null;u=i.next())Re(c,t(u),0);bo(c);const l=gs(r);return Se(o,l),o.toUint8Array()},wf=e=>yf(e,Md,Un,As),mc="You must not compute changes after the event-handler fired.";class xr{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=bf(this.currentTarget,this.target))}deletes(t){return Fn(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Zt(mc);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(r=>{if(r!==null){const i=n._map.get(r);let o,c;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",c=Wr(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",c=Wr(l.content.getContent())):(o="add",c=void 0)}else if(this.deletes(i))o="delete",c=Wr(i.content.getContent());else return;t.set(r,{action:o,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Zt(mc);const n=this.target,s=Ze(),r=Ze(),i=[];if(t={added:s,deleted:r,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const l=()=>{c&&i.push(c)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=u.length,r.add(u)):this.adds(u)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(u.content.getContent()),s.add(u)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=u.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}}const bf=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let s=0,r=t._item.parent._start;for(;r!==t._item&&r!==null;)!r.deleted&&r.countable&&(s+=r.length),r=r.right;n.unshift(s)}t=t._item.parent}return n},vt=()=>{La("Invalid access: Add Yjs type to a document before reading data.")},Qa=80;let _o=0;class _f{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=_o++}}const Sf=e=>{e.timestamp=_o++},tl=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=_o++},Ef=(e,t,n)=>{if(e.length>=Qa){const s=e.reduce((r,i)=>r.timestamp<i.timestamp?r:i);return tl(s,t,n),s}else{const s=new _f(t,n);return e.push(s),s}},Rr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>Xs(t-i.index)<Xs(t-o.index)?i:o);let s=e._start,r=0;for(n!==null&&(s=n.p,r=n.index,Sf(n));s.right!==null&&r<t;){if(!s.deleted&&s.countable){if(t<r+s.length)break;r+=s.length}s=s.right}for(;s.left!==null&&r>t;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(r-=s.length);return n!==null&&Xs(n.index-r)<s.parent.length/Qa?(tl(n,s,r),n):Ef(e._searchMarker,s,r)},ys=(e,t,n)=>{for(let s=e.length-1;s>=0;s--){const r=e[s];if(n>0){let i=r.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(r.index-=i.length);if(i===null||i.marker===!0){e.splice(s,1);continue}r.p=i,i.marker=!0}(t<r.index||n>0&&t===r.index)&&(r.index=rn(t,r.index+n))}},Lr=(e,t,n)=>{const s=e,r=t.changedParentTypes;for(;ve(r,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;ja(s._eH,n,t)};class pt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ic(),this._dEH=ic(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Yt()}clone(){throw Yt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){oc(this._eH,t)}observeDeep(t){oc(this._dEH,t)}unobserve(t){cc(this._eH,t)}unobserveDeep(t){cc(this._dEH,t)}toJSON(){}}const el=(e,t,n)=>{e.doc??vt(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let s=n-t;const r=[];let i=e._start;for(;i!==null&&s>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let c=t;c<o.length&&s>0;c++)r.push(o[c]),s--;t=0}}i=i.right}return r},nl=e=>{e.doc??vt();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const s=n.content.getContent();for(let r=0;r<s.length;r++)t.push(s[r])}n=n.right}return t},ws=(e,t)=>{let n=0,s=e._start;for(e.doc??vt();s!==null;){if(s.countable&&!s.deleted){const r=s.content.getContent();for(let i=0;i<r.length;i++)t(r[i],n++,e)}s=s.right}},sl=(e,t)=>{const n=[];return ws(e,(s,r)=>{n.push(t(s,r,e))}),n},vf=e=>{let t=e._start,n=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),s=0,t=t.right}const r=n[s++];return n.length<=s&&(n=null),{done:!1,value:r}}}},rl=(e,t)=>{e.doc??vt();const n=Rr(e,t);let s=e._start;for(n!==null&&(s=n.p,t-=n.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<s.length)return s.content.getContent()[t];t-=s.length}},fr=(e,t,n,s)=>{let r=n;const i=e.doc,o=i.clientID,c=i.store,l=n===null?t._start:n.right;let u=[];const a=()=>{u.length>0&&(r=new X(M(o,it(c,o)),r,r&&r.lastId,l,l&&l.id,t,null,new en(u)),r.integrate(e,0),u=[])};s.forEach(d=>{if(d===null)u.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(d);break;default:switch(a(),d.constructor){case Uint8Array:case ArrayBuffer:r=new X(M(o,it(c,o)),r,r&&r.lastId,l,l&&l.id,t,null,new Os(new Uint8Array(d))),r.integrate(e,0);break;case on:r=new X(M(o,it(c,o)),r,r&&r.lastId,l,l&&l.id,t,null,new Ds(d)),r.integrate(e,0);break;default:if(d instanceof pt)r=new X(M(o,it(c,o)),r,r&&r.lastId,l,l&&l.id,t,null,new oe(d)),r.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),a()},il=()=>Zt("Length exceeded!"),ol=(e,t,n,s)=>{if(n>t._length)throw il();if(n===0)return t._searchMarker&&ys(t._searchMarker,n,s.length),fr(e,t,null,s);const r=n,i=Rr(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Tt(e,M(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&ys(t._searchMarker,r,s.length),fr(e,t,o,s)},Cf=(e,t,n)=>{let r=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(r)for(;r.right;)r=r.right;return fr(e,t,r,n)},cl=(e,t,n,s)=>{if(s===0)return;const r=n,i=s,o=Rr(t,n);let c=t._start;for(o!==null&&(c=o.p,n-=o.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&Tt(e,M(c.id.client,c.id.clock+n)),n-=c.length);for(;s>0&&c!==null;)c.deleted||(s<c.length&&Tt(e,M(c.id.client,c.id.clock+s)),c.delete(e),s-=c.length),c=c.right;if(s>0)throw il();t._searchMarker&&ys(t._searchMarker,r,-i+s)},pr=(e,t,n)=>{const s=t._map.get(n);s!==void 0&&s.delete(e)},So=(e,t,n,s)=>{const r=t._map.get(n)||null,i=e.doc,o=i.clientID;let c;if(s==null)c=new en([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new en([s]);break;case Uint8Array:c=new Os(s);break;case on:c=new Ds(s);break;default:if(s instanceof pt)c=new oe(s);else throw new Error("Unexpected content type")}new X(M(o,it(i.store,o)),r,r&&r.lastId,null,null,t,n,c).integrate(e,0)},Eo=(e,t)=>{e.doc??vt();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},al=e=>{const t={};return e.doc??vt(),e._map.forEach((n,s)=>{n.deleted||(t[s]=n.content.getContent()[n.length-1])}),t},ll=(e,t)=>{e.doc??vt();const n=e._map.get(t);return n!==void 0&&!n.deleted},kf=(e,t)=>{const n={};return e._map.forEach((s,r)=>{let i=s;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&wn(i,t)&&(n[r]=i.content.getContent()[i.length-1])}),n},js=e=>(e.doc??vt(),Nh(e._map.entries(),t=>!t[1].deleted));class If extends xr{}class Ne extends pt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ne;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ne}clone(){const t=new Ne;return t.insert(0,this.toArray().map(n=>n instanceof pt?n.clone():n)),t}get length(){return this.doc??vt(),this._length}_callObserver(t,n){super._callObserver(t,n),Lr(this,t,new If(this,t))}insert(t,n){this.doc!==null?J(this.doc,s=>{ol(s,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?J(this.doc,n=>{Cf(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?J(this.doc,s=>{cl(s,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return rl(this,t)}toArray(){return nl(this)}slice(t=0,n=this.length){return el(this,t,n)}toJSON(){return this.map(t=>t instanceof pt?t.toJSON():t)}map(t){return sl(this,t)}forEach(t){ws(this,t)}[Symbol.iterator](){return vf(this)}_write(t){t.writeTypeRef(Jf)}}const Af=e=>new Ne;class Tf extends xr{constructor(t,n,s){super(t,n),this.keysChanged=s}}class Qe extends pt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((s,r)=>{this.set(r,s)}),this._prelimContent=null}_copy(){return new Qe}clone(){const t=new Qe;return this.forEach((n,s)=>{t.set(s,n instanceof pt?n.clone():n)}),t}_callObserver(t,n){Lr(this,t,new Tf(this,t,n))}toJSON(){this.doc??vt();const t={};return this._map.forEach((n,s)=>{if(!n.deleted){const r=n.content.getContent()[n.length-1];t[s]=r instanceof pt?r.toJSON():r}}),t}get size(){return[...js(this)].length}keys(){return ti(js(this),t=>t[0])}values(){return ti(js(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return ti(js(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??vt(),this._map.forEach((n,s)=>{n.deleted||t(n.content.getContent()[n.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?J(this.doc,n=>{pr(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?J(this.doc,s=>{So(s,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Eo(this,t)}has(t){return ll(this,t)}clear(){this.doc!==null?J(this.doc,t=>{this.forEach(function(n,s,r){pr(t,r,s)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Zf)}}const Of=e=>new Qe,Pe=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Nd(e,t);class Oi{constructor(t,n,s,r){this.left=t,this.right=n,this.index=s,this.currentAttributes=r}forward(){this.right===null&&Dt(),this.right.content.constructor===ht?this.right.deleted||jn(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const yc=(e,t,n)=>{for(;t.right!==null&&n>0;)t.right.content.constructor===ht?t.right.deleted||jn(t.currentAttributes,t.right.content):t.right.deleted||(n<t.right.length&&Tt(e,M(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length),t.left=t.right,t.right=t.right.right;return t},Ks=(e,t,n,s)=>{const r=new Map,i=s?Rr(t,n):null;if(i){const o=new Oi(i.p.left,i.p,i.index,r);return yc(e,o,n-i.index)}else{const o=new Oi(null,t._start,0,r);return yc(e,o,n)}},ul=(e,t,n,s)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ht&&Pe(s.get(n.right.content.key),n.right.content.value));)n.right.deleted||s.delete(n.right.content.key),n.forward();const r=e.doc,i=r.clientID;s.forEach((o,c)=>{const l=n.left,u=n.right,a=new X(M(i,it(r.store,i)),l,l&&l.lastId,u,u&&u.id,t,null,new ht(c,o));a.integrate(e,0),n.right=a,n.forward()})},jn=(e,t)=>{const{key:n,value:s}=t;s===null?e.delete(n):e.set(n,s)},dl=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===ht&&Pe(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},hl=(e,t,n,s)=>{const r=e.doc,i=r.clientID,o=new Map;for(const c in s){const l=s[c],u=n.currentAttributes.get(c)??null;if(!Pe(u,l)){o.set(c,u);const{left:a,right:d}=n;n.right=new X(M(i,it(r.store,i)),a,a&&a.lastId,d,d&&d.id,t,null,new ht(c,l)),n.right.integrate(e,0),n.forward()}}return o},ei=(e,t,n,s,r)=>{n.currentAttributes.forEach((f,g)=>{r[g]===void 0&&(r[g]=null)});const i=e.doc,o=i.clientID;dl(n,r);const c=hl(e,t,n,r),l=s.constructor===String?new re(s):s instanceof pt?new oe(s):new cn(s);let{left:u,right:a,index:d}=n;t._searchMarker&&ys(t._searchMarker,n.index,l.getLength()),a=new X(M(o,it(i.store,o)),u,u&&u.lastId,a,a&&a.id,t,null,l),a.integrate(e,0),n.right=a,n.index=d,n.forward(),ul(e,t,n,c)},wc=(e,t,n,s,r)=>{const i=e.doc,o=i.clientID;dl(n,r);const c=hl(e,t,n,r);t:for(;n.right!==null&&(s>0||c.size>0&&(n.right.deleted||n.right.content.constructor===ht));){if(!n.right.deleted)switch(n.right.content.constructor){case ht:{const{key:l,value:u}=n.right.content,a=r[l];if(a!==void 0){if(Pe(a,u))c.delete(l);else{if(s===0)break t;c.set(l,u)}n.right.delete(e)}else n.currentAttributes.set(l,u);break}default:s<n.right.length&&Tt(e,M(n.right.id.client,n.right.id.clock+s)),s-=n.right.length;break}n.forward()}if(s>0){let l="";for(;s>0;s--)l+=`
`;n.right=new X(M(o,it(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new re(l)),n.right.integrate(e,0),n.forward()}ul(e,t,n,c)},fl=(e,t,n,s,r)=>{let i=t;const o=Ot();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===ht){const u=i.content;o.set(u.key,u)}i=i.right}let c=0,l=!1;for(;t!==i;){if(n===t&&(l=!0),!t.deleted){const u=t.content;if(u.constructor===ht){const{key:a,value:d}=u,f=s.get(a)??null;(o.get(a)!==u||f===d)&&(t.delete(e),c++,!l&&(r.get(a)??null)===d&&f!==d&&(f===null?r.delete(a):r.set(a,f))),!l&&!t.deleted&&jn(r,u)}}t=t.right}return c},Df=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===ht){const s=t.content.key;n.has(s)?t.delete(e):n.add(s)}t=t.left}},xf=e=>{let t=0;return J(e.doc,n=>{let s=e._start,r=e._start,i=Ot();const o=Si(i);for(;r;)r.deleted===!1&&(r.content.constructor===ht?jn(o,r.content):(t+=fl(n,s,r,i,o),i=Si(o),s=r)),r=r.right}),t},Rf=e=>{const t=new Set,n=e.doc;for(const[s,r]of e.afterState.entries()){const i=e.beforeState.get(s)||0;r!==i&&Ja(e,n.store.clients.get(s),i,r,o=>{!o.deleted&&o.content.constructor===ht&&o.constructor!==Bt&&t.add(o.parent)})}J(n,s=>{Nn(e,e.deleteSet,r=>{if(r instanceof Bt||!r.parent._hasFormatting||t.has(r.parent))return;const i=r.parent;r.content.constructor===ht?t.add(i):Df(s,r)});for(const r of t)xf(r)})},bc=(e,t,n)=>{const s=n,r=Si(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case oe:case cn:case re:n<t.right.length&&Tt(e,M(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&fl(e,i,t.right,r,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ys(o._searchMarker,t.index,-s+n),t};class pl extends xr{constructor(t,n,s){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(r=>{r===null?this.childListChanged=!0:this.keysChanged.add(r)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];J(t,s=>{const r=new Map,i=new Map;let o=this.target._start,c=null;const l={};let u="",a=0,d=0;const f=()=>{if(c!==null){let g=null;switch(c){case"delete":d>0&&(g={delete:d}),d=0;break;case"insert":(typeof u=="object"||u.length>0)&&(g={insert:u},r.size>0&&(g.attributes={},r.forEach((m,_)=>{m!==null&&(g.attributes[_]=m)}))),u="";break;case"retain":a>0&&(g={retain:a},Pd(l)||(g.attributes=xd({},l))),a=0;break}g&&n.push(g),c=null}};for(;o!==null;){switch(o.content.constructor){case oe:case cn:this.adds(o)?this.deletes(o)||(f(),c="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(c!=="delete"&&(f(),c="delete"),d+=1):o.deleted||(c!=="retain"&&(f(),c="retain"),a+=1);break;case re:this.adds(o)?this.deletes(o)||(c!=="insert"&&(f(),c="insert"),u+=o.content.str):this.deletes(o)?(c!=="delete"&&(f(),c="delete"),d+=o.length):o.deleted||(c!=="retain"&&(f(),c="retain"),a+=o.length);break;case ht:{const{key:g,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const _=r.get(g)??null;Pe(_,m)?m!==null&&o.delete(s):(c==="retain"&&f(),Pe(m,i.get(g)??null)?delete l[g]:l[g]=m)}}else if(this.deletes(o)){i.set(g,m);const _=r.get(g)??null;Pe(_,m)||(c==="retain"&&f(),l[g]=_)}else if(!o.deleted){i.set(g,m);const _=l[g];_!==void 0&&(Pe(_,m)?_!==null&&o.delete(s):(c==="retain"&&f(),m===null?delete l[g]:l[g]=m))}o.deleted||(c==="insert"&&f(),jn(r,o.content));break}}o=o.right}for(f();n.length>0;){const g=n[n.length-1];if(g.retain!==void 0&&g.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Mn extends pt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??vt(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new Mn}clone(){const t=new Mn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const s=new pl(this,t,n);Lr(this,t,s),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??vt();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===re&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?J(this.doc,s=>{const r=new Oi(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const c=!n&&typeof o.insert=="string"&&i===t.length-1&&r.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&ei(s,this,r,c,o.attributes||{})}else o.retain!==void 0?wc(s,this,r,o.retain,o.attributes||{}):o.delete!==void 0&&bc(s,r,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,s){this.doc??vt();const r=[],i=new Map,o=this.doc;let c="",l=this._start;function u(){if(c.length>0){const d={};let f=!1;i.forEach((m,_)=>{f=!0,d[_]=m});const g={insert:c};f&&(g.attributes=d),r.push(g),c=""}}const a=()=>{for(;l!==null;){if(wn(l,t)||n!==void 0&&wn(l,n))switch(l.content.constructor){case re:{const d=i.get("ychange");t!==void 0&&!wn(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(u(),i.set("ychange",s?s("removed",l.id):{type:"removed"})):n!==void 0&&!wn(l,n)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(u(),i.set("ychange",s?s("added",l.id):{type:"added"})):d!==void 0&&(u(),i.delete("ychange")),c+=l.content.str;break}case oe:case cn:{u();const d={insert:l.content.getContent()[0]};if(i.size>0){const f={};d.attributes=f,i.forEach((g,m)=>{f[m]=g})}r.push(d);break}case ht:wn(l,t)&&(u(),jn(i,l.content));break}l=l.right}u()};return t||n?J(o,d=>{t&&Ai(d,t),n&&Ai(d,n),a()},"cleanup"):a(),r}insert(t,n,s){if(n.length<=0)return;const r=this.doc;r!==null?J(r,i=>{const o=Ks(i,this,t,!s);s||(s={},o.currentAttributes.forEach((c,l)=>{s[l]=c})),ei(i,this,o,n,s)}):this._pending.push(()=>this.insert(t,n,s))}insertEmbed(t,n,s){const r=this.doc;r!==null?J(r,i=>{const o=Ks(i,this,t,!s);ei(i,this,o,n,s||{})}):this._pending.push(()=>this.insertEmbed(t,n,s||{}))}delete(t,n){if(n===0)return;const s=this.doc;s!==null?J(s,r=>{bc(r,Ks(r,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,s){if(n===0)return;const r=this.doc;r!==null?J(r,i=>{const o=Ks(i,this,t,!1);o.right!==null&&wc(i,this,o,n,s)}):this._pending.push(()=>this.format(t,n,s))}removeAttribute(t){this.doc!==null?J(this.doc,n=>{pr(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?J(this.doc,s=>{So(s,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Eo(this,t)}getAttributes(){return al(this)}_write(t){t.writeTypeRef(Xf)}}const Lf=e=>new Mn;class ni{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??vt()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===$n||n.constructor===tn)&&n._start!==null)t=n._start;else for(;t!==null;){const s=t.next;if(s!==null){t=s;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class tn extends pt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new tn}clone(){const t=new tn;return t.insert(0,this.toArray().map(n=>n instanceof pt?n.clone():n)),t}get length(){return this.doc??vt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new ni(this,t)}querySelector(t){t=t.toUpperCase();const s=new ni(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t).next();return s.done?null:s.value}querySelectorAll(t){return t=t.toUpperCase(),be(new ni(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Lr(this,t,new Uf(this,n,t))}toString(){return sl(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},s){const r=t.createDocumentFragment();return s!==void 0&&s._createAssociation(r,this),ws(this,i=>{r.insertBefore(i.toDOM(t,n,s),null)}),r}insert(t,n){this.doc!==null?J(this.doc,s=>{ol(s,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)J(this.doc,s=>{const r=t&&t instanceof pt?t._item:t;fr(s,this,r,n)});else{const s=this._prelimContent,r=t===null?0:s.findIndex(i=>i===t)+1;if(r===0&&t!==null)throw Zt("Reference item not found");s.splice(r,0,...n)}}delete(t,n=1){this.doc!==null?J(this.doc,s=>{cl(s,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return nl(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return rl(this,t)}slice(t=0,n=this.length){return el(this,t,n)}forEach(t){ws(this,t)}_write(t){t.writeTypeRef(tp)}}const Pf=e=>new tn;class $n extends tn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((s,r)=>{this.setAttribute(r,s)}),this._prelimAttrs=null}_copy(){return new $n(this.nodeName)}clone(){const t=new $n(this.nodeName),n=this.getAttributes();return Ld(n,(s,r)=>{t.setAttribute(r,s)}),t.insert(0,this.toArray().map(s=>s instanceof pt?s.clone():s)),t}toString(){const t=this.getAttributes(),n=[],s=[];for(const c in t)s.push(c);s.sort();const r=s.length;for(let c=0;c<r;c++){const l=s[c];n.push(l+'="'+t[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?J(this.doc,n=>{pr(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?J(this.doc,s=>{So(s,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Eo(this,t)}hasAttribute(t){return ll(this,t)}getAttributes(t){return t?kf(this,t):al(this)}toDOM(t=document,n={},s){const r=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const c=i[o];typeof c=="string"&&r.setAttribute(o,c)}return ws(this,o=>{r.appendChild(o.toDOM(t,n,s))}),s!==void 0&&s._createAssociation(r,this),r}_write(t){t.writeTypeRef(Qf),t.writeKey(this.nodeName)}}const Nf=e=>new $n(e.readKey());class Uf extends xr{constructor(t,n,s){super(t,s),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(r=>{r===null?this.childListChanged=!0:this.attributesChanged.add(r)})}}class gr extends Qe{constructor(t){super(),this.hookName=t}_copy(){return new gr(this.hookName)}clone(){const t=new gr(this.hookName);return this.forEach((n,s)=>{t.set(s,n)}),t}toDOM(t=document,n={},s){const r=n[this.hookName];let i;return r!==void 0?i=r.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(i,this),i}_write(t){t.writeTypeRef(ep),t.writeKey(this.hookName)}}const Mf=e=>new gr(e.readKey());class Ct extends Mn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Ct}clone(){const t=new Ct;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,s){const r=t.createTextNode(this.toString());return s!==void 0&&s._createAssociation(r,this),r}toString(){return this.toDelta().map(t=>{const n=[];for(const r in t.attributes){const i=[];for(const o in t.attributes[r])i.push({key:o,value:t.attributes[r][o]});i.sort((o,c)=>o.key<c.key?-1:1),n.push({nodeName:r,attrs:i})}n.sort((r,i)=>r.nodeName<i.nodeName?-1:1);let s="";for(let r=0;r<n.length;r++){const i=n[r];s+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const c=i.attrs[o];s+=` ${c.key}="${c.value}"`}s+=">"}s+=t.insert;for(let r=n.length-1;r>=0;r--)s+=`</${n[r].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(np)}}const $f=e=>new Ct;class vo{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Yt()}mergeWith(t){return!1}write(t,n,s){throw Yt()}integrate(t,n){throw Yt()}}const Bf=0;class Bt extends vo{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ya(t.doc.store,this)}write(t,n){t.writeInfo(Bf),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Os{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Os(this.content)}splice(t){throw Yt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Vf=e=>new Os(e.readBuf());class bs{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new bs(this.len)}splice(t){const n=new bs(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){ps(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Hf=e=>new bs(e.readLen()),gl=(e,t)=>new on({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ds{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ds(gl(this.doc.guid,this.opts))}splice(t){throw Yt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Ff=e=>new Ds(gl(e.readString(),e.readAny()));class cn{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new cn(this.embed)}splice(t){throw Yt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const jf=e=>new cn(e.readJSON());class ht{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ht(this.key,this.value)}splice(t){throw Yt()}mergeWith(t){return!1}integrate(t,n){const s=n.parent;s._searchMarker=null,s._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Kf=e=>new ht(e.readKey(),e.readJSON());class mr{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new mr(this.arr)}splice(t){const n=new mr(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const s=this.arr.length;t.writeLen(s-n);for(let r=n;r<s;r++){const i=this.arr[r];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const zf=e=>{const t=e.readLen(),n=[];for(let s=0;s<t;s++){const r=e.readString();r==="undefined"?n.push(void 0):n.push(JSON.parse(r))}return new mr(n)},qf=cr("node_env")==="development";class en{constructor(t){this.arr=t,qf&&ua(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new en(this.arr)}splice(t){const n=new en(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const s=this.arr.length;t.writeLen(s-n);for(let r=n;r<s;r++){const i=this.arr[r];t.writeAny(i)}}getRef(){return 8}}const Wf=e=>{const t=e.readLen(),n=[];for(let s=0;s<t;s++)n.push(e.readAny());return new en(n)};class re{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new re(this.str)}splice(t){const n=new re(this.str.slice(t));this.str=this.str.slice(0,t);const s=this.str.charCodeAt(t-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Gf=e=>new re(e.readString()),Yf=[Af,Of,Lf,Nf,Pf,Mf,$f],Jf=0,Zf=1,Xf=2,Qf=3,tp=4,ep=5,np=6;class oe{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new oe(this.type._copy())}splice(t){throw Yt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(s=>{s.deleted?s.id.clock<(t.beforeState.get(s.id.client)||0)&&t._mergeStructs.push(s):s.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(t,!0),s=s.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const sp=e=>new oe(Yf[e.readTypeRef()](e)),Di=(e,t)=>{let n=t,s=0,r;do s>0&&(n=M(n.client,n.clock+s)),r=An(e,n),s=n.clock-r.id.clock,n=r.redone;while(n!==null&&r instanceof X);return{item:r,diff:s}},Co=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},yr=(e,t,n)=>{const{client:s,clock:r}=t.id,i=new X(M(s,r+n),t,M(s,r+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=M(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i},_c=(e,t)=>Zi(e,n=>Fn(n.deletions,t)),ml=(e,t,n,s,r,i)=>{const o=e.doc,c=o.store,l=o.clientID,u=t.redone;if(u!==null)return Tt(e,u);let a=t.parent._item,d=null,f;if(a!==null&&a.deleted===!0){if(a.redone===null&&(!n.has(a)||ml(e,a,n,s,r,i)===null))return null;for(;a.redone!==null;)a=Tt(e,a.redone)}const g=a===null?t.parent:a.content.type;if(t.parentSub===null){for(d=t.left,f=t;d!==null;){let P=d;for(;P!==null&&P.parent._item!==a;)P=P.redone===null?null:Tt(e,P.redone);if(P!==null&&P.parent._item===a){d=P;break}d=d.left}for(;f!==null;){let P=f;for(;P!==null&&P.parent._item!==a;)P=P.redone===null?null:Tt(e,P.redone);if(P!==null&&P.parent._item===a){f=P;break}f=f.right}}else if(f=null,t.right&&!r){for(d=t;d!==null&&d.right!==null&&(d.right.redone||Fn(s,d.right.id)||_c(i.undoStack,d.right.id)||_c(i.redoStack,d.right.id));)for(d=d.right;d.redone;)d=Tt(e,d.redone);if(d&&d.right!==null)return null}else d=g._map.get(t.parentSub)||null;const m=it(c,l),_=M(l,m),N=new X(_,d,d&&d.lastId,f,f&&f.id,g,t.parentSub,t.content.copy());return t.redone=_,Co(N,!0),N.integrate(e,0),N};class X extends vo{constructor(t,n,s,r,i,o,c,l){super(t,l.getLength()),this.origin=s,this.left=n,this.right=r,this.rightOrigin=i,this.parent=o,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?Wo:0}set marker(t){(this.info&Yr)>0!==t&&(this.info^=Yr)}get marker(){return(this.info&Yr)>0}get keep(){return(this.info&qo)>0}set keep(t){this.keep!==t&&(this.info^=qo)}get countable(){return(this.info&Wo)>0}get deleted(){return(this.info&Gr)>0}set deleted(t){this.deleted!==t&&(this.info^=Gr)}markDeleted(){this.info|=Gr}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=it(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=it(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===In&&this.id.client!==this.parent.client&&this.parent.clock>=it(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=dc(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Tt(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Bt||this.right&&this.right.constructor===Bt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===X?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===X&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===In){const s=An(n,this.parent);s.constructor===Bt?this.parent=null:this.parent=s.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=dc(t,t.doc.store,M(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,r;if(s!==null)r=s.right;else if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start;const i=new Set,o=new Set;for(;r!==null&&r!==this.right;){if(o.add(r),i.add(r),Sn(this.origin,r.origin)){if(r.id.client<this.id.client)s=r,i.clear();else if(Sn(this.rightOrigin,r.rightOrigin))break}else if(r.origin!==null&&o.has(An(t.doc.store,r.origin)))i.has(An(t.doc.store,r.origin))||(s=r,i.clear());else break;r=r.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ya(t.doc.store,this),this.content.integrate(t,this),fc(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Bt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:M(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Sn(t.origin,this.lastId)&&this.right===t&&Sn(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(s=>{s.p===t&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ps(t.deleteSet,this.id.client,this.id.clock,this.length),fc(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Dt();this.content.gc(t),n?cf(t,this,new Bt(this.id,this.length)):this.content=new bs(this.length)}write(t,n){const s=n>0?M(this.id.client,this.id.clock+n-1):this.origin,r=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&_r|(s===null?0:Pt)|(r===null?0:pe)|(i===null?0:is);if(t.writeInfo(o),s!==null&&t.writeLeftID(s),r!==null&&t.writeRightID(r),s===null&&r===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const u=Ka(c);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===In?(t.writeParentInfo(!1),t.writeLeftID(c)):Dt();i!==null&&t.writeString(i)}this.content.write(t,n)}}const yl=(e,t)=>rp[t&_r](e),rp=[()=>{Dt()},Hf,zf,Vf,Gf,jf,Kf,sp,Wf,Ff,()=>{Dt()}],ip=10;class Vt extends vo{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Dt()}write(t,n){t.writeInfo(ip),H(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const wl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},bl="__ $YJS$ __";wl[bl]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");wl[bl]=!0;function ko(e,t){for(const n in e){const s=e[n],r=t[n];if(_i(s)&&_i(r)){if(!ko(s,r))return!1}else if(Array.isArray(s)&&Array.isArray(r)){if(s.length!==r.length)return!1;for(let i=0;i<s.length;i++)if(s[i]!==r[i])return!1}else if(s!==r)return!1}for(const n in t)if(e[n]===void 0&&t[n]!==void 0)return!1;return!0}function op(e,...t){return Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}function cp(e,...t){return Object.fromEntries(Object.entries(e).filter(([n])=>!t.includes(n)))}function ap(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==null))}function lp(e){const t=[];for(const n of e){if(typeof n.insert=="string"&&n.insert.length===0)continue;const s=t[t.length-1];if(!s||typeof s.insert!="string"||typeof n.insert!="string"){t.push(n);continue}if(s.attributes===n.attributes||!s.attributes==!n.attributes&&ko(s.attributes??{},n.attributes??{})){s.insert+=n.insert;continue}t.push(n)}return t}function ke(e){return lp(e.toDelta())}function _l({insert:e}){return typeof e=="string"?e.length:1}function Sl(e){return e.reduce((t,n)=>t+_l(n),0)}function El(e,t,n){if(n<1)return[];let s=0;const r=[],i=t+n;for(let o=0;o<e.length&&!(s>=i);o++){const c=e[o],l=_l(c);if(s+l<=t){s+=l;continue}if(typeof c.insert!="string"){s+=l,r.push(c);continue}const u=Math.max(0,t-s),a=Math.min(l,l-(s+l-i));r.push({...c,insert:c.insert.slice(u,a)}),s+=l}return r}function fe(e){return cp(e,tt.isText(e)?"text":"children")}function vl(e){const t=ke(e),n=t.length>0?t.map(xi):[{text:""}];return{...e.getAttributes(),children:n}}function xi(e){return typeof e.insert=="string"?{...e.attributes,text:e.insert}:vl(e.insert)}function up(e){return e.map(t=>tt.isText(t)?{insert:t.text,attributes:fe(t)}:{insert:Cl(t)})}function Cl({children:e,...t}){const n=new Ct;return Object.entries(t).forEach(([s,r])=>{n.setAttribute(s,r)}),n.applyDelta(up(e),{sanitize:!1}),n}function _s(e){return e?tt.isText(e)?e.text.length:1:0}function dp(e,t){return e.children.slice(0,t).reduce((n,s)=>n+_s(s),0)}function Ut(e,t,n){if(n.length===0)throw new Error("Path has to a have a length >= 1");if(tt.isText(t))throw new Error("Cannot descent into slate text");const[s,...r]=n,i=dp(t,s),o=t.children[s],c=ke(e),l=_s(o),u=El(c,i,l);if(u.length>1)throw new Error("Path doesn't match yText, yTarget spans multiple nodes");const a=u[0]?.insert;if(r.length>0){if(!(a instanceof Ct))throw new Error("Path doesn't match yText, cannot descent into non-yText");return Ut(a,o,r)}return{yParent:e,textRange:{start:i,end:i+l},yTarget:a instanceof Ct?a:void 0,slateParent:t,slateTarget:o,targetDelta:u}}function qe(e,t,n={}){const{assoc:s=0,insert:r=!1}=n;let i=0,o=0;for(let u=0;u<e.children.length;u++){const a=e.children[u],d=tt.isText(a)?a.text.length:1;d>0&&(o=u);const f=i+d;if(d>0&&(s>=0?f>t:f>=t))return[u,t-i];i+=d}if(t>i+(r?1:0))throw new Error("yOffset out of bounds");if(r)return[e.children.length,0];const c=e.children[o],l=tt.isText(c)?c.text.length:1;return[o,l]}function kl(e,t,n){const s=[n];for(;s[0]!==e;){const{parent:i}=s[0];if(!i)throw new Error("yText isn't a descendant of root element");if(!(i instanceof Ct))throw new Error("Unexpected y parent type");s.unshift(i)}if(s.length<2)return[];let r=t;return s.reduce((i,o,c)=>{const l=s[c+1];if(!l)return i;let u=0;const a=ke(o);for(const f of a){if(f.insert===l)break;u+=typeof f.insert=="string"?f.insert.length:1}if(tt.isText(r))throw new Error("Cannot descent into slate text");const[d]=qe(r,u);return r=r.children[d],i.concat(d)},[])}function hp(e,t,n){const s=[];let r=n.reduce((i,o)=>"retain"in o?i+o.retain:"delete"in o?i+o.delete:i,0);return n.reverse().forEach(i=>{if("attributes"in i&&"retain"in i){const[o,c]=qe(e,r-i.retain),[l,u]=qe(e,r,{assoc:-1});for(let a=l;a>=o;a--){const d=e.children[a],f=[...t,a];if(!tt.isText(d))continue;const g=i.attributes,m=op(e,...Object.keys(i.attributes));if(a===o||a===l){const _=a===o?c:0,N=a===l?u:d.text.length;if(N!==d.text.length&&s.push({type:"split_node",path:f,position:N,properties:fe(d)}),_!==0){s.push({type:"split_node",path:f,position:_,properties:ap({...fe(d),...g})});continue}}s.push({type:"set_node",newProperties:g,path:f,properties:m})}}if("retain"in i&&(r-=i.retain),"delete"in i){const[o,c]=qe(e,r-i.delete),[l,u]=qe(e,r,{assoc:-1});for(let a=u===0?l-1:l;a>=o;a--){const d=e.children[a],f=[...t,a];if(tt.isText(d)&&(a===o||a===l)){const g=a===o?c:0,m=a===l?u:d.text.length;s.push({type:"remove_text",offset:g,text:d.text.slice(g,m),path:f}),r-=m-g;continue}s.push({type:"remove_node",node:d,path:f}),r-=_s(d)}return}if("insert"in i){const[o,c]=qe(e,r,{insert:!0}),l=e.children[o],u=[...t,o];if(_i(l)&&tt.isText(l)){const a=s[s.length-1],d=a!=null&&a.type==="insert_node"?a.node:fe(l);let f=[];if(a!=null&&(a.type==="insert_node"||a.type==="insert_text"||a.type==="split_node"||a.type==="set_node")&&(f=a.path),typeof i.insert=="string"&&ko(i.attributes??{},d)&&rs.equals(u,f))return s.push({type:"insert_text",offset:c,text:i.insert,path:u});const g=xi(i);return c===0?s.push({type:"insert_node",path:u,node:g}):(c<l.text.length&&s.push({type:"split_node",path:u,position:c,properties:fe(l)}),s.push({type:"insert_node",path:rs.next(u),node:g}))}return s.push({type:"insert_node",path:u,node:xi(i)})}}),s}function fp(e,t,n){const{target:s,changes:r}=n,i=n.delta;if(!(s instanceof Ct))throw new Error("Unexpected target node type");const o=[],c=kl(e,t,s),l=tt.get(t,c);if(tt.isText(l))throw new Error("Cannot apply yTextEvent to text node");const u=Array.from(r.keys.entries());if(c.length>0&&u.length>0){const a=Object.fromEntries(u.map(([f,g])=>[f,g.action==="delete"?null:s.getAttribute(f)])),d=Object.fromEntries(u.map(([f])=>[f,l[f]]));o.push({type:"set_node",newProperties:a,properties:d,path:c})}return i.length>0&&o.push(...hp(l,c,i)),o}function pp(e,t,n){if(n instanceof pl)return fp(e,t,n);throw new Error("Unexpected Y event type")}function gp(e,t,n){rr.withoutNormalizing(t,()=>{n.forEach(s=>{pp(e,t,s).forEach(r=>{t.apply(r)})})})}function mp(e,t,n){const{yParent:s,textRange:r}=Ut(e,t,n.path);if(tt.isText(n.node))return s.insert(r.start,n.node.text,fe(n.node));s.insertEmbed(r.start,Cl(n.node))}function Pr(e){return e.map(t=>typeof t.insert=="string"?t:{...t,insert:yp(t.insert)})}function yp(e){const t=new Ct,n=e.getAttributes();return Object.entries(n).forEach(([s,r])=>{t.setAttribute(s,r)}),t.applyDelta(Pr(ke(e)),{sanitize:!1}),t}function Ss(e){if(!e.doc)throw new Error("shared type isn't attached to a document")}const nn="__slateYjsStoredPosition_";function Ri(e,t,n){const{yTarget:s,yParent:r,textRange:i}=Ut(e,t,n.path);if(s)throw new Error("Slate point points to a non-text element inside sharedRoot");const o=i.start+n.offset;return za(r,o,o===i.end?-1:0)}function wp(e,t,{type:n,index:s,assoc:r}){if(!(n instanceof Ct))throw new Error("Absolute position points to a non-XMLText");const i=kl(e,t,n),o=tt.get(t,i);if(tt.isText(o))throw new Error("Absolute position doesn't match slateRoot, cannot descent into text");const[c,l]=qe(o,s,{assoc:r}),u=o.children[c];return tt.isText(u)?{path:[...i,c],offset:l}:null}function Li(e,t,n){if(!e.doc)throw new Error("sharedRoot isn't attach to a yDoc");const s=Wa(n,e.doc);return s&&wp(e,t,s)}function bp(e,t){const n=e.getAttribute(nn+t);return n?qa(n):null}function _p(e){return Object.fromEntries(Object.entries(e.getAttributes()).filter(([t])=>t.startsWith(nn)).map(([t,n])=>[t.slice(nn.length),Jh(n)]))}function Sp(e){return Ss(e),Object.fromEntries(Object.entries(e.getAttributes()).filter(([t])=>t.startsWith(nn)).map(([t,n])=>[t.slice(nn.length),Wa(qa(n),e.doc)]).filter(([,t])=>t))}function Ep(e,t){e.removeAttribute(nn+t)}function Il(e,t,n){e.setAttribute(nn+t,tf(n))}function Al(e,t,n){return Object.fromEntries(Object.entries(e).filter(([,s])=>s.type!==t?!1:n?s.assoc>=0?s.index>=n.start&&s.index<n.end:s.index>n.start&&s.index>=n.end:!0))}function Tl(e,t,n=""){const s={[n]:Al(e,t)};return ke(t).forEach(({insert:i},o)=>{i instanceof Ct&&Object.assign(s,Tl(e,i,n?`${n}.${o}`:o.toString()))}),s}function Io(e,t,n,s=0){const r=Sp(e),i={"":Al(r,t,{start:s,end:s+Sl(n)})};return n.forEach(({insert:o},c)=>{o instanceof Ct&&Object.assign(i,Tl(r,o,c.toString()))}),i}function Nr(e,t,n,s,r=0,i=0,o=""){const c=n[o];c&&Object.entries(c).forEach(([l,u])=>{Il(e,l,za(t,u.index-i+r,u.assoc))}),s.forEach(({insert:l},u)=>{l instanceof Ct&&Nr(e,l,n,ke(l),0,0,o?`${o}.${u}`:u.toString())})}function si(e,t,n){return{anchor:Ri(e,t,n.anchor),focus:Ri(e,t,n.focus)}}function vp(e,t,n){const s=Li(e,t,n.anchor);if(!s)return null;const r=Li(e,t,n.focus);return r?{anchor:s,focus:r}:null}function Cp(e,t,n){const s=Ut(e,t,n.path),r=Ut(s.yParent,s.slateParent,rs.previous(n.path.slice(-1)));if(!s.yTarget!=!r.yTarget)throw new Error("Cannot merge y text with y element");if(!r.yTarget||!s.yTarget){const{yParent:a,textRange:d,slateTarget:f}=s;if(!f)throw new Error("Expected Slate target node for merge op.");const g=tt.get(t,rs.previous(n.path));if(!tt.isText(g))throw new Error("Path points to Y.Text but not a Slate text node.");const m=fe(f),_=fe(g),N=Object.keys(m).reduce((P,v)=>v in _?P:{...P,[v]:null},{});return a.format(d.start,d.end-d.start,{...N,..._})}const i=r.yTarget.length,o=ke(s.yTarget),c=Pr(o),l=Io(e,s.yTarget,o,i),u=[{retain:i},...c];r.yTarget.applyDelta(u,{sanitize:!1}),s.yParent.delete(s.textRange.start,s.textRange.end-s.textRange.start),Nr(e,r.yTarget,l,c,i)}function kp(e,t,n){const s=rs.parent(n.newPath),r=n.newPath[n.newPath.length-1],i=tt.get(t,s);if(tt.isText(i))throw new Error("Cannot move slate node into text element");const o=[...s,Math.min(r,i.children.length)],c=Ut(e,t,n.path),l=Ut(e,t,o),u=Pr(c.targetDelta),a=Io(e,c.yParent,c.targetDelta);c.yParent.delete(c.textRange.start,c.textRange.end-c.textRange.start);const d=Sl(ke(l.yParent)),f=Math.min(l.textRange.start,d),g=[{retain:f},...u];l.yParent.applyDelta(g,{sanitize:!1}),Nr(e,l.yParent,a,u,f,c.textRange.start)}function Ip(e,t,n){const{yParent:s,textRange:r}=Ut(e,t,n.path);s.delete(r.start,r.end-r.start)}function Ap(e,t,n){const{yTarget:s,textRange:r,yParent:i}=Ut(e,t,n.path);if(s)return Object.entries(n.newProperties).forEach(([l,u])=>{if(u===null)return s.removeAttribute(l);s.setAttribute(l,u)}),Object.entries(n.properties).forEach(([l])=>{Object.prototype.hasOwnProperty.call(n.newProperties,l)||s.removeAttribute(l)});const c={...Object.fromEntries(Object.keys(n.properties).map(l=>[l,null])),...n.newProperties};i.format(r.start,r.end-r.start,c)}function Tp(e,t,n){const s=Ut(e,t,n.path);if(!s.slateTarget)throw new Error("Y target without corresponding slate node");if(!s.yTarget){if(!tt.isText(s.slateTarget))throw new Error("Mismatch node type between y target and slate node");const d={};return s.targetDelta.forEach(f=>{f.attributes&&Object.keys(f.attributes).forEach(g=>{d[g]=null})}),s.yParent.format(s.textRange.start,s.textRange.end-s.textRange.start,{...d,...n.properties})}if(tt.isText(s.slateTarget))throw new Error("Mismatch node type between y target and slate node");const r=Ut(s.yTarget,s.slateTarget,[n.position]),i=s.slateTarget.children.slice(0,n.position).reduce((d,f)=>d+_s(f),0),o=s.slateTarget.children.reduce((d,f)=>d+_s(f),0),c=El(ke(s.yTarget),i,o-i),l=Pr(c),u=Io(e,s.yTarget,c,i),a=new Ct;a.applyDelta(l,{sanitize:!1}),Object.entries(n.properties).forEach(([d,f])=>{a.setAttribute(d,f)}),s.yTarget.delete(r.textRange.start,s.yTarget.length-r.textRange.start),s.yParent.insertEmbed(s.textRange.end,a),Nr(e,a,u,l,0,i)}const Op={insert_node:mp,remove_node:Ip,set_node:Ap,merge_node:Cp,move_node:kp,split_node:Tp};function Dp(e,t,n){const{yParent:s,textRange:r}=Ut(e,t,n.path),i=tt.get(t,n.path);if(!tt.isText(i))throw new Error("Cannot insert text into non-text node");s.insert(r.start+n.offset,n.text,fe(i))}function xp(e,t,n){const{yParent:s,textRange:r}=Ut(e,t,n.path);s.delete(r.start+n.offset,n.text.length)}const Rp={insert_text:Dp,remove_text:xp},Lp=()=>{},Pp={...Rp,...Op,set_selection:Lp};function Np(e,t,n){const s=Pp[n.type];if(!s)throw new Error(`Unknown operation: ${n.type}`);s(e,t,n)}const Up=Symbol("slate-yjs-operation"),Mp=Symbol("slate-yjs-position-storage"),ri=new WeakMap,Pi=new WeakSet,Wt={isYjsEditor(e){return rr.isEditor(e)&&e.sharedRoot instanceof Ct&&"localOrigin"in e&&"positionStorageOrigin"in e&&typeof e.applyRemoteEvents=="function"&&typeof e.isLocalOrigin=="function"&&typeof e.connect=="function"&&typeof e.disconnect=="function"},applyRemoteEvents(e,t,n){e.applyRemoteEvents(t,n)},connected(e){return Pi.has(e)},connect(e){e.connect()},disconnect(e){e.disconnect()},isLocal(e){return e.isLocalOrigin(Wt.origin(e))},origin(e){const t=ri.get(e);return t!==void 0?t:e.localOrigin},withOrigin(e,t,n){const s=Wt.origin(e);ri.set(e,t),n(),ri.set(e,s)},storePosition(e,t,n){const{sharedRoot:s,positionStorageOrigin:r}=e;Ss(s);const i=Ri(s,e,n);s.doc.transact(()=>{Il(s,t,i)},r)},removeStoredPosition(e,t){const{sharedRoot:n,positionStorageOrigin:s}=e;Ss(n),n.doc.transact(()=>{Ep(n,t)},s)},position(e,t){const n=bp(e.sharedRoot,t);if(n)return Li(e.sharedRoot,e,n)},storedPositionsRelative(e){return _p(e.sharedRoot)}};function i1(e,t,{localOrigin:n,positionStorageOrigin:s,autoConnect:r=!1}={}){const i=e;i.sharedRoot=t,i.localOrigin=n??Up,i.positionStorageOrigin=s??Mp,i.applyRemoteEvents=(u,a)=>{rr.withoutNormalizing(i,()=>{Wt.withOrigin(i,a,()=>{gp(i.sharedRoot,i,u)})})},i.isLocalOrigin=u=>u===i.localOrigin;const o=(u,a)=>{i.isLocalOrigin(a.origin)||Wt.applyRemoteEvents(i,u,a.origin)};let c=null;r&&(c=setTimeout(()=>{c=null,Wt.connect(i)})),i.connect=()=>{if(Wt.connected(i))throw new Error("already connected");i.sharedRoot.observeDeep(o);const u=vl(i.sharedRoot);i.children=u.children,Pi.add(i),rr.normalize(e,{force:!0}),e.operations.length||e.onChange()},i.disconnect=()=>{c&&clearTimeout(c),i.sharedRoot.unobserveDeep(o),Pi.delete(i)};const{apply:l}=i;return i.apply=u=>{Wt.connected(i)&&Wt.isLocal(i)&&(Ss(i.sharedRoot),i.sharedRoot.doc.transact(()=>{Ss(i.sharedRoot),Np(i.sharedRoot,e,u)},Wt.origin(i))),l(u)},i}const Sc=new WeakMap,$p=Symbol("slate-yjs-history-without-saving");function o1(e,{withoutSavingOrigin:t=$p,trackedOrigins:n=new Set([e.localOrigin]),...s}={}){const r=e,i=new hf(r.sharedRoot,{trackedOrigins:n,...s});r.undoManager=i,r.withoutSavingOrigin=t;const{onChange:o,isLocalOrigin:c}=r;r.onChange=()=>{o(),Sc.set(r,r.selection&&si(r.sharedRoot,r,r.selection))},r.isLocalOrigin=g=>g===r.withoutSavingOrigin||c(g);const l=({stackItem:g})=>{setTimeout(()=>{g.meta.set("selection",r.selection&&si(r.sharedRoot,r,r.selection)),g.meta.set("selectionBefore",Sc.get(r))})},u=({stackItem:g})=>{setTimeout(()=>{g.meta.set("selection",r.selection&&si(r.sharedRoot,r,r.selection))})},a=({stackItem:g,type:m})=>{const _=m==="undo"?r.undoManager.redoStack:r.undoManager.undoStack,N=_[_.length-1];N&&(N.meta.set("selection",g.meta.get("selectionBefore")),N.meta.set("selectionBefore",g.meta.get("selection")));const P=g.meta.get("selectionBefore");if(!P)return;const v=vp(r.sharedRoot,r,P);v&&Hu.isLocation(v)&&Fu.select(r,v)},{connect:d,disconnect:f}=r;return r.connect=()=>{d(),r.undoManager.on("stack-item-added",l),r.undoManager.on("stack-item-popped",a),r.undoManager.on("stack-item-updated",u)},r.disconnect=()=>{r.undoManager.off("stack-item-added",l),r.undoManager.off("stack-item-popped",a),r.undoManager.off("stack-item-updated",u),f()},r.undo=()=>{Wt.connected(r)&&r.undoManager.undo()},r.redo=()=>{Wt.connected(r)&&r.undoManager.redo()},r}var Bp=Object.defineProperty,Vp=(e,t)=>{for(var n in t)Bp(e,n,{get:t[n],enumerable:!0})},Hp="@liveblocks/core",Ur="3.13.4",Fp="esm",zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},jp="https://liveblocks.io/docs/errors/dupes",Kp=" ";function zp(e){console.error(e)}function Ao(e,t,n){const s=Symbol.for(e),r=`${t} (${n})`;if(!zs[s])zs[s]=r;else if(zs[s]!==r){const i=[`Multiple copies of Liveblocks are being loaded in your project. This will cause issues! See ${jp+Kp}`,"","Conflicts:",`- ${e} ${zs[s]} (already loaded)`,`- ${e} ${r} (trying to load this now)`].join(`
`);zp(i)}}function Y(){const e=new Set;function t(o){return e.add(o),()=>e.delete(o)}function n(o){const c=t(l=>(c(),o(l)));return c}async function s(o){let c;return new Promise(l=>{c=t(u=>{(o===void 0||o(u))&&l(u)})}).finally(()=>c?.())}function r(o){let c=!1;for(const l of e)l(o),c=!0;return c}function i(){return e.size}return{notify:r,subscribe:t,subscribeOnce:n,count:i,waitUntil:s,dispose(){e.clear()},observable:{subscribe:t,subscribeOnce:n,waitUntil:s}}}function qp(){const e=Y();let t=null;function n(){t=[]}function s(){if(t!==null){for(const i of t)e.notify(i);t=null}}function r(i){return t!==null?(t.push(i),!1):e.notify(i)}return{...e,notify:r,pause:n,unpause:s,dispose(){e.dispose(),t!==null&&(t.length=0)}}}var Ue=(e=>e);function Xt(e){throw new Error(e)}function Ol(e){return Object.entries(e)}function Wp(e,t){return typeof t<"u"?Object.create(e,t):Object.create(e)}function ge(e){try{return JSON.parse(e)}catch{return}}function Es(e){return JSON.parse(JSON.stringify(e))}function Gp(e){try{const t=e.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(t).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch{return atob(e)}}function Ni(e){return e.filter(t=>t!=null)}function Mr(e){const t={...e};return Object.keys(e).forEach(n=>{const s=n;t[s]===void 0&&delete t[s]}),t}function Yp(e){return new Promise(t=>setTimeout(t,e))}async function Ec(e,t,n){let s;const r=new Promise((i,o)=>{s=setTimeout(()=>{o(new Error(n))},t)});return Promise.race([e,r]).finally(()=>clearTimeout(s))}function vc(e){let t=null;return()=>(t===null&&(t=e().catch(n=>{throw setTimeout(()=>{t=null},5e3),n})),t)}function Jp(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n],n,e))return n;return-1}function Zp(e,t){const n=[],s=[];let r=0;for(const i of e)t(i,r++)?n.push(i):s.push(i);return[n,s]}var je=Symbol("kSinks"),wr=Symbol("kTrigger"),En=null,We=null;function Me(e){if(En!==null){e();return}En=new Set;try{e()}finally{for(const t of En)t[wr]();En=null}}function To(e){En||Xt("Expected to be in an active batch"),En.add(e)}function Dl(e,t){let n=!1;const s={...e};return Object.keys(t).forEach(r=>{const i=r,o=t[i];s[i]!==o&&(o===void 0?delete s[i]:s[i]=o,n=!0)}),n?s:e}var Oo=class{equals;#t;[je];constructor(e){this.equals=e??Object.is,this.#t=Y(),this[je]=new Set,this.get=this.get.bind(this),this.subscribe=this.subscribe.bind(this),this.subscribeOnce=this.subscribeOnce.bind(this)}dispose(){this.#t.dispose(),this.#t="(disposed)",this.equals="(disposed)"}get hasWatchers(){if(this.#t.count()>0)return!0;for(const e of this[je])if(e.hasWatchers)return!0;return!1}[wr](){this.#t.notify();for(const e of this[je])To(e)}subscribe(e){return this.#t.count()===0&&this.get(),this.#t.subscribe(e)}subscribeOnce(e){const t=this.subscribe(()=>(t(),e()));return t}waitUntil(){throw new Error("waitUntil not supported on Signals")}markSinksDirty(){for(const e of this[je])e.markDirty()}addSink(e){this[je].add(e)}removeSink(e){this[je].delete(e)}asReadonly(){return this}},Nt=class extends Oo{#t;constructor(e,t){super(t),this.#t=Ue(e)}dispose(){super.dispose(),this.#t="(disposed)"}get(){return We?.add(this),this.#t}set(e){Me(()=>{typeof e=="function"&&(e=e(this.#t)),this.equals(this.#t,e)||(this.#t=Ue(e),this.markSinksDirty(),To(this))})}},Xp=class extends Nt{constructor(e){super(Ue(Mr(e)))}set(){throw new Error("Don't call .set() directly, use .patch()")}patch(e){super.set(t=>Dl(t,e))}},Qp=Symbol(),me=class Ui extends Oo{#t;#e;#n;#s;#i;static from(...t){const n=t.pop();if(typeof n!="function"&&Xt("Invalid .from() call, last argument expected to be a function"),typeof t[t.length-1]=="function"){const s=n,r=t.pop();return new Ui(t,r,s)}else{const s=n;return new Ui(t,s)}}constructor(t,n,s){super(s),this.#e=!0,this.#t=Qp,this.#s=t,this.#n=new Set,this.#i=n}dispose(){for(const t of this.#n)t.removeSink(this);this.#t="(disposed)",this.#n="(disposed)",this.#s="(disposed)",this.#i="(disposed)"}get isDirty(){return this.#e}#r(){const t=We;let n;We=new Set;try{n=this.#i(...this.#s.map(s=>s.get()))}finally{const s=this.#n;this.#n=new Set;for(const r of We)this.#n.add(r),s.delete(r);for(const r of s)r.removeSink(this);for(const r of this.#n)r.addSink(this);We=t}return this.#e=!1,this.equals(this.#t,n)?!1:(this.#t=n,!0)}markDirty(){this.#e||(this.#e=!0,this.markSinksDirty())}get(){return this.#e&&this.#r(),We?.add(this),this.#t}[wr](){if(!this.hasWatchers)return;this.#r()&&super[wr]()}},Bn=class extends Oo{#t;constructor(e){super(),this.#t=e}dispose(){super.dispose(),this.#t="(disposed)"}get(){return We?.add(this),this.#t}mutate(e){Me(()=>{const t=e?e(this.#t):!0;t!==null&&typeof t=="object"&&"then"in t&&Xt("MutableSignal.mutate() does not support async callbacks"),t!==!1&&(this.markSinksDirty(),To(this))})}};function tg(e,t,n){let s=0,r=e.length;for(;s<r;){const i=s+(r-s>>1);n(t,e[i])?r=i:s=i+1}return s}var Zn=class Xn{#t;#e;constructor(t,n){this.#e=n,this.#t=t}static with(t){return Xn.fromAlreadySorted([],t)}static from(t,n){const s=new Xn([],n);for(const r of t)s.add(r);return s}static fromAlreadySorted(t,n){return new Xn(t,n)}clone(){return new Xn(this.#t.slice(),this.#e)}add(t){const n=tg(this.#t,t,this.#e);this.#t.splice(n,0,t)}clear(){const t=this.#t.length>0;return this.#t.length=0,t}removeBy(t,n=Number.POSITIVE_INFINITY){let s=0;for(let r=0;r<this.#t.length;r++)if(t(this.#t[r])){if(this.#t.splice(r,1),s++,s>=n)break;r--}return s>0}remove(t){const n=this.#t.indexOf(t);return n>=0?(this.#t.splice(n,1),!0):!1}at(t){return this.#t[t]}get length(){return this.#t.length}*filter(t){for(const n of this.#t)t(n)&&(yield n)}*findAllRight(t){for(let n=this.#t.length-1;n>=0;n--){const s=this.#t[n];t(s,n)&&(yield s)}}[Symbol.iterator](){return this.#t[Symbol.iterator]()}*iterReversed(){for(let t=this.#t.length-1;t>=0;t--)yield this.#t[t]}find(t,n){const s=this.findIndex(t,n);return s>-1?this.#t.at(s):void 0}findIndex(t,n=0){for(let s=Math.max(0,n);s<this.#t.length;s++)if(t(this.#t[s],s))return s;return-1}findRight(t,n){const s=this.findIndexRight(t,n);return s>-1?this.#t.at(s):void 0}findIndexRight(t,n=this.#t.length-1){for(let s=Math.min(n,this.#t.length-1);s>=0;s--)if(t(this.#t[s],s))return s;return-1}get rawArray(){return this.#t}},eg=class{#t;#e;signal;constructor(){this.#t=new Map,this.#e=Zn.from([],(e,t)=>{const n=t.lastMessageAt??t.createdAt,s=e.lastMessageAt??e.createdAt;return n<s?!0:n===s?t.id<e.id:!1}),this.signal=new Bn(this)}getEvenIfDeleted(e){return this.signal.get(),this.#t.get(e)}markDeleted(e){const t=this.#t.get(e);t===void 0||t.deletedAt!==void 0||this.upsert({...t,deletedAt:new Date().toISOString()})}upsert(e){this.signal.mutate(()=>{const t=this.#t.get(e.id);if(t!==void 0){if(t.deletedAt!==void 0)return!1;this.#e.remove(t),this.#t.delete(t.id)}return e.deletedAt===void 0&&this.#e.add(e),this.#t.set(e.id,e),!0})}findMany(e){return Array.from(this.#e.filter(t=>{if(e.metadata===void 0)return!0;for(const[n,s]of Object.entries(e.metadata))if(s===null){if(n in t.metadata)return!1}else if(typeof s=="string"){if(t.metadata[n]!==s)return!1}else{const r=t.metadata[n];if(!Array.isArray(r)||!s.every(i=>r.includes(i)))return!1}return!0}))}};function Mi(e){const t=e.editedAt?new Date(e.editedAt):void 0,n=new Date(e.createdAt),s=e.reactions.map(r=>({...r,createdAt:new Date(r.createdAt)}));if(e.body)return{...e,reactions:s,createdAt:n,editedAt:t};{const r=new Date(e.deletedAt);return{...e,reactions:s,createdAt:n,editedAt:t,deletedAt:r}}}function Ae(e){const t=new Date(e.createdAt),n=new Date(e.updatedAt),s=e.comments.map(r=>Mi(r));return{...e,createdAt:t,updatedAt:n,comments:s}}function ng(e){return{...e,createdAt:new Date(e.createdAt)}}function Ke(e){const t=new Date(e.notifiedAt),n=e.readAt?new Date(e.readAt):null;if("activities"in e){const s=e.activities.map(r=>({...r,createdAt:new Date(r.createdAt)}));return{...e,notifiedAt:t,readAt:n,activities:s}}return{...e,notifiedAt:t,readAt:n}}function Te(e){const t=new Date(e.createdAt);return{...e,createdAt:t}}function ii(e){const t=new Date(e.deletedAt);return{...e,deletedAt:t}}function oi(e){const t=new Date(e.deletedAt);return{...e,deletedAt:t}}function ci(e){const t=new Date(e.deletedAt);return{...e,deletedAt:t}}function Cc(e){const t=new Date(e.createdAt),n=new Date(e.updatedAt),s=e.members.map(r=>({...r,addedAt:new Date(r.addedAt)}));return{...e,createdAt:t,updatedAt:n,members:s}}function Et(e,t){throw new Error(t)}function V(e,t="Expected value to be non-nullable"){return e}var sg={};Vp(sg,{error:()=>Ee,errorWithTitle:()=>Pl,warn:()=>_t,warnWithTitle:()=>ig});var xl="background:#0e0d12;border-radius:9999px;color:#fff;padding:3px 7px;font-family:sans-serif;font-weight:600;",rg="font-weight:600";function Rl(e){return typeof window>"u"?console[e]:((t,...n)=>console[e]("%cLiveblocks",xl,t,...n))}var _t=Rl("warn"),Ee=Rl("error");function Ll(e){return typeof window>"u"?console[e]:((t,n,...s)=>console[e](`%cLiveblocks%c ${t}`,xl,rg,n,...s))}var ig=Ll("warn"),Pl=Ll("error");function og(e){return e!=null}function ie(e){return e!==null&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"}function kc(e){return ie(e)&&typeof e.startsWith=="string"}function Ic(e){return ie(e)&&(typeof e.lt=="number"||typeof e.gt=="number"||typeof e.lte=="number"||typeof e.gte=="number")}var br=class Nl extends Error{response;details;constructor(t,n,s){super(t),this.name="HttpError",this.response=n,this.details=s}static async fromResponse(t){let n;try{n=await t.text()}catch{}const s=n?ge(n):void 0;let r;ie(s)&&(r=s);let i="";i||=typeof r?.message=="string"?r.message:"",i||=typeof r?.error=="string"?r.error:"",s===void 0&&(i||=n||""),i||=t.statusText;let o;try{o=new URL(t.url).pathname}catch{}i+=o!==void 0?` (got status ${t.status} from ${o})`:` (got status ${t.status})`;const c=r;return new Nl(i,t,c)}get status(){return this.response.status}},cg=e=>e instanceof br&&e.status>=400&&e.status<500;async function ai(e,t,n,s=cg){const r=n.length>0?n[n.length-1]:0;let i=0;for(;;){i++;try{return await e()}catch(c){if(s(c))throw c;if(i>=t)throw new Error(`Failed after ${t} attempts: ${String(c)}`)}const o=n[i-1]??r;_t(`Attempt ${i} was unsuccessful. Retrying in ${o} milliseconds.`),await Yp(o)}}function Ul(){let e,t;return[new Promise((s,r)=>{e=s,t=r}),e,t]}function Do(){const[e,t,n]=Ul();return{promise:e,resolve:t,reject:n}}function ag(e,t){return t!==null&&typeof t=="object"&&!Array.isArray(t)?Object.keys(t).sort().reduce((n,s)=>(n[s]=t[s],n),{}):t}function $i(e){return JSON.stringify(e,ag)}function ye(e){try{return JSON.stringify(e)}catch(t){throw console.error(`Could not stringify: ${t.message}`),console.error(e),t}}var lg=50,ug=class{input;resolve;reject;promise;constructor(e){this.input=e;const{promise:t,resolve:n,reject:s}=Do();this.promise=t,this.resolve=n,this.reject=s}},Le=class{#t=[];#e;#n;#s;#i;error=!1;constructor(e,t){this.#e=e,this.#n=t.size??lg,this.#s=t.delay}#r(){this.#i!==void 0&&(clearTimeout(this.#i),this.#i=void 0)}#o(){this.#t.length===this.#n?this.#c():this.#t.length===1&&(this.#r(),this.#i=setTimeout(()=>{this.#c()},this.#s))}async#c(){if(this.#t.length===0)return;const e=this.#t.splice(0),t=e.map(n=>n.input);try{const n=await this.#e(t);this.error=!1,e.forEach((s,r)=>{const i=n?.[r];Array.isArray(n)?e.length!==n.length?s.reject(new Error(`Callback must return an array of the same length as the number of provided items. Expected ${e.length}, but got ${n.length}.`)):i instanceof Error?s.reject(i):s.resolve(i):s.reject(new Error("Callback must return an array."))})}catch(n){this.error=!0,e.forEach(s=>{s.reject(n)})}}get(e){const t=this.#t.find(s=>$i(s.input)===$i(e));if(t)return t.promise;const n=new ug(e);return this.#t.push(n),this.#o(),n.promise}clear(){this.#t=[],this.error=!1,this.#r()}};function Tn(e){const t=new Bn(new Map);function n(a){return $i(a)}function s(a){t.mutate(d=>{if(Array.isArray(a))for(const f of a)d.set(f.key,f.state);else d.set(a.key,a.state)})}function r(a){t.mutate(d=>{if(Array.isArray(a))for(const f of a)d.delete(n(f));else d.clear()})}async function i(a){const d=n(a);if(!t.get().has(d))try{s({key:d,state:{isLoading:!0}});const g=await e.get(a);s({key:d,state:{isLoading:!1,data:g}})}catch(g){s({key:d,state:{isLoading:!1,error:g}})}}function o(a){s(a.map(d=>({key:n(d[0]),state:{isLoading:!1,data:d[1]}})))}function c(a){const d=n(a);return t.get().get(d)}function l(a){const d=n(a);return t.get().get(d)?.data}function u(){return[...t.get().keys()]}return{subscribe:t.subscribe,enqueue:i,setData:o,getItemState:c,getData:l,invalidate:r,batch:e,_cacheKeys:u}}function dg(e,t){const n=[];for(let s=0,r=e.length;s<r;s+=t)n.push(e.slice(s,s+t));return n}var $e=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>t+=(n&=63)<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-",""),hg="th",fg="cm",pg="at";function xo(e){return`${e}_${$e()}`}function gg(){return xo(hg)}function Ac(){return xo(fg)}function mg(){return xo(pg)}var Ht=class extends Map{#t;constructor(e,t){super(t),this.#t=e}getOrCreate(e,t){if(super.has(e))return super.get(e);{const s=(t??this.#t??Xt("DefaultMap used without a factory function"))(e);return this.set(e,s),s}}},yg=/^[a-zA-Z_][a-zA-Z0-9_]*$/;function gn(e){let t=[];const n=Object.entries(e),s=[],r=[],i=[];return n.forEach(([o,c])=>{if(!yg.test(o))throw new Error("Key must only contain letters, numbers, _");Dc(c)?s.push([o,c]):ie(c)&&(kc(c)||Ic(c)?r.push([o,c]):i.push([o,c]))}),t=[...Tc(s),...Oc(r)],i.forEach(([o,c])=>{const l=Object.entries(c),u=[],a=[];l.forEach(([d,f])=>{if(wg(d))throw new Error("Key cannot be empty");Dc(f)?u.push([xc(o,d),f]):(kc(f)||Ic(f))&&a.push([xc(o,d),f])}),t=[...t,...Tc(u),...Oc(a)]}),t.map(({key:o,operator:c,value:l})=>`${o}${c}${Ml(l)}`).join(" ")}var Tc=e=>{const t=[];return e.forEach(([n,s])=>{t.push({key:n,operator:":",value:s})}),t},Oc=e=>{const t=[];return e.forEach(([n,s])=>{"startsWith"in s&&typeof s.startsWith=="string"&&t.push({key:n,operator:"^",value:s.startsWith}),"lt"in s&&typeof s.lt=="number"&&t.push({key:n,operator:"<",value:s.lt}),"gt"in s&&typeof s.gt=="number"&&t.push({key:n,operator:">",value:s.gt}),"gte"in s&&typeof s.gte=="number"&&t.push({key:n,operator:">=",value:s.gte}),"lte"in s&&typeof s.lte=="number"&&t.push({key:n,operator:"<=",value:s.lte})}),t},Dc=e=>typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null,xc=(e,t)=>t?`${e}[${Ml(t)}]`:e,wg=e=>!e||e.toString().trim()==="";function Ml(e){const t=JSON.stringify(e);return typeof e!="string"||t.includes("'")?t:`'${t.slice(1,-1).replace(/\\"/g,'"')}'`}function bg(e){const t=new URLSearchParams;for(const[n,s]of Object.entries(e))s!=null&&t.set(n,s.toString());return t}function _g(e,t,n){const s=new URL(t,e);return n!==void 0&&(s.search=(n instanceof URLSearchParams?n:bg(n)).toString()),s.toString()}function D(e,...t){return e.reduce((n,s,r)=>n+encodeURIComponent(t[r-1]??"")+s)}function Sg({baseUrl:e,authManager:t,currentUserId:n,fetchPolyfill:s}){const r=new Eg(e,s);async function i(p){const S=await r.get(D`/v2/c/rooms/${p.roomId}/threads/delta`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{since:p.since.toISOString()},{signal:p.signal});return{threads:{updated:S.data.map(Ae),deleted:S.deletedThreads.map(ii)},inboxNotifications:{updated:S.inboxNotifications.map(Ke),deleted:S.deletedInboxNotifications.map(oi)},subscriptions:{updated:S.subscriptions.map(Te),deleted:S.deletedSubscriptions.map(ci)},requestedAt:new Date(S.meta.requestedAt),permissionHints:S.meta.permissionHints}}async function o(p){let S;p.query&&(S=gn(p.query));const I=50;try{const T=await r.get(D`/v2/c/rooms/${p.roomId}/threads`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{cursor:p.cursor,query:S,limit:I});return{threads:T.data.map(Ae),inboxNotifications:T.inboxNotifications.map(Ke),subscriptions:T.subscriptions.map(Te),nextCursor:T.meta.nextCursor,requestedAt:new Date(T.meta.requestedAt),permissionHints:T.meta.permissionHints}}catch(T){if(T instanceof br&&T.status===404)return{threads:[],inboxNotifications:[],subscriptions:[],nextCursor:null,requestedAt:new Date(Date.now()-360*60*1e3),permissionHints:{}};throw T}}async function c(p,S){return await r.get(D`/v2/c/rooms/${p.roomId}/threads/comments/search`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{text:p.query.text,query:gn({threadMetadata:p.query.threadMetadata,threadResolved:p.query.threadResolved,hasAttachments:p.query.hasAttachments,hasMentions:p.query.hasMentions})},{signal:S?.signal})}async function l(p){const S=p.commentId??Ac(),I=p.threadId??gg(),T=await r.post(D`/v2/c/rooms/${p.roomId}/threads`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{id:I,comment:{id:S,body:p.body,metadata:p.commentMetadata,attachmentIds:p.attachmentIds},metadata:p.metadata});return Ae(T)}async function u(p){await r.delete(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function a(p){const S=await r.rawGet(D`/v2/c/rooms/${p.roomId}/thread-with-notification/${p.threadId}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}));if(S.ok){const I=await S.json();return{thread:Ae(I.thread),inboxNotification:I.inboxNotification?Ke(I.inboxNotification):void 0,subscription:I.subscription?Te(I.subscription):void 0}}else{if(S.status===404)return{thread:void 0,inboxNotification:void 0,subscription:void 0};throw new Error(`There was an error while getting thread ${p.threadId}.`)}}async function d(p){return await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/metadata`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),p.metadata)}async function f(p){return await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/comments/${p.commentId}/metadata`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),p.metadata)}async function g(p){const S=p.commentId??Ac(),I=await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/comments`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{id:S,body:p.body,metadata:p.metadata,attachmentIds:p.attachmentIds});return Mi(I)}async function m(p){const S=await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/comments/${p.commentId}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{body:p.body,attachmentIds:p.attachmentIds,metadata:p.metadata});return Mi(S)}async function _(p){await r.delete(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/comments/${p.commentId}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function N(p){const S=await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/comments/${p.commentId}/reactions`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{emoji:p.emoji});return ng(S)}async function P(p){await r.delete(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/comments/${p.commentId}/reactions/${p.emoji}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function v(p){await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/mark-as-resolved`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function U(p){await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/mark-as-unresolved`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function w(p){const S=await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/subscribe`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}));return Te(S)}async function k(p){await r.post(D`/v2/c/rooms/${p.roomId}/threads/${p.threadId}/unsubscribe`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function x(p){const S=p.roomId,I=p.signal,T=p.attachment,ut=I?new DOMException(`Upload of attachment ${p.attachment.id} was aborted.`,"AbortError"):void 0;if(I?.aborted)throw ut;const St=st=>{if(I?.aborted)throw ut;if(st instanceof br&&st.status===413)throw st;return!1},Ie=5*1024*1024,jt=10,Kt=[2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3,2e3];function ce(st){const $t=[];let ae=0;for(;ae<st.size;){const zt=Math.min(ae+Ie,st.size);$t.push({partNumber:$t.length+1,part:st.slice(ae,zt)}),ae=zt}return $t}if(T.size<=Ie)return ai(async()=>r.putBlob(D`/v2/c/rooms/${S}/attachments/${T.id}/upload/${encodeURIComponent(T.name)}`,await t.getAuthValue({requestedScope:"comments:read",roomId:S}),T.file,{fileSize:T.size},{signal:I}),jt,Kt,St);{let st;const $t=[],ae=await ai(async()=>r.post(D`/v2/c/rooms/${S}/attachments/${T.id}/multipart/${encodeURIComponent(T.name)}`,await t.getAuthValue({requestedScope:"comments:read",roomId:S}),void 0,{signal:I},{fileSize:T.size}),jt,Kt,St);try{st=ae.uploadId;const zt=ce(T.file);if(I?.aborted)throw ut;const Ms=dg(zt,5);for(const Yn of Ms){const hn=[];for(const{part:$s,partNumber:fn}of Yn)hn.push(ai(async()=>r.putBlob(D`/v2/c/rooms/${S}/attachments/${T.id}/multipart/${ae.uploadId}/${String(fn)}`,await t.getAuthValue({requestedScope:"comments:read",roomId:S}),$s,void 0,{signal:I}),jt,Kt,St));$t.push(...await Promise.all(hn))}if(I?.aborted)throw ut;const zr=$t.sort((Yn,hn)=>Yn.partNumber-hn.partNumber);return r.post(D`/v2/c/rooms/${S}/attachments/${T.id}/multipart/${st}/complete`,await t.getAuthValue({requestedScope:"comments:read",roomId:S}),{parts:zr},{signal:I})}catch(zt){if(st&&zt?.name&&(zt.name==="AbortError"||zt.name==="TimeoutError"))try{await r.rawDelete(D`/v2/c/rooms/${S}/attachments/${T.id}/multipart/${st}`,await t.getAuthValue({requestedScope:"comments:read",roomId:S}))}catch{}throw zt}}}const R=new Ht(p=>{const S=new Le(async I=>{const T=I.flat(),{urls:ut}=await r.post(D`/v2/c/rooms/${p}/attachments/presigned-urls`,await t.getAuthValue({requestedScope:"comments:read",roomId:p}),{attachmentIds:T});return ut.map(St=>St??new Error("There was an error while getting this attachment's URL"))},{delay:50});return Tn(S)});function q(p){return R.getOrCreate(p)}function et(p){return q(p.roomId).batch.get(p.attachmentId)}async function Q(p){const{chatId:S,attachment:I,signal:T}=p;if(n.get()===void 0)throw new Error("Attachment upload requires an authenticated user.");const St=5*1024*1024;if(p.attachment.file.size<=St)await r.putBlob(D`/v2/c/chats/${S}/attachments/${I.id}/upload/${encodeURIComponent(I.file.name)}`,await t.getAuthValue({requestedScope:"comments:read"}),I.file,{fileSize:I.file.size},{signal:T});else{const Ie=await r.post(D`/v2/c/chats/${S}/attachments/${I.id}/multipart/${encodeURIComponent(I.file.name)}`,await t.getAuthValue({requestedScope:"comments:read"}),void 0,{signal:T},{fileSize:I.file.size});try{const jt=[],Kt=[];let ce=0;for(;ce<I.file.size;){const st=Math.min(ce+St,I.file.size);Kt.push({number:Kt.length+1,part:I.file.slice(ce,st)}),ce=st}jt.push(...await Promise.all(Kt.map(async({number:st,part:$t})=>await r.putBlob(D`/v2/c/chats/${S}/attachments/${I.id}/multipart/${Ie.uploadId}/${String(st)}`,await t.getAuthValue({requestedScope:"comments:read"}),$t,void 0,{signal:T})))),await r.post(D`/v2/c/chats/${S}/attachments/${I.id}/multipart/${Ie.uploadId}/complete`,await t.getAuthValue({requestedScope:"comments:read"}),{parts:jt.sort((st,$t)=>st.number-$t.number)},{signal:T})}catch(jt){try{await r.delete(D`/v2/c/chats/${S}/attachments/${I.id}/multipart/${Ie.uploadId}`,await t.getAuthValue({requestedScope:"comments:read"}))}catch{}throw jt}}}const W=new Ht(p=>{const S=new Le(async I=>{const T=I.flat(),{urls:ut}=await r.post(D`/v2/c/chats/${p}/attachments/presigned-urls`,await t.getAuthValue({requestedScope:"comments:read"}),{attachmentIds:T});return ut.map(St=>St??new Error("There was an error while getting this attachment's URL"))},{delay:50});return Tn(S)});function ot(p){return W.getOrCreate(p)}function O(p){return ot(p.chatId).batch.get(p.attachmentId)}async function C(p){return r.get(D`/v2/c/rooms/${p.roomId}/subscription-settings`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),void 0,{signal:p.signal})}async function K(p){return r.post(D`/v2/c/rooms/${p.roomId}/subscription-settings`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),p.settings)}const $=new Ht(p=>new Le(async S=>{const I=S.flat();return await r.post(D`/v2/c/rooms/${p}/inbox-notifications/read`,await t.getAuthValue({requestedScope:"comments:read",roomId:p}),{inboxNotificationIds:I}),I},{delay:50}));async function z(p){return $.getOrCreate(p.roomId).get(p.inboxNotificationId)}async function lt(p){if(p.mention.kind!=="user"&&p.mention.kind!=="group")return Et(p.mention,"Unexpected mention kind");await r.rawPost(D`/v2/c/rooms/${p.roomId}/text-mentions`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{userId:p.mention.kind==="user"?p.mention.id:void 0,groupId:p.mention.kind==="group"?p.mention.id:void 0,userIds:p.mention.kind==="group"?p.mention.userIds:void 0,mentionId:p.mentionId})}async function mt(p){await r.rawDelete(D`/v2/c/rooms/${p.roomId}/text-mentions/${p.mentionId}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function Mt(p){return r.rawGet(D`/v2/c/rooms/${p.roomId}/y-version/${p.versionId}`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function un(p){await r.rawPost(D`/v2/c/rooms/${p.roomId}/version`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}))}async function Wn(p){await r.rawPost(D`/v2/c/rooms/${p.roomId}/text-metadata`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{type:p.type,rootKey:p.rootKey})}async function He(p){const S=await r.post(D`/v2/c/rooms/${p.roomId}/ai/contextual-prompt`,await t.getAuthValue({requestedScope:"room:read",roomId:p.roomId}),{prompt:p.prompt,context:{beforeSelection:p.context.beforeSelection,selection:p.context.selection,afterSelection:p.context.afterSelection},previous:p.previous},{signal:p.signal});if(!S||S.content.length===0)throw new Error("No content returned from server");return S.content[0].text}async function A(p){const S=await r.get(D`/v2/c/rooms/${p.roomId}/versions`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}));return{versions:S.versions.map(({createdAt:I,...T})=>({createdAt:new Date(I),...T})),requestedAt:new Date(S.meta.requestedAt)}}async function F(p){const S=await r.get(D`/v2/c/rooms/${p.roomId}/versions/delta`,await t.getAuthValue({requestedScope:"comments:read",roomId:p.roomId}),{since:p.since.toISOString()},{signal:p.signal});return{versions:S.versions.map(({createdAt:I,...T})=>({createdAt:new Date(I),...T})),requestedAt:new Date(S.meta.requestedAt)}}async function nt(p){return await(await r.rawGet(D`/v2/c/rooms/${p.roomId}/storage`,await t.getAuthValue({requestedScope:"room:read",roomId:p.roomId}))).json()}async function yt(p){return r.rawPost(D`/v2/c/rooms/${p.roomId}/send-message`,await t.getAuthValue({requestedScope:"room:read",roomId:p.roomId}),{nonce:p.nonce,messages:p.messages})}async function Ft(p){let I;p?.query&&(I=gn(p.query));const T=await r.get(D`/v2/c/inbox-notifications`,await t.getAuthValue({requestedScope:"comments:read"}),{cursor:p?.cursor,limit:50,query:I}),ut=T.groups.map(Cc);return Us.setData(ut.map(St=>[St.id,St])),{inboxNotifications:T.inboxNotifications.map(Ke),threads:T.threads.map(Ae),subscriptions:T.subscriptions.map(Te),nextCursor:T.meta.nextCursor,requestedAt:new Date(T.meta.requestedAt)}}async function Qt(p){let S;p?.query&&(S=gn(p.query));const I=await r.get(D`/v2/c/inbox-notifications/delta`,await t.getAuthValue({requestedScope:"comments:read"}),{since:p.since.toISOString(),query:S},{signal:p.signal});return{inboxNotifications:{updated:I.inboxNotifications.map(Ke),deleted:I.deletedInboxNotifications.map(oi)},threads:{updated:I.threads.map(Ae),deleted:I.deletedThreads.map(ii)},subscriptions:{updated:I.subscriptions.map(Te),deleted:I.deletedSubscriptions.map(ci)},requestedAt:new Date(I.meta.requestedAt)}}async function Fe(p){let S;p?.query&&(S=gn(p.query));const{count:I}=await r.get(D`/v2/c/inbox-notifications/count`,await t.getAuthValue({requestedScope:"comments:read"}),{query:S},{signal:p?.signal});return I}async function dn(){await r.post(D`/v2/c/inbox-notifications/read`,await t.getAuthValue({requestedScope:"comments:read"}),{inboxNotificationIds:"all"})}async function xs(p){await r.post(D`/v2/c/inbox-notifications/read`,await t.getAuthValue({requestedScope:"comments:read"}),{inboxNotificationIds:p})}const Vr=new Le(async p=>{const S=p.flat();return await xs(S),S},{delay:50});async function Hr(p){await Vr.get(p)}async function Rs(){await r.delete(D`/v2/c/inbox-notifications`,await t.getAuthValue({requestedScope:"comments:read"}))}async function Ls(p){await r.delete(D`/v2/c/inbox-notifications/${p}`,await t.getAuthValue({requestedScope:"comments:read"}))}async function Gn(p){return r.get(D`/v2/c/notification-settings`,await t.getAuthValue({requestedScope:"comments:read"}),void 0,{signal:p?.signal})}async function Fr(p){return r.post(D`/v2/c/notification-settings`,await t.getAuthValue({requestedScope:"comments:read"}),p)}async function Ps(p){let S;p?.query&&(S=gn(p.query));const T=await r.get(D`/v2/c/threads`,await t.getAuthValue({requestedScope:"comments:read"}),{cursor:p?.cursor,query:S,limit:50});return{threads:T.threads.map(Ae),inboxNotifications:T.inboxNotifications.map(Ke),subscriptions:T.subscriptions.map(Te),nextCursor:T.meta.nextCursor,requestedAt:new Date(T.meta.requestedAt),permissionHints:T.meta.permissionHints}}async function jr(p){const S=await r.get(D`/v2/c/threads/delta`,await t.getAuthValue({requestedScope:"comments:read"}),{since:p.since.toISOString()},{signal:p.signal});return{threads:{updated:S.threads.map(Ae),deleted:S.deletedThreads.map(ii)},inboxNotifications:{updated:S.inboxNotifications.map(Ke),deleted:S.deletedInboxNotifications.map(oi)},subscriptions:{updated:S.subscriptions.map(Te),deleted:S.deletedSubscriptions.map(ci)},requestedAt:new Date(S.meta.requestedAt),permissionHints:S.meta.permissionHints}}const Ns=new Le(async p=>{const S=p.flat(),{groups:I}=await r.post(D`/v2/c/groups/find`,await t.getAuthValue({requestedScope:"comments:read"}),{groupIds:S}),T=new Map;for(const ut of I)T.set(ut.id,Cc(ut));return S.map(ut=>T.get(ut))},{delay:50}),Us=Tn(Ns);function At(p){return Ns.get(p)}async function Kr(p){const{metadata:S}=await r.get(D`/v2/c/urls/metadata`,await t.getAuthValue({requestedScope:"comments:read"}),{url:p});return S}return{getThreads:o,getThreadsSince:i,searchComments:c,createThread:l,getThread:a,deleteThread:u,editThreadMetadata:d,createComment:g,editComment:m,editCommentMetadata:f,deleteComment:_,addReaction:N,removeReaction:P,markThreadAsResolved:v,markThreadAsUnresolved:U,subscribeToThread:w,unsubscribeFromThread:k,markRoomInboxNotificationAsRead:z,getSubscriptionSettings:C,updateSubscriptionSettings:K,createTextMention:lt,deleteTextMention:mt,getTextVersion:Mt,createTextVersion:un,reportTextEditor:Wn,listTextVersions:A,listTextVersionsSince:F,getAttachmentUrl:et,uploadAttachment:x,getOrCreateAttachmentUrlsStore:q,uploadChatAttachment:Q,getOrCreateChatAttachmentUrlsStore:ot,getChatAttachmentUrl:O,streamStorage:nt,sendMessagesOverHTTP:yt,getInboxNotifications:Ft,getInboxNotificationsSince:Qt,getUnreadInboxNotificationsCount:Fe,markAllInboxNotificationsAsRead:dn,markInboxNotificationAsRead:Hr,deleteAllInboxNotifications:Rs,deleteInboxNotification:Ls,getNotificationSettings:Gn,updateNotificationSettings:Fr,getUserThreads_experimental:Ps,getUserThreadsSince_experimental:jr,groupsStore:Us,getGroup:At,executeContextualPrompt:He,getUrlMetadata:Kr}}function Ro(e){return e.type==="public"?e.publicApiKey:e.token.raw}var Eg=class{#t;#e;constructor(e,t){this.#t=e,this.#e=t}async#n(e,t,n,s){e.startsWith("/v2/c/")||Xt("This client can only be used to make /v2/c/* requests");const r=_g(this.#t,e,s);return await this.#e(r,{...n,headers:{"Content-Type":"application/json; charset=utf-8",...n?.headers,Authorization:`Bearer ${Ro(t)}`,"X-LB-Client":Ur}})}async#s(e,t,n,s){const r=await this.#n(e,t,n,s);if(!r.ok)throw await br.fromResponse(r);let i;try{i=await r.json()}catch{i={}}return i}async rawGet(e,t,n,s){return await this.#n(e,t,s,n)}async rawPost(e,t,n){return await this.#n(e,t,{method:"POST",body:ye(n)})}async rawDelete(e,t){return await this.#n(e,t,{method:"DELETE"})}async get(e,t,n,s){return await this.#s(e,t,s,n)}async post(e,t,n,s,r){return await this.#s(e,t,{...s,method:"POST",body:ye(n)},r)}async delete(e,t){return await this.#s(e,t,{method:"DELETE"})}async putBlob(e,t,n,s,r){return await this.#s(e,t,{...r,method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:n},s)}};function vg(e,t){if(e===t)return[0,0];const n=e.split("."),s=t.split("."),r=Math.min(n.length,s.length);let i=0;for(;i<r&&n[i]===s[i];i++);const o=n.length-i,c=s.length-i;return[o,c]}function Cg(e,t){const n=e.split(".");if(t<1||t>n.length+1)throw new Error("Invalid number of levels");const s=[];t>n.length&&s.push("*");for(let r=n.length-t+1;r<n.length;r++){const i=n.slice(0,r);i.length>0&&s.push(i.join(".")+".*")}return s.push(e),s}var kg=class{#t;constructor(e){this.#t=e}get current(){return this.#t}allowPatching(e){const t=this;let n=!0;const s={...this.#t,patch(r){if(n){t.#t=Object.assign({},t.#t,r);for(const i of Object.entries(r)){const[o,c]=i;o!=="patch"&&(this[o]=c)}}else throw new Error("Can no longer patch stale context")}};e(s),n=!1}},Ig=1,Ag=class{id;#t;#e;#n;#s;#i;#r;events;#o;#c;#a;#l;get#h(){const e=this.#n.values()[Symbol.iterator]().next();if(e.done)throw new Error("No states defined yet");return e.value}get currentState(){if(this.#s===null)throw this.#t===0?new Error("Not started yet"):new Error("Already stopped");return this.#s}start(){if(this.#t!==0)throw new Error("State machine has already started");return this.#t=1,this.#s=this.#h,this.#d(null),this}stop(){if(this.#t!==1)throw new Error("Cannot stop a state machine that hasn't started yet");this.#u(null),this.#t=2,this.#s=null}constructor(e){this.id=Ig++,this.#t=0,this.#s=null,this.#n=new Set,this.#a=new Map,this.#o=[],this.#c=[],this.#l=new Set,this.#i=new Map,this.#e=new kg(e),this.#r={didReceiveEvent:Y(),willTransition:Y(),didIgnoreEvent:Y(),willExitState:Y(),didEnterState:Y(),didExitState:Y()},this.events={didReceiveEvent:this.#r.didReceiveEvent.observable,willTransition:this.#r.willTransition.observable,didIgnoreEvent:this.#r.didIgnoreEvent.observable,willExitState:this.#r.willExitState.observable,didEnterState:this.#r.didEnterState.observable,didExitState:this.#r.didExitState.observable}}get context(){return this.#e.current}addState(e){if(this.#t!==0)throw new Error("Already started");return this.#n.add(e),this}onEnter(e,t){if(this.#t!==0)throw new Error("Already started");if(this.#a.has(e))throw new Error(`enter/exit function for ${e} already exists`);return this.#a.set(e,t),this}onEnterAsync(e,t,n,s,r){return this.onEnter(e,()=>{const i=new AbortController,o=i.signal,c=r?setTimeout(()=>{const u=new Error("Timed out");this.#f({type:"ASYNC_ERROR",reason:u},s)},r):void 0;let l=!1;return t(this.#e.current,o).then(u=>{o.aborted||(l=!0,this.#f({type:"ASYNC_OK",data:u},n))},u=>{o.aborted||(l=!0,this.#f({type:"ASYNC_ERROR",reason:u},s))}),()=>{clearTimeout(c),l||i.abort()}})}#p(e){const t=[];if(e==="*")for(const n of this.#n)t.push(n);else if(e.endsWith(".*")){const n=e.slice(0,-1);for(const s of this.#n)s.startsWith(n)&&t.push(s)}else{const n=e;this.#n.has(n)&&t.push(n)}if(t.length===0)throw new Error(`No states match ${JSON.stringify(e)}`);return t}addTransitions(e,t){if(this.#t!==0)throw new Error("Already started");for(const n of this.#p(e)){let s=this.#i.get(n);s===void 0&&(s=new Map,this.#i.set(n,s));for(const[r,i]of Object.entries(t)){if(s.has(r))throw new Error(`Trying to set transition "${r}" on "${n}" (via "${e}"), but a transition already exists there.`);const o=i;if(this.#l.add(r),o!==void 0){const c=typeof o=="function"?o:()=>o;s.set(r,c)}}}return this}addTimedTransition(e,t,n){return this.onEnter(e,()=>{const s=typeof t=="function"?t(this.#e.current):t,r=setTimeout(()=>{this.#f({type:"TIMER"},n)},s);return()=>{clearTimeout(r)}})}#g(e){return this.#i.get(this.currentState)?.get(e)}#u(e){this.#r.willExitState.notify(this.currentState);const t=performance.now(),n=this.currentState.split(".");this.#e.allowPatching(s=>{e=e??this.#o.length;for(let r=0;r<e;r++){this.#o.pop()?.(s);const i=this.#c.pop();if(i!==void 0&&this.#r.didExitState.count()>0){const o=this.#c.length;if(o===0)continue;const c=o===n.length?this.currentState:`${n.slice(0,o).join(".")}.*`;this.#r.didExitState.notify({state:c,durationMs:t-i})}}})}#d(e){const t=Cg(this.currentState,e??this.currentState.split(".").length+1),n=performance.now();this.#e.allowPatching(s=>{for(const r of t){const o=this.#a.get(r)?.(s);typeof o=="function"?this.#o.push(o):this.#o.push(null),this.#c.push(n)}}),this.#r.didEnterState.notify(this.currentState)}send(e){if(!this.#l.has(e.type))throw new Error(`Invalid event ${JSON.stringify(e.type)}`);if(this.#t===2)return;const t=this.#g(e.type);if(t!==void 0)return this.#f(e,t);this.#r.didIgnoreEvent.notify(e)}#f(e,t){this.#r.didReceiveEvent.notify(e);const n=this.currentState,r=(typeof t=="function"?t:()=>t)(e,this.#e.current);let i,o;if(r===null){this.#r.didIgnoreEvent.notify(e);return}if(typeof r=="string"?i=r:(i=r.target,o=Array.isArray(r.effect)?r.effect:[r.effect]),!this.#n.has(i))throw new Error(`Invalid next state name: ${JSON.stringify(i)}`);this.#r.willTransition.notify({from:n,to:i});const[c,l]=vg(this.currentState,i);if(c>0&&this.#u(c),this.#s=i,o!==void 0){const u=o;this.#e.allowPatching(a=>{for(const d of u)typeof d=="function"?d(a,e):a.patch(d)})}l>0&&this.#d(l)}},rt=Object.freeze({UPDATE_PRESENCE:100,USER_JOINED:101,USER_LEFT:102,BROADCASTED_EVENT:103,ROOM_STATE:104,STORAGE_STATE:200,UPDATE_STORAGE:201,UPDATE_YDOC:300,THREAD_CREATED:400,THREAD_DELETED:407,THREAD_METADATA_UPDATED:401,THREAD_UPDATED:408,COMMENT_CREATED:402,COMMENT_EDITED:403,COMMENT_DELETED:404,COMMENT_REACTION_ADDED:405,COMMENT_REACTION_REMOVED:406,COMMENT_METADATA_UPDATED:409,REJECT_STORAGE_OP:299});function Rc(e){return e===4999||e>=4e3&&e<4100}function Tg(e){return e>=4100&&e<4200}function Lc(e){return e===1013||e>=4200&&e<4300}function Og(e){return e==="initial"||e==="disconnected"}function $l(e){const t=e.currentState;switch(t){case"@ok.connected":case"@ok.awaiting-pong":return"connected";case"@idle.initial":return"initial";case"@auth.busy":case"@auth.backoff":case"@connecting.busy":case"@connecting.backoff":case"@idle.zombie":return e.context.successCount>0?"reconnecting":"connecting";case"@idle.failed":return"disconnected";default:return Et(t,"Unknown state")}}var Bl=[250,500,1e3,2e3,4e3,8e3,1e4],qs=Bl[0]-1,Dg=[2e3,3e4,6e4,3e5],xg=3e4,Rg=2e3,Lg=1e4,Pg=2e4,we=class extends Error{constructor(e){super(e)}};function Vl(e,t){return t.find(n=>n>e)??t[t.length-1]}function mn(e){e.patch({backoffDelay:Vl(e.backoffDelay,Bl)})}function Pc(e){e.patch({backoffDelay:Vl(e.backoffDelay,Dg)})}function Nc(e){e.patch({successCount:0})}function bn(e,t){const n=e===2?Ee:e===1?_t:(()=>{});return()=>{n(t)}}function Uc(e){const t="Connection to Liveblocks websocket server";return n=>{Hl(e)?_t(`${t} closed prematurely (code: ${e.code}). Retrying in ${n.backoffDelay}ms.`):_t(`${t} could not be established.`,e)}}function li(e){const t=[`code: ${e.code}`];return e.reason&&t.push(`reason: ${e.reason}`),n=>{_t(`Connection to Liveblocks websocket server closed (${t.join(", ")}). Retrying in ${n.backoffDelay}ms.`)}}var Ng=bn(1,"Connection to WebSocket closed permanently. Won't retry.");function Hl(e){return!(e instanceof Error)&&e.type==="close"}function Ug(e){function t(...s){_t(`[FSM #${e.id}]`,...s)}const n=[e.events.didReceiveEvent.subscribe(s=>t(`Event ${s.type}`)),e.events.willTransition.subscribe(({from:s,to:r})=>t("Transitioning",s,"",r)),e.events.didExitState.subscribe(({state:s,durationMs:r})=>t(`Exited ${s} after ${r.toFixed(0)}ms`)),e.events.didIgnoreEvent.subscribe(s=>t("Ignored event",s.type,s,"(current state won't handle it)"))];return()=>{for(const s of n)s()}}function Mg(e){const t=Y(),n=Y(),s=Y();let r=null;const i=e.events.didEnterState.subscribe(()=>{const o=$l(e);o!==r&&t.notify(o),r==="connected"&&o!=="connected"?s.notify():r!=="connected"&&o==="connected"&&n.notify(),r=o});return{statusDidChange:t.observable,didConnect:n.observable,didDisconnect:s.observable,unsubscribe:i}}var Ws=e=>t=>t.patch(e);function $g(e,t){const n=qp();n.pause();const s=Y();function r(v,U){return()=>{s.notify({message:v,code:U})}}const i={successCount:0,authValue:null,socket:null,backoffDelay:qs},o=new Ag(i).addState("@idle.initial").addState("@idle.failed").addState("@idle.zombie").addState("@auth.busy").addState("@auth.backoff").addState("@connecting.busy").addState("@connecting.backoff").addState("@ok.connected").addState("@ok.awaiting-pong");o.addTransitions("*",{RECONNECT:{target:"@auth.backoff",effect:[mn,Nc]},DISCONNECT:"@idle.initial"}),o.onEnter("@idle.*",Nc).addTransitions("@idle.*",{CONNECT:(v,U)=>U.authValue!==null?"@connecting.busy":"@auth.busy"}),o.addTransitions("@auth.backoff",{NAVIGATOR_ONLINE:{target:"@auth.busy",effect:Ws({backoffDelay:qs})}}).addTimedTransition("@auth.backoff",v=>v.backoffDelay,"@auth.busy").onEnterAsync("@auth.busy",()=>Ec(e.authenticate(),Lg,"Timed out during auth"),v=>({target:"@connecting.busy",effect:Ws({authValue:v.data})}),v=>v.reason instanceof we?{target:"@idle.failed",effect:[bn(2,v.reason.message),r(v.reason.message,-1)]}:{target:"@auth.backoff",effect:[mn,bn(2,`Authentication failed: ${v.reason instanceof Error?v.reason.message:String(v.reason)}`)]});const c=v=>o.send({type:"EXPLICIT_SOCKET_ERROR",event:v}),l=v=>o.send({type:"EXPLICIT_SOCKET_CLOSE",event:v}),u=v=>v.data==="pong"?o.send({type:"PONG"}):n.notify(v);function a(v){v&&(v.removeEventListener("error",c),v.removeEventListener("close",l),v.removeEventListener("message",u),v.close())}o.addTransitions("@connecting.backoff",{NAVIGATOR_ONLINE:{target:"@connecting.busy",effect:Ws({backoffDelay:qs})}}).addTimedTransition("@connecting.backoff",v=>v.backoffDelay,"@connecting.busy").onEnterAsync("@connecting.busy",async(v,U)=>{const w=performance.now();let k=null,x=null,R=null;const q=new Promise((et,Q)=>{if(v.authValue===null)throw new Error("No auth authValue");const W=e.createSocket(v.authValue);R=W;function ot($){x=$,W.removeEventListener("message",u),Q($)}const[O,C]=Ul();t.waitForActorId||C();function K($){if(ge($.data)?.type===rt.ROOM_STATE){if(t.enableDebugLogging&&k!==null){const lt=performance.now()-k;_t(`[FSM #${o.id}] Socket open  ROOM_STATE: ${lt.toFixed(0)}ms`)}C()}}W.addEventListener("message",u),t.waitForActorId&&W.addEventListener("message",K),W.addEventListener("error",ot),W.addEventListener("close",ot),W.addEventListener("open",()=>{if(k=performance.now(),t.enableDebugLogging){const z=k-w;_t(`[FSM #${o.id}] Socket epoch  open: ${z.toFixed(0)}ms`)}W.addEventListener("error",c),W.addEventListener("close",l);const $=()=>{W.removeEventListener("error",ot),W.removeEventListener("close",ot),W.removeEventListener("message",K)};O.then(()=>{et([W,$])})})});return Ec(q,Pg,"Timed out during websocket connection").then(([et,Q])=>{if(Q(),U.aborted)throw new Error("Aborted");if(x)throw x;return et}).catch(et=>{throw a(R),et})},v=>({target:"@ok.connected",effect:Ws({socket:v.data,backoffDelay:qs})}),v=>{const U=v.reason;if(U instanceof we)return{target:"@idle.failed",effect:[bn(2,U.message),r(U.message,-1)]};if(Hl(U)){if(U.code===4109)return"@auth.busy";if(Lc(U.code))return{target:"@connecting.backoff",effect:[Pc,Uc(U)]};if(Rc(U.code))return{target:"@idle.failed",effect:[bn(2,U.reason),r(U.reason,U.code)]}}return{target:"@auth.backoff",effect:[mn,Uc(U)]}});const d={target:"@ok.awaiting-pong",effect:v=>{v.socket?.send("ping")}},f=()=>(typeof document<"u"?document:void 0)?.visibilityState==="hidden"&&e.canZombie()?"@idle.zombie":d;if(o.addTimedTransition("@ok.connected",xg,f).addTransitions("@ok.connected",{NAVIGATOR_OFFLINE:f,WINDOW_GOT_FOCUS:d}),o.addTransitions("@idle.zombie",{WINDOW_GOT_FOCUS:"@connecting.backoff"}),o.onEnter("@ok.*",v=>{v.patch({successCount:v.successCount+1});const U=setTimeout(n.unpause,0);return w=>{a(w.socket),w.patch({socket:null}),clearTimeout(U),n.pause()}}).addTransitions("@ok.awaiting-pong",{PONG:"@ok.connected"}).addTimedTransition("@ok.awaiting-pong",Rg,{target:"@connecting.busy",effect:bn(1,"Received no pong from server, assume implicit connection loss.")}).addTransitions("@ok.*",{EXPLICIT_SOCKET_ERROR:(v,U)=>U.socket?.readyState===1?null:{target:"@connecting.backoff",effect:mn},EXPLICIT_SOCKET_CLOSE:v=>Rc(v.event.code)?{target:"@idle.failed",effect:[Ng,r(v.event.reason,v.event.code)]}:Tg(v.event.code)?v.event.code===4109?"@auth.busy":{target:"@auth.backoff",effect:[mn,li(v.event)]}:Lc(v.event.code)?{target:"@connecting.backoff",effect:[Pc,li(v.event)]}:{target:"@connecting.backoff",effect:[mn,li(v.event)]}}),typeof document<"u"){const v=typeof document<"u"?document:void 0,U=typeof window<"u"?window:void 0,w=U??v;o.onEnter("*",k=>{function x(){o.send({type:"NAVIGATOR_OFFLINE"})}function R(){o.send({type:"NAVIGATOR_ONLINE"})}function q(){v?.visibilityState==="visible"&&o.send({type:"WINDOW_GOT_FOCUS"})}return U?.addEventListener("online",R),U?.addEventListener("offline",x),w?.addEventListener("visibilitychange",q),()=>{w?.removeEventListener("visibilitychange",q),U?.removeEventListener("online",R),U?.removeEventListener("offline",x),a(k.socket)}})}const g=[],{statusDidChange:m,didConnect:_,didDisconnect:N,unsubscribe:P}=Mg(o);return g.push(P),t.enableDebugLogging&&g.push(Ug(o)),o.start(),{machine:o,cleanups:g,events:{statusDidChange:m,didConnect:_,didDisconnect:N,onMessage:n.observable,onConnectionError:s.observable}}}var Fl=class{#t;#e;events;constructor(e,t=!1,n=!0){const{machine:s,events:r,cleanups:i}=$g(e,{waitForActorId:n,enableDebugLogging:t});this.#t=s,this.events=r,this.#e=i}getStatus(){try{return $l(this.#t)}catch{return"initial"}}get authValue(){return this.#t.context.authValue}connect(){this.#t.send({type:"CONNECT"})}reconnect(){this.#t.send({type:"RECONNECT"})}disconnect(){this.#t.send({type:"DISCONNECT"})}destroy(){this.#t.stop();let e;for(;e=this.#e.pop();)e()}send(e){const t=this.#t.context?.socket;t===null?_t("Cannot send: not connected yet",e):t.readyState!==1?_t("Cannot send: WebSocket no longer open",e):t.send(e)}_privateSendMachineEvent(e){this.#t.send(e)}},sn=Symbol(),Mc=Object.freeze({}),Bg=Array.from(new Set("null")),Vg=Array.from(new Set("true")),Hg=Array.from(new Set("false")),Fg=Array.from(new Set("nulltruefalse"));function ui(e,t){const n=e[e.length-1];return t.includes(n)?e.slice(0,-1):e}var jg=class{#t="";#e;#n=0;#s=!1;#i=-1;#r=-1;#o=[];constructor(e=""){this.append(e)}get source(){return this.#t}get json(){return this.#e===void 0&&(this.#e=this.#h()),this.#e}get#c(){return this.#i>=0}append(e){e&&(this.#t===""&&(e=e.trimStart()),this.#t+=e,this.#e=void 0)}#a(e){if(this.#c)return"";const t=e.charAt(e.length-1);if(t==="")return"";if(t==="-")return"0";if(!Fg.includes(t))return"";if(Bg.includes(t)){if(e.endsWith("nul"))return"l";if(e.endsWith("nu"))return"ll";if(e.endsWith("n"))return"ull"}if(Vg.includes(t)){if(e.endsWith("tru"))return"e";if(e.endsWith("tr"))return"ue";if(e.endsWith("t"))return"rue"}if(Hg.includes(t)){if(e.endsWith("fals"))return"e";if(e.endsWith("fal"))return"se";if(e.endsWith("fa"))return"lse";if(e.endsWith("f"))return"alse"}return""}#l(){const e=this.#t.slice(this.#n);for(let t=0;t<e.length;t++){const n=e[t],s=this.#n+t;this.#c?this.#s?this.#s=!1:n==="\\"?this.#s=!0:n==='"'&&(this.#r=this.#i,this.#i=-1):n==='"'?this.#i=s:n==="{"?this.#o.push("}"):n==="["?this.#o.push("]"):n==="}"&&this.#o.length>0&&this.#o[this.#o.length-1]==="}"?this.#o.pop():n==="]"&&this.#o.length>0&&this.#o[this.#o.length-1]==="]"&&this.#o.pop()}this.#n=this.#t.length}#h(){this.#l();let e=this.#t;if(e.charAt(0)!=="{")return Mc;if(e.endsWith("}")){const n=ge(e);if(n)return n}this.#c&&(this.#s&&(e=e.slice(0,-1)),e+='"'),e=e.trimEnd(),e=ui(e,",."),e=e+this.#a(e);const t=this.#o.reduceRight((n,s)=>n+s,"");{const n=ge(e+t);if(n)return n}return this.#c?e=e.slice(0,this.#i):(e=ui(e,":"),e.endsWith('"')&&(e=e.slice(0,this.#r))),e=ui(e,","),e+=t,ge(e)??Mc}};function Kg(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function zg(e,t){if(!ie(e)||!ie(t))return!1;const n=Object.keys(e);return n.length!==Object.keys(t).length?!1:n.every(s=>Object.prototype.hasOwnProperty.call(t,s)&&Object.is(e[s],t[s]))}function Bi(e,t){if(Object.is(e,t))return!0;const n=Array.isArray(e),s=Array.isArray(t);return n||s?!n||!s?!1:Kg(e,t):zg(e,t)}function qg(e,t){if(!ie(e)||!ie(t))return Bi(e,t);const n=Object.keys(e);return n.length!==Object.keys(t).length?!1:n.every(s=>Object.prototype.hasOwnProperty.call(t,s)&&Bi(e[s],t[s]))}var Wg=class{#t;#e;#n;#s;#i;#r;constructor(e,t,n){this.#s=e,this.#i=t,this.#r=n,this.#t=new Map,this.#e=new Ht(()=>new Set),this.#n=Zn.with(n)}get(e){return this.#t.get(e)}getOrThrow(e){return this.get(e)??Xt(`Item with id ${e} not found`)}get sorted(){return this.#n}getParentId(e){const t=this.getOrThrow(e);return this.#i(t)}getParent(e){const t=this.getParentId(e);return t?this.getOrThrow(t):null}getChildren(e){const t=this.#e.get(e);return t?Array.from(t).map(n=>this.#t.get(n)):[]}*walkUp(e,t){let n=e;do{const s=this.getOrThrow(n);(!t||t(s))&&(yield s),n=this.#i(s)}while(n!==null)}*walkLeft(e,t){const n=this.getOrThrow(e),s=Zn.from(this.getSiblings(e),this.#r);for(const r of s.iterReversed())this.#r(n,r)||(!t||t(r))&&(yield r)}*walkRight(e,t){const n=this.getOrThrow(e),s=Zn.from(this.getSiblings(e),this.#r);for(const r of s)this.#r(r,n)||(!t||t(r))&&(yield r)}*walkDown(e,t){const n=Zn.from(this.getChildren(e),this.#r).rawArray;for(let s=n.length-1;s>=0;s--){const r=n[s];yield*this.walkDown(this.#s(r),t),(!t||t(r))&&(yield r)}}getSiblings(e){const t=this.getOrThrow(e),n=this.getParentId(e);return this.getChildren(n).filter(s=>s!==t)}[Symbol.iterator](){return this.#n[Symbol.iterator]()}upsert(e){const t=this.#s(e),n=this.#t.get(t);if(n){if(this.#i(n)!==this.#i(e))throw new Error("Cannot upsert parent ID changes that change the tree structure. Remove the entry first, and recreate it");this.#n.remove(n)}this.#t.set(t,e),this.#n.add(e);const s=this.#i(e);this.#e.getOrCreate(s).add(t)}remove(e){const t=this.#t.get(e);if(!t)return!1;if(this.#e.get(e))throw new Error(`Cannot remove item '${e}' while it still has children. Remove children first.`);const s=this.#i(t),r=this.#e.get(s);return r&&(r.delete(e),r.size===0&&this.#e.delete(s)),this.#n.remove(t),this.#e.delete(e),this.#t.delete(e),!0}clear(){return this.#t.size===0?!1:(this.#e.clear(),this.#t.clear(),this.#n.clear(),!0)}},Gg=4e3,Yg=class{#t;#e;#n;constructor(){this.#t=new Set,this.#e=new Ht(()=>new Map),this.#n=void 0}registerLayer(e){const t=e;return this.#t.has(t)&&Xt(`Layer '${t}' already exists, provide a unique layer id`),this.#t.add(t),t}deregisterLayer(e){this.#t.delete(e);let t=!1;for(const[n,s]of this.#e)s.delete(e)&&(t=!0),s.size===0&&this.#e.delete(n);t&&this.invalidate()}get(){return this.#n??=this.#s()}invalidate(){this.#n=void 0}#s(){return Array.from(this.#e.values()).flatMap(e=>Array.from(e.values()).slice(-1).filter(og))}updateKnowledge(e,t,n){this.#t.has(e)||Xt(`Unknown layer key: ${e}`),this.#e.getOrCreate(t).set(e,n),this.invalidate()}};function Jg(){const e=new Ht(s=>new Yg);function t(s){return e.getOrCreate(s??ss)}function n(s){const r=e.getOrCreate(ss).get(),i=e.get(s)?.get()??[];return[...r,...i]}return{getKnowledgeStack:t,getKnowledgeForChat:n}}function di(){return new Date().toISOString()}var ss=Symbol("*");function Zg(){const e=new Ht(o=>new Ht(c=>new Nt(void 0))),t=new Ht(o=>{const[c,l]=ge(o);return me.from(()=>(l!==void 0?e.getOrCreate(l).getOrCreate(c):void 0)?.get()??e.getOrCreate(ss).getOrCreate(c).get())});function n(o,c){const l=JSON.stringify(c!==void 0?[o,c]:[o]);return t.getOrCreate(l)}function s(o,c,l){if(!c.execute&&!c.render)throw new Error("A tool definition must have an execute() function, a render() function, or both.");const u=l??ss;return e.getOrCreate(u).getOrCreate(o).set(c),()=>r(u,o)}function r(o,c){const l=e.get(o);if(l===void 0)return;const u=l.get(c);u!==void 0&&u.set(void 0)}function i(o){const c=e.get(ss),l=e.get(o);return Array.from([...c?.entries()??[],...l?.entries()??[]]).flatMap(([u,a])=>{const d=a.get();return d&&(d.enabled??!0)?[{name:u,description:d.description,parameters:d.parameters}]:[]})}return{getToolDescriptions:i,getTool:n,registerTool:s}}function Xg(e,t){const n=new Set,s=new Set,r=new Ht(w=>new Bn(new Wg(k=>k.id,k=>k.parentId,(k,x)=>k.createdAt<x.createdAt))),i=new Bn(new Map);function o(w,k,x,R){const q=`ms_${$e()}`,et=di();return a(k==="user"?{id:q,chatId:w,role:k,parentId:x,createdAt:et,content:R,_optimistic:!0}:{id:q,chatId:w,role:k,parentId:x,createdAt:et,status:"generating",contentSoFar:[],copilotId:R,_optimistic:!0}),q}function c(w){Me(()=>{for(const k of w)a(k)})}function l(w,k){const x=r.get(w);if(!x)return;const R=x.get().get(k);!R||R.deletedAt||(R.role==="assistant"&&R.status!=="completed"?a({...R,deletedAt:di(),contentSoFar:[]}):a({...R,deletedAt:di(),content:[]}))}function u(w){const k=r.get(w);k!==void 0&&k.mutate(x=>x.clear())}function a(w){Me(()=>{if(r.getOrCreate(w.chatId).mutate(x=>x.upsert(w)),w.role==="assistant"&&w.status==="generating"?i.mutate(x=>{x.set(w.id,structuredClone(w))}):i.mutate(x=>{x.delete(w.id)}),w.role==="assistant"&&w.status==="awaiting-tool"){if(n.has(w.id))for(const x of w.contentSoFar.filter(R=>R.type==="tool-invocation"&&R.stage==="executing")){if(!s.has(x.invocationId))s.add(x.invocationId);else continue;const R=e.getTool(x.name,w.chatId).get()?.execute;R&&(async()=>{const q=await R(x.args,{name:x.name,invocationId:x.invocationId});return await t(w.chatId,w.id,x.invocationId,q??{data:{}},{copilotId:w.copilotId})})().catch(q=>{Ee(`Error trying to respond to tool-call: ${String(q)} (in execute())`)})}}else w.role==="assistant"&&w.status==="generating"||n.delete(w.id)})}function d(w,k){i.mutate(x=>{const R=x.get(w);return R===void 0?!1:(nm(R.contentSoFar,k),x.set(w,R),!0)})}function*f(){for(const w of r.values())for(const k of w.get())k.role==="assistant"&&k.status==="generating"&&!k._optimistic&&(yield k)}function g(){Me(()=>{i.mutate(w=>{let k=!1;for(const[x,R]of w)R._optimistic||(w.delete(x),k=!0);return k}),c(Array.from(f()).map(w=>({...w,status:"failed",errorReason:"Lost connection"})))})}function m(w){for(const k of r.values()){const x=k.get().get(w);if(x)return x}}function _(w){const k=w.next();return k.done?void 0:k.value}function N(w,k){function x(Q){if(!Q.deletedAt)return!0;for(const W of w.walkDown(Q.id,ot=>!ot.deletedAt))return!0;return!1}function R(Q){const W=[];let ot=null;for(const O of w.walkUp(Q.id)){const C=_(w.walkLeft(O.id,x))?.id??null,K=_(w.walkRight(O.id,x))?.id??null;if(!O.deletedAt||C||K){const $={...O,navigation:{parent:null,prev:C,next:K}};ot!==null&&(ot.navigation.parent=$.id),ot=$,W.push($)}}return W.reverse()}function q(){const Q=w.sorted.findRight(W=>!W.deletedAt);return Q?R(Q):[]}if(k===null)return q();const et=w.get(k);if(!et)return q();for(const Q of w.walkUp(et.id)){for(const W of w.walkDown(Q.id,ot=>!ot.deletedAt))return R(W);if(!Q.deletedAt)return R(Q)}return q()}const P=new Ht(w=>new Ht(k=>{const x=me.from(()=>{const R=r.getOrCreate(w).get();return N(R,k)},qg);return me.from(()=>{const R=i.get();return x.get().map(q=>{if(q.role!=="assistant"||q.status!=="generating")return q;const et=R.get(q.id);return et===void 0?q:{...q,contentSoFar:et.contentSoFar}})},Bi)}));function v(w,k){return P.getOrCreate(w).getOrCreate(k||null)}function U(w){return r.getOrCreate(w).get().sorted.findRight(R=>R.role==="assistant"&&!R.deletedAt)?.copilotId}return{getMessageById:m,getChatMessagesForBranch:v,getLastUsedCopilotId:U,createOptimistically:o,upsert:a,upsertMany:c,remove:l,removeByChatId:u,addDelta:d,failAllPending:g,markMine(w){n.add(w)},*getAutoExecutingMessageIds(){for(const w of n){const k=m(w);k?.role==="assistant"&&k.status==="awaiting-tool"&&k.contentSoFar.some(R=>R.type==="tool-invocation"&&R.stage==="executing"?typeof e.getTool(R.name,k.chatId).get()?.execute=="function":!1)&&(yield k.id)}}}}function Qg(){const e=new eg;function t(o){Me(()=>{for(const c of o)e.upsert(c)})}function n(o){e.upsert(o)}function s(o){e.markDeleted(o)}function r(o){return e.getEvenIfDeleted(o)}function i(o){return e.signal.get().findMany(o)}return{getChatById:r,findMany:i,upsert:n,upsertMany:t,markDeleted:s}}function tm(e){const t=new Fl(e.delegates,e.enableDebugLogging,!1),n=Qg(),s=Zg(),r=Jg(),i=Xg(s,Q),o={staticSessionInfoSig:new Nt(null),dynamicSessionInfoSig:new Nt(null),pendingCmds:new Map,chatsStore:n,messagesStore:i,toolsStore:s,knowledgeStore:r},c=new Nt("initial"),l=25;let u=[],a=null;function d(){const O=u;u=[],a!==null&&(clearTimeout(a),a=null),Me(()=>{for(const{id:C,delta:K}of O)o.messagesStore.addDelta(C,K)})}function f(O,C){u.push({id:O,delta:C}),a===null&&(a=setTimeout(d,l))}let g;function m(O){const C=t.authValue;if(C!==null){const K=Ro(C);if(K!==g)if(g=K,C.type==="secret"){const $=C.token.parsed;o.staticSessionInfoSig.set({userId:$.uid,userInfo:$.ui})}else o.staticSessionInfoSig.set({userId:void 0,userInfo:void 0})}c.set(O)}let _;function N(O){O==="reconnecting"?_=setTimeout(()=>{},e.lostConnectionTimeout):clearTimeout(_)}function P(){}function v(){d()}function U(O){if(typeof O.data!="string")return;const C=ge(O.data);if(!C)return;const K="cmdId"in C?C.cmdId:C.event==="cmd-failed"?C.failedCmdId:void 0,$=o.pendingCmds.get(K);if(K&&!$){_t("Ignoring unexpected command response. Already timed out, or not for us?",C);return}if("event"in C)if(C.event==="delta"){const{id:z,delta:lt}=C;f(z,lt)}else Me(()=>{switch(d(),C.event){case"cmd-failed":$?.reject(new Error(C.error));break;case"settle":{o.messagesStore.upsert(C.message);break}case"warning":_t(C.message);break;case"error":Ee(C.error);break;case"rebooted":o.messagesStore.failAllPending();break;case"sync":for(const z of C["-messages"]??[])o.messagesStore.remove(z.chatId,z.id);for(const z of C["-chats"]??[])o.chatsStore.markDeleted(z),o.messagesStore.removeByChatId(z);for(const z of C.clear??[])o.messagesStore.removeByChatId(z);C.chats&&o.chatsStore.upsertMany(C.chats),C.messages&&o.messagesStore.upsertMany(C.messages);break;default:return Et(C,"Unhandled case")}});else switch(C.cmd){case"get-chats":o.chatsStore.upsertMany(C.chats);break;case"get-or-create-chat":o.chatsStore.upsert(C.chat);break;case"delete-chat":o.chatsStore.markDeleted(C.chatId),o.messagesStore.removeByChatId(C.chatId);break;case"get-message-tree":o.chatsStore.upsert(C.chat),o.messagesStore.upsertMany(C.messages);break;case"delete-message":o.messagesStore.remove(C.chatId,C.messageId);break;case"clear-chat":o.messagesStore.removeByChatId(C.chatId);break;case"ask-in-chat":C.sourceMessage&&o.messagesStore.upsert(C.sourceMessage),o.messagesStore.upsert(C.targetMessage);break;case"abort-ai":break;case"set-tool-result":C.ok&&o.messagesStore.upsert(C.message);break;default:return Et(C,"Unhandled case")}$?.resolve(C)}t.events.onMessage.subscribe(U),t.events.statusDidChange.subscribe(m),t.events.statusDidChange.subscribe(N),t.events.didConnect.subscribe(P),t.events.didDisconnect.subscribe(v),t.events.onConnectionError.subscribe(({message:O,code:C})=>{});function w(){t.getStatus()==="initial"&&t.connect()}async function k(O){w(),t.getStatus()!=="connected"&&await t.events.didConnect.waitUntil();const{promise:C,resolve:K,reject:$}=Do(),z=AbortSignal.timeout(Gg);z.addEventListener("abort",()=>$(z.reason),{once:!0});const lt=$e(7);return o.pendingCmds.set(lt,{resolve:K,reject:$}),x({...O,cmdId:lt}),C.finally(()=>{o.pendingCmds.delete(lt)}).catch(mt=>{throw Ee(mt.message),mt})}function x(O){t.send(JSON.stringify({...O}))}function R(O={}){return k({cmd:"get-chats",cursor:O.cursor,query:O.query})}function q(O,C){return k({cmd:"get-or-create-chat",id:O,options:C})}function et(O){return k({cmd:"get-message-tree",chatId:O})}async function Q(O,C,K,$,z){const lt=o.knowledgeStore.getKnowledgeForChat(O),mt=o.toolsStore.getToolDescriptions(O),Mt=await k({cmd:"set-tool-result",chatId:O,messageId:C,invocationId:K,result:$,generationOptions:{copilotId:z?.copilotId,stream:z?.stream,timeout:z?.timeout,knowledge:lt.length>0?lt:void 0,tools:mt.length>0?mt:void 0}});Mt.ok&&i.markMine(Mt.message.id)}function W(){for(const O of o.messagesStore.getAutoExecutingMessageIds())k({cmd:"abort-ai",messageId:O}).catch(()=>{})}return(typeof window<"u"?window:void 0)?.addEventListener("beforeunload",W,{once:!0}),Object.defineProperty({[sn]:{context:o},connectInitially:w,disconnect:()=>t.disconnect(),getChats:R,getOrCreateChat:q,deleteChat:O=>k({cmd:"delete-chat",chatId:O}),getMessageTree:et,deleteMessage:(O,C)=>k({cmd:"delete-message",chatId:O,messageId:C}),clearChat:O=>k({cmd:"clear-chat",chatId:O}),askUserMessageInChat:async(O,C,K,$)=>{const z=o.knowledgeStore.getKnowledgeForChat(O),lt=$?.knowledge||[],mt=[...z,...lt],Mt=o.toolsStore.getToolDescriptions(O);return i.markMine(K),await k({cmd:"ask-in-chat",chatId:O,sourceMessage:C,targetMessageId:K,generationOptions:{copilotId:$?.copilotId,stream:$?.stream,timeout:$?.timeout,knowledge:mt.length>0?mt:void 0,tools:Mt.length>0?Mt:void 0}})},abort:O=>k({cmd:"abort-ai",messageId:O}),setToolResult:Q,getStatus:()=>t.getStatus(),signals:{getChatMessagesForBranch:o.messagesStore.getChatMessagesForBranch,getTool:o.toolsStore.getTool,status:c},getChatById:o.chatsStore.getChatById,queryChats:o.chatsStore.findMany,getLastUsedCopilotId:o.messagesStore.getLastUsedCopilotId,registerKnowledgeLayer:(O,C)=>{const K=o.knowledgeStore.getKnowledgeStack(C),$=K.registerLayer(O);return{layerKey:$,deregister:()=>K.deregisterLayer($)}},updateKnowledge:(O,C,K,$)=>{o.knowledgeStore.getKnowledgeStack($).updateKnowledge(O,K??$e(),C)},registerTool:o.toolsStore.registerTool},sn,{enumerable:!1})}function em(e,t){return n=>{const s=t??(typeof WebSocket>"u"?void 0:WebSocket);if(s===void 0)throw new we("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");const r=new URL(e);if(r.protocol=r.protocol==="http:"?"ws":"wss",r.pathname="/ai/v7",n.type==="secret")r.searchParams.set("tok",n.token.raw);else{if(n.type==="public")throw new Error("Public key not supported with AI Copilots");return Et(n,"Unhandled case")}return r.searchParams.set("version",Ur),new s(r.toString())}}function $c(e,t,n,s){const r=Jp(e,i=>i.type===t.type&&n(i)===n(t));r>-1?e[r]=t:(Vi(e[e.length-1],s),e.push(t))}function Vi(e,t){e?.type==="reasoning"&&(e.endedAt??=t)}function nm(e,t){if(t===null)return;const n=e.filter(o=>o.type!=="sources"),s=e.filter(o=>o.type==="sources").flatMap(o=>o.sources),r=new Date().toISOString(),i=n[n.length-1];switch(t.type){case"text-delta":i?.type==="text"?i.text+=t.textDelta:(Vi(i,r),n.push({type:"text",text:t.textDelta}));break;case"reasoning-delta":i?.type==="reasoning"?i.text+=t.textDelta:(Vi(i,r),n.push({type:"reasoning",text:t.textDelta,startedAt:r}));break;case"tool-stream":{const o=sm(t.invocationId,t.name);n.push(o);break}case"tool-delta":{i?.type==="tool-invocation"&&i.stage==="receiving"&&i.__appendDelta?.(t.delta);break}case"tool-invocation":$c(n,t,o=>o.invocationId,r);break;case"retrieval":$c(n,t,o=>o.id,r);break;case"source":{s.push(t);break}default:return Et(t,"Unhandled case")}s.length>0&&n.push({type:"sources",sources:s}),e.length=0,e.push(...n)}function sm(e,t,n=""){const s=new jg(n);return{type:"tool-invocation",stage:"receiving",invocationId:e,name:t,get partialArgsText(){return s.source},get partialArgs(){return s.json},__appendDelta(r){s.append(r)}}}function Hi(e){return e.includes("room:write")}function jl(e){return e.includes("comments:write")||e.includes("room:write")}function rm(e){return ie(e)&&(e.k==="acc"||e.k==="id")}function Bc(e){const t=e.split(".");if(t.length!==3)throw new Error("Authentication error: invalid JWT token");const n=ge(Gp(t[1]));if(!(n&&rm(n)))throw new Error("Authentication error: expected a valid token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback");return{raw:e,parsed:n}}var im=[400,401,403,404,405,410,412,414,422,431,451];function om(e,t){const n=cm(e),s=new Set,r=[],i=[],o=new Map;function c(){s.clear(),r.length=0,i.length=0,o.clear()}function l(f,g){return f==="comments:read"?g.includes("comments:read")||g.includes("comments:write")||g.includes("room:read")||g.includes("room:write"):f==="room:read"?g.includes("room:read")||g.includes("room:write"):!1}function u(f){const g=Math.ceil(Date.now()/1e3);for(let m=r.length-1;m>=0;m--){const _=r[m];if(i[m]<=g){r.splice(m,1),i.splice(m,1);continue}if(_.parsed.k==="id")return _;if(_.parsed.k==="acc"){if(!f.roomId&&Object.entries(_.parsed.perms).length===0)return _;for(const[P,v]of Object.entries(_.parsed.perms))if(f.roomId){if(P.includes("*")&&f.roomId.startsWith(P.replace("*",""))||f.roomId===P&&l(f.requestedScope,v))return _}else if(P.includes("*")&&l(f.requestedScope,v))return _}}}async function a(f){const g=e.polyfills?.fetch??(typeof window>"u"?void 0:window.fetch);if(n.type==="private"){if(g===void 0)throw new we("To use Liveblocks client in a non-DOM environment with a url as auth endpoint, you need to provide a fetch polyfill.");const m=await am(g,n.url,{room:f.roomId}),_=Bc(m.token);if(s.has(_.raw))throw new we("The same Liveblocks auth token was issued from the backend before. Caching Liveblocks tokens is not supported.");return t?.(_.parsed),_}if(n.type==="custom"){const m=await n.callback(f.roomId);if(m&&typeof m=="object"){if(typeof m.token=="string"){const _=Bc(m.token);return t?.(_.parsed),_}else if(typeof m.error=="string"){const _=`Authentication failed: ${"reason"in m&&typeof m.reason=="string"?m.reason:"Forbidden"}`;throw m.error==="forbidden"?new we(_):new Error(_)}}throw new Error('Your authentication callback function should return a token, but it did not. Hint: the return value should look like: { token: "..." }')}throw new Error("Unexpected authentication type. Must be private or custom.")}async function d(f){if(n.type==="public")return{type:"public",publicApiKey:n.publicApiKey};const g=u(f);if(g!==void 0)return{type:"secret",token:g};let m;f.roomId?(m=o.get(f.roomId),m===void 0&&(m=a(f),o.set(f.roomId,m))):(m=o.get("liveblocks-user-token"),m===void 0&&(m=a(f),o.set("liveblocks-user-token",m)));try{const _=await m,P=Math.floor(Date.now()/1e3)+(_.parsed.exp-_.parsed.iat)-30;return s.add(_.raw),r.push(_),i.push(P),{type:"secret",token:_}}finally{f.roomId?o.delete(f.roomId):o.delete("liveblocks-user-token")}}return{reset:c,getAuthValue:d}}function cm(e){const{publicApiKey:t,authEndpoint:n}=e;if(n!==void 0&&t!==void 0)throw new Error("You cannot simultaneously use `publicApiKey` and `authEndpoint` options. Please pick one and leave the other option unspecified. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if(typeof t=="string"){if(t.startsWith("sk_"))throw new Error("Invalid `publicApiKey` option. The value you passed is a secret key, which should not be used from the client. Please only ever pass a public key here. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!t.startsWith("pk_"))throw new Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:t}}if(typeof n=="string")return{type:"private",url:n};if(typeof n=="function")return{type:"custom",callback:n};throw n!==void 0?new Error("The `authEndpoint` option must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint"):new Error("Invalid Liveblocks client options. Please provide either a `publicApiKey` or `authEndpoint` option. They cannot both be empty. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}async function am(e,t,n){const s=await e(t,{method:"POST",headers:{"Content-Type":"application/json"},body:ye(n)});if(!s.ok){const o=`${(await s.text()).trim()||"reason not provided in auth response"} (${s.status} returned by POST ${t})`;throw im.includes(s.status)?new we(`Unauthorized: ${o}`):new Error(`Failed to authenticate: ${o}`)}let r;try{r=await s.json()}catch(o){throw new Error(`Expected a JSON response when doing a POST request on "${t}". ${String(o)}`)}if(!ie(r)||typeof r.token!="string")throw new Error(`Expected a JSON response of the form \`{ token: "..." }\` when doing a POST request on "${t}", but got ${ye(r)}`);const{token:i}=r;return{token:i}}var lm="https://api.liveblocks.io",um=Y();um.observable;function hi(e,t,n=t){typeof e=="function"&&e()}var Vc=Symbol("notification-settings-plain");function Hc(e){const t=["email","slack","teams","webPush"],n={[Vc]:{value:e,enumerable:!1}};for(const s of t)n[s]={enumerable:!0,get(){const r=this[Vc][s];return typeof r>"u"?(Ee(`In order to use the '${s}' channel, please set up your project first. For more information: https://liveblocks.io/docs/errors/enable-a-notification-channel`),null):r}};return Wp(null,n)}var Oe="12px",dm=(e="bottom-right")=>{if(typeof document>"u"||document.getElementById("liveblocks-badge"))return;const t=document.createElement("div");switch(t.id="liveblocks-badge",t.style.position="fixed",t.style.opacity="0",t.style.transition="opacity 300ms",t.style.zIndex="9999",e){case"top-right":t.style.top=Oe,t.style.right=Oe;break;case"bottom-right":t.style.bottom=Oe,t.style.right=Oe;break;case"bottom-left":t.style.bottom=Oe,t.style.left=Oe;break;case"top-left":t.style.top=Oe,t.style.left=Oe;break}t.onmouseenter=()=>{const m=document.getElementById("liveblocks-badge-hide-button");m&&(m.style.opacity="0.3")},t.onmouseleave=()=>{const m=document.getElementById("liveblocks-badge-hide-button");m&&(m.style.opacity="0")};const n=document.createElement("a");n.href="https://lblcks.io/badge",n.target="_blank",n.rel="noopener noreferrer",n.title="Liveblocks";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width","111"),s.setAttribute("height","38"),s.setAttribute("viewBox","0 0 111 38"),s.setAttribute("fill","none");const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x","1"),r.setAttribute("y","1"),r.setAttribute("width","109"),r.setAttribute("height","36"),r.setAttribute("rx","8"),r.setAttribute("fill","white"),s.appendChild(r);const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x","0.5"),i.setAttribute("y","0.5"),i.setAttribute("width","110"),i.setAttribute("height","37"),i.setAttribute("rx","8.5"),i.setAttribute("stroke","black"),i.setAttribute("stroke-opacity","0.1"),s.appendChild(i);const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M39.8256 18.0832H38L38.0005 28.9009H39.8256V18.0832ZM43.213 21.1757H41.3879V28.9009H43.213V21.1757ZM43.213 18H41.3879V19.9688H43.213V18ZM45.8916 21.1757H43.9302L46.6915 28.9009H48.7283L51.4896 21.1757H49.5581L48.4039 24.8348C48.3739 24.93 48.2657 25.3024 48.0795 25.9511L47.7099 27.1959C47.4914 26.406 47.2626 25.6189 47.0237 24.8348L45.8916 21.1757ZM58.9659 23.59C58.8147 23.0721 58.5934 22.6317 58.3014 22.2694C57.9743 21.8628 57.5598 21.5482 57.0571 21.3268C56.5589 21.1004 56.0058 20.9877 55.3973 20.9877C54.2407 20.9877 53.3152 21.3495 52.6212 22.0735C52.275 22.4476 52.0103 22.8896 51.844 23.3715C51.6731 23.8691 51.5876 24.4199 51.5876 25.0233C51.5876 26.3157 51.9322 27.3142 52.6217 28.0184C53.3203 28.7323 54.2509 29.0894 55.4125 29.0894C56.4083 29.0894 57.2151 28.8658 57.8342 28.4181C58.453 27.9704 58.8628 27.3068 59.0638 26.4266L57.2834 26.2908C57.198 26.7685 57.0016 27.1257 56.6948 27.3618C56.3879 27.5933 55.9555 27.7093 55.3973 27.7093C54.1201 27.7093 53.4663 26.9899 53.4363 25.5514H59.1844L59.1922 25.295C59.1922 24.6763 59.1165 24.108 58.9659 23.59ZM53.8434 23.0471C54.1654 22.5943 54.6834 22.3679 55.3973 22.3679C55.7443 22.3679 56.0363 22.4155 56.2725 22.5111C56.509 22.6067 56.7128 22.7601 56.8837 22.9713C57.0167 23.1352 57.1189 23.3218 57.1855 23.5221C57.2605 23.731 57.3062 23.9493 57.3213 24.1708H53.451C53.4964 23.7231 53.6271 23.3484 53.8434 23.0471ZM66.2836 21.4779C65.7656 21.1406 65.1673 20.9724 64.4885 20.9724H64.4875C63.995 20.9724 63.5449 21.0727 63.1374 21.2742C62.7364 21.4696 62.3931 21.7659 62.1412 22.1341V18.0832H60.316V28.9009H62.1416V27.8373C62.373 28.2195 62.7008 28.5342 63.0921 28.7499C63.4996 28.9763 63.9497 29.0894 64.4422 29.0894C65.1266 29.0894 65.7324 28.9259 66.2614 28.5992C66.7891 28.2726 67.1989 27.8045 67.4905 27.1959C67.7871 26.5823 67.9359 25.8634 67.9359 25.0386C67.9359 24.2337 67.7895 23.5248 67.4984 22.9113C67.2115 22.2926 66.8066 21.8148 66.2836 21.4779ZM65.5064 27.0828C65.2148 27.5254 64.7172 27.7463 64.0125 27.7463C63.3786 27.7463 62.9013 27.5175 62.5797 27.0601C62.2576 26.6026 62.0968 25.9336 62.0968 25.0534C62.0968 24.2032 62.24 23.5397 62.5265 23.0619C62.8185 22.579 63.3088 22.3378 63.9978 22.3378C64.7019 22.3378 65.2023 22.5592 65.499 23.0013C65.7961 23.4389 65.944 24.1181 65.944 25.0386C65.944 25.9585 65.7985 26.6401 65.5064 27.0828ZM70.901 18.0832H69.0754V28.9009H70.901V18.0832ZM73.8582 28.6066C74.452 28.9286 75.1558 29.0894 75.9708 29.0894C76.7554 29.0894 77.4444 28.9208 78.0377 28.5844C78.6268 28.2569 79.1068 27.7637 79.4183 27.1659C79.745 26.5523 79.9086 25.843 79.9086 25.0386C79.9086 24.2642 79.7478 23.5697 79.4257 22.9565C79.117 22.3516 78.6404 21.8487 78.0529 21.508C77.4592 21.161 76.7652 20.9872 75.9708 20.9872C75.171 20.9872 74.4719 21.161 73.8735 21.508C73.2876 21.8472 72.811 22.3471 72.5002 22.9486C72.1837 23.5572 72.0252 24.254 72.0252 25.0386C72.0252 25.8735 72.181 26.5948 72.4929 27.2033C72.7962 27.798 73.2722 28.2871 73.8582 28.6066ZM77.4869 27.0906C77.18 27.5231 76.6746 27.7393 75.9708 27.7393C75.493 27.7393 75.1082 27.6437 74.8166 27.4524C74.5246 27.2565 74.3134 26.9621 74.1826 26.5699C74.0518 26.1725 73.9867 25.6619 73.9867 25.0381C73.9867 24.1029 74.1401 23.419 74.4469 22.9866C74.7588 22.5541 75.2667 22.3378 75.9708 22.3378C76.6699 22.3378 77.1727 22.5541 77.4795 22.9866C77.7914 23.419 77.9471 24.1029 77.9471 25.0386C77.9471 25.9738 77.7937 26.6576 77.4869 27.0906ZM82.3982 28.6066C82.9869 28.9286 83.6883 29.0894 84.5033 29.0894C85.1369 29.0894 85.7029 28.9791 86.2005 28.7577C86.6989 28.5364 87.1031 28.2272 87.4152 27.8299C87.7279 27.4249 87.9329 26.9471 88.0109 26.4414L86.2534 26.2607C86.1328 26.7431 85.9316 27.1031 85.6497 27.3392C85.3683 27.5757 84.9857 27.694 84.5033 27.694C84.0103 27.694 83.6232 27.5933 83.3413 27.3918C83.0598 27.1858 82.8635 26.8919 82.7531 26.5093C82.6422 26.1221 82.5872 25.6318 82.5872 25.0386C82.5872 24.455 82.6422 23.9722 82.7531 23.59C82.8635 23.2028 83.0571 22.9062 83.3339 22.6997C83.6157 22.4884 84.0053 22.3831 84.5033 22.3831C85.0362 22.3831 85.4312 22.5314 85.6877 22.8281C85.949 23.1196 86.1354 23.5193 86.2456 24.0276L87.9735 23.718C87.8078 22.8932 87.4326 22.232 86.8491 21.7344C86.2708 21.2363 85.489 20.9877 84.5033 20.9877C83.6985 20.9877 83.0021 21.1587 82.4134 21.5006C81.8322 21.8351 81.3625 22.3337 81.0633 22.9339C80.7514 23.5424 80.5952 24.2439 80.5952 25.0386C80.5952 25.8781 80.7486 26.6026 81.0554 27.2112C81.3673 27.8197 81.8151 28.285 82.3982 28.6066ZM90.8104 26.0343L91.6627 25.2192L93.9257 28.9009H96.0308L92.8999 24.0498L95.9328 21.1757H93.5634L90.8104 23.9976V18.0832H88.9845V28.9009H90.8104V26.0343ZM97.6304 28.8103C98.1436 28.9965 98.7142 29.0894 99.3428 29.0894C100.303 29.0894 101.095 28.8981 101.719 28.5165C102.348 28.1339 102.663 27.5101 102.663 26.6451C102.663 26.0818 102.516 25.6392 102.225 25.3176C101.933 24.9905 101.586 24.7566 101.184 24.6157C100.786 24.4702 100.245 24.3219 99.562 24.1707C99.1642 24.0853 98.8502 24.0049 98.6188 23.9295C98.3873 23.8538 98.201 23.7558 98.0604 23.6352C97.925 23.5141 97.8567 23.3584 97.8567 23.1676C97.8567 22.8858 97.9824 22.6723 98.2338 22.5263C98.4853 22.3803 98.7973 22.3073 99.1694 22.3073C99.6619 22.3073 100.047 22.4255 100.324 22.6621C100.605 22.8987 100.756 23.2531 100.776 23.7258L102.466 23.4467C102.385 22.5817 102.046 21.9556 101.447 21.568C100.854 21.1812 100.095 20.9872 99.1694 20.9872C98.6258 20.9872 98.1236 21.0699 97.6607 21.2362C97.2029 21.397 96.8335 21.6511 96.5517 21.9986C96.27 22.3451 96.1294 22.7827 96.1294 23.3109C96.1294 23.7988 96.25 24.1934 96.4911 24.4951C96.7368 24.8001 97.0527 25.0408 97.4118 25.1965C97.7838 25.3578 98.2512 25.5112 98.8147 25.6567L99.2828 25.7699C99.5949 25.844 99.9044 25.9295 100.211 26.0264C100.421 26.092 100.595 26.1826 100.731 26.2981C100.867 26.4136 100.935 26.5647 100.935 26.7509C100.935 27.0776 100.799 27.3294 100.527 27.505C100.261 27.6815 99.8708 27.7693 99.3583 27.7693C98.8347 27.7693 98.4176 27.6385 98.1055 27.377C97.7941 27.1154 97.6355 26.7384 97.6304 26.2454L95.9109 26.4413C95.9302 27.0351 96.094 27.5304 96.4009 27.9278C96.7129 28.3252 97.1223 28.619 97.6304 28.8103Z"),o.setAttribute("fill","black"),s.appendChild(o);const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d","M37.6392 15V9.18182H39.7131C40.1657 9.18182 40.5407 9.2642 40.8381 9.42898C41.1354 9.59375 41.358 9.81913 41.5057 10.1051C41.6534 10.3892 41.7273 10.7093 41.7273 11.0653C41.7273 11.4233 41.6525 11.7453 41.5028 12.0312C41.3551 12.3153 41.1316 12.5407 40.8324 12.7074C40.535 12.8722 40.161 12.9545 39.7102 12.9545H38.2841V12.2102H39.6307C39.9167 12.2102 40.1487 12.161 40.3267 12.0625C40.5047 11.9621 40.6354 11.8258 40.7188 11.6534C40.8021 11.4811 40.8438 11.285 40.8438 11.0653C40.8438 10.8456 40.8021 10.6506 40.7188 10.4801C40.6354 10.3097 40.5038 10.1761 40.3239 10.0795C40.1458 9.98295 39.911 9.93466 39.6193 9.93466H38.517V15H37.6392ZM44.4716 15.0881C44.0625 15.0881 43.7055 14.9943 43.4006 14.8068C43.0956 14.6193 42.8589 14.357 42.6903 14.0199C42.5218 13.6828 42.4375 13.2888 42.4375 12.8381C42.4375 12.3854 42.5218 11.9896 42.6903 11.6506C42.8589 11.3116 43.0956 11.0483 43.4006 10.8608C43.7055 10.6733 44.0625 10.5795 44.4716 10.5795C44.8807 10.5795 45.2377 10.6733 45.5426 10.8608C45.8475 11.0483 46.0843 11.3116 46.2528 11.6506C46.4214 11.9896 46.5057 12.3854 46.5057 12.8381C46.5057 13.2888 46.4214 13.6828 46.2528 14.0199C46.0843 14.357 45.8475 14.6193 45.5426 14.8068C45.2377 14.9943 44.8807 15.0881 44.4716 15.0881ZM44.4744 14.375C44.7396 14.375 44.9593 14.3049 45.1335 14.1648C45.3078 14.0246 45.4366 13.8381 45.5199 13.6051C45.6051 13.3722 45.6477 13.1155 45.6477 12.8352C45.6477 12.5568 45.6051 12.3011 45.5199 12.0682C45.4366 11.8333 45.3078 11.6449 45.1335 11.5028C44.9593 11.3608 44.7396 11.2898 44.4744 11.2898C44.2074 11.2898 43.9858 11.3608 43.8097 11.5028C43.6354 11.6449 43.5057 11.8333 43.4205 12.0682C43.3371 12.3011 43.2955 12.5568 43.2955 12.8352C43.2955 13.1155 43.3371 13.3722 43.4205 13.6051C43.5057 13.8381 43.6354 14.0246 43.8097 14.1648C43.9858 14.3049 44.2074 14.375 44.4744 14.375ZM48.267 15L46.983 10.6364H47.8608L48.7159 13.8409H48.7585L49.6165 10.6364H50.4943L51.3466 13.8267H51.3892L52.2386 10.6364H53.1165L51.8352 15H50.9688L50.0824 11.8494H50.017L49.1307 15H48.267ZM55.6705 15.0881C55.2405 15.0881 54.8703 14.9962 54.5597 14.8125C54.2509 14.6269 54.0123 14.3665 53.8438 14.0312C53.6771 13.6941 53.5938 13.2992 53.5938 12.8466C53.5938 12.3996 53.6771 12.0057 53.8438 11.6648C54.0123 11.3239 54.2472 11.0578 54.5483 10.8665C54.8513 10.6752 55.2055 10.5795 55.6108 10.5795C55.857 10.5795 56.0956 10.6203 56.3267 10.7017C56.5578 10.7831 56.7652 10.911 56.9489 11.0852C57.1326 11.2595 57.2775 11.4858 57.3835 11.7642C57.4896 12.0407 57.5426 12.3769 57.5426 12.7727V13.0739H54.0739V12.4375H56.7102C56.7102 12.214 56.6648 12.0161 56.5739 11.8438C56.483 11.6695 56.3551 11.5322 56.1903 11.4318C56.0275 11.3314 55.8362 11.2812 55.6165 11.2812C55.3778 11.2812 55.1695 11.34 54.9915 11.4574C54.8153 11.5729 54.679 11.7244 54.5824 11.9119C54.4877 12.0975 54.4403 12.2992 54.4403 12.517V13.0142C54.4403 13.3059 54.4915 13.554 54.5938 13.7585C54.6979 13.9631 54.8428 14.1193 55.0284 14.2273C55.214 14.3333 55.4309 14.3864 55.679 14.3864C55.84 14.3864 55.9867 14.3636 56.1193 14.3182C56.2519 14.2708 56.3665 14.2008 56.4631 14.108C56.5597 14.0152 56.6335 13.9006 56.6847 13.7642L57.4886 13.9091C57.4242 14.1458 57.3087 14.3532 57.142 14.5312C56.9773 14.7074 56.7699 14.8447 56.5199 14.9432C56.2718 15.0398 55.9886 15.0881 55.6705 15.0881ZM58.4851 15V10.6364H59.3061V11.3295H59.3516C59.4311 11.0947 59.5713 10.91 59.772 10.7756C59.9747 10.6392 60.2038 10.571 60.4595 10.571C60.5125 10.571 60.575 10.5729 60.647 10.5767C60.7209 10.5805 60.7786 10.5852 60.8203 10.5909V11.4034C60.7862 11.3939 60.7256 11.3835 60.6385 11.3722C60.5514 11.3589 60.4643 11.3523 60.3771 11.3523C60.1764 11.3523 59.9974 11.3949 59.8402 11.4801C59.6849 11.5634 59.5618 11.6799 59.4709 11.8295C59.38 11.9773 59.3345 12.1458 59.3345 12.3352V15H58.4851ZM63.2798 15.0881C62.8499 15.0881 62.4796 14.9962 62.169 14.8125C61.8603 14.6269 61.6217 14.3665 61.4531 14.0312C61.2865 13.6941 61.2031 13.2992 61.2031 12.8466C61.2031 12.3996 61.2865 12.0057 61.4531 11.6648C61.6217 11.3239 61.8565 11.0578 62.1577 10.8665C62.4607 10.6752 62.8149 10.5795 63.2202 10.5795C63.4664 10.5795 63.705 10.6203 63.9361 10.7017C64.1671 10.7831 64.3745 10.911 64.5582 11.0852C64.742 11.2595 64.8868 11.4858 64.9929 11.7642C65.099 12.0407 65.152 12.3769 65.152 12.7727V13.0739H61.6832V12.4375H64.3196C64.3196 12.214 64.2741 12.0161 64.1832 11.8438C64.0923 11.6695 63.9645 11.5322 63.7997 11.4318C63.6368 11.3314 63.4455 11.2812 63.2259 11.2812C62.9872 11.2812 62.7789 11.34 62.6009 11.4574C62.4247 11.5729 62.2884 11.7244 62.1918 11.9119C62.0971 12.0975 62.0497 12.2992 62.0497 12.517V13.0142C62.0497 13.3059 62.1009 13.554 62.2031 13.7585C62.3073 13.9631 62.4522 14.1193 62.6378 14.2273C62.8234 14.3333 63.0402 14.3864 63.2884 14.3864C63.4493 14.3864 63.5961 14.3636 63.7287 14.3182C63.8613 14.2708 63.9759 14.2008 64.0724 14.108C64.169 14.0152 64.2429 13.9006 64.294 13.7642L65.098 13.9091C65.0336 14.1458 64.9181 14.3532 64.7514 14.5312C64.5866 14.7074 64.3793 14.8447 64.1293 14.9432C63.8812 15.0398 63.598 15.0881 63.2798 15.0881ZM67.728 15.0852C67.3757 15.0852 67.0613 14.9953 66.7848 14.8153C66.5102 14.6335 66.2943 14.375 66.1371 14.0398C65.9818 13.7027 65.9041 13.2983 65.9041 12.8267C65.9041 12.3551 65.9827 11.9517 66.1399 11.6165C66.299 11.2812 66.5168 11.0246 66.7933 10.8466C67.0698 10.6686 67.3833 10.5795 67.7337 10.5795C68.0045 10.5795 68.2223 10.625 68.3871 10.7159C68.5537 10.8049 68.6825 10.9091 68.7734 11.0284C68.8662 11.1477 68.9382 11.2528 68.9893 11.3438H69.0405V9.18182H69.8899V15H69.0604V14.321H68.9893C68.9382 14.4138 68.8643 14.5199 68.7678 14.6392C68.6731 14.7585 68.5424 14.8627 68.3757 14.9517C68.209 15.0407 67.9931 15.0852 67.728 15.0852ZM67.9155 14.3608C68.1598 14.3608 68.3662 14.2964 68.5348 14.1676C68.7053 14.0369 68.834 13.8561 68.9212 13.625C69.0102 13.3939 69.0547 13.125 69.0547 12.8182C69.0547 12.5152 69.0111 12.25 68.924 12.0227C68.8369 11.7955 68.709 11.6184 68.5405 11.4915C68.3719 11.3646 68.1636 11.3011 67.9155 11.3011C67.6598 11.3011 67.4467 11.3674 67.2763 11.5C67.1058 11.6326 66.977 11.8134 66.8899 12.0426C66.8047 12.2718 66.7621 12.5303 66.7621 12.8182C66.7621 13.1098 66.8056 13.3722 66.8928 13.6051C66.9799 13.8381 67.1087 14.0227 67.2791 14.1591C67.4515 14.2936 67.6636 14.3608 67.9155 14.3608ZM73.2876 15V9.18182H74.1371V11.3438H74.1882C74.2375 11.2528 74.3085 11.1477 74.4013 11.0284C74.4941 10.9091 74.6229 10.8049 74.7876 10.7159C74.9524 10.625 75.1702 10.5795 75.4411 10.5795C75.7933 10.5795 76.1077 10.6686 76.3842 10.8466C76.6607 11.0246 76.8776 11.2812 77.0348 11.6165C77.1939 11.9517 77.2734 12.3551 77.2734 12.8267C77.2734 13.2983 77.1948 13.7027 77.0376 14.0398C76.8804 14.375 76.6645 14.6335 76.3899 14.8153C76.1153 14.9953 75.8018 15.0852 75.4496 15.0852C75.1844 15.0852 74.9676 15.0407 74.799 14.9517C74.6323 14.8627 74.5017 14.7585 74.407 14.6392C74.3123 14.5199 74.2393 14.4138 74.1882 14.321H74.1172V15H73.2876ZM74.12 12.8182C74.12 13.125 74.1645 13.3939 74.2536 13.625C74.3426 13.8561 74.4714 14.0369 74.6399 14.1676C74.8085 14.2964 75.0149 14.3608 75.2592 14.3608C75.513 14.3608 75.7251 14.2936 75.8956 14.1591C76.0661 14.0227 76.1948 13.8381 76.282 13.6051C76.371 13.3722 76.4155 13.1098 76.4155 12.8182C76.4155 12.5303 76.3719 12.2718 76.2848 12.0426C76.1996 11.8134 76.0708 11.6326 75.8984 11.5C75.728 11.3674 75.5149 11.3011 75.2592 11.3011C75.013 11.3011 74.8047 11.3646 74.6342 11.4915C74.4657 11.6184 74.3378 11.7955 74.2507 12.0227C74.1636 12.25 74.12 12.5152 74.12 12.8182ZM78.6158 16.6364C78.4889 16.6364 78.3733 16.6259 78.2692 16.6051C78.165 16.5862 78.0874 16.5653 78.0362 16.5426L78.2408 15.8466C78.3961 15.8883 78.5343 15.9063 78.6555 15.9006C78.7768 15.8949 78.8838 15.8494 78.9766 15.7642C79.0713 15.679 79.1546 15.5398 79.2266 15.3466L79.3317 15.0568L77.7351 10.6364H78.6442L79.7493 14.0227H79.7947L80.8999 10.6364H81.8118L80.0135 15.5824C79.9302 15.8097 79.8241 16.0019 79.6953 16.1591C79.5665 16.3182 79.4131 16.4375 79.2351 16.517C79.0571 16.5966 78.8506 16.6364 78.6158 16.6364Z"),c.setAttribute("fill","black"),c.setAttribute("fill-opacity","0.5"),s.appendChild(c);const l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("x","7"),l.setAttribute("y","7"),l.setAttribute("width","24"),l.setAttribute("height","24"),l.setAttribute("rx","3"),l.setAttribute("fill","black"),s.appendChild(l);const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("fill-rule","evenodd"),u.setAttribute("clip-rule","evenodd"),u.setAttribute("d","M22.0455 15H12.2273L15.1364 17.9091V21.9091L22.0455 15Z"),u.setAttribute("fill","white"),s.appendChild(u);const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("fill-rule","evenodd"),a.setAttribute("clip-rule","evenodd"),a.setAttribute("d","M16.9546 22.9999H26.7728L23.8637 20.0908V16.0908L16.9546 22.9999Z"),a.setAttribute("fill","white"),s.appendChild(a),n.appendChild(s),t.appendChild(n);const d=document.createElement("button");d.id="liveblocks-badge-hide-button",d.style.position="absolute",d.style.top="0",d.style.right="0",d.style.border="none",d.style.padding="0",d.style.margin="0",d.style.background="none",d.style.font="inherit",d.style.cursor="pointer",d.style.outline="none",d.style.setProperty("-webkit-appearance","none"),d.style.setProperty("-moz-appearance","none"),d.style.setProperty("appearance","none"),d.style.opacity="0",d.onclick=()=>{const m=document.getElementById("liveblocks-badge");m&&(m.style.display="none")},d.onmouseenter=()=>{d.style.opacity="0.5"},d.onmouseleave=()=>{d.style.opacity="0.3"};const f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("width","18"),f.setAttribute("height","18"),f.setAttribute("viewBox","0 0 18 18"),f.setAttribute("fill","none");const g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d","M6 6L9 9M12 12L9 9M9 9L12 6M9 9L6 12"),g.setAttribute("stroke","black"),f.appendChild(g),d.appendChild(f),t.appendChild(d),document.body.appendChild(t),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.style.opacity="1"})})},Jt=32,Be=126,hm=Be-Jt+1,Lo=Po(0),$r=Po(1),fm=Lo+Po(-1);function Po(e){const t=Jt+(e<0?hm+e:e);if(t<Jt||t>Be)throw new Error(`Invalid n value: ${e}`);return String.fromCharCode(t)}function ue(e,t){return e!==void 0&&t!==void 0?mm(e,t):e!==void 0?gm(e):t!==void 0?pm(t):$r}function pm(e){const t=e.length-1;for(let n=0;n<=t;n++){const s=e.charCodeAt(n);if(!(s<=Jt))return n===t?s===Jt+1?e.substring(0,n)+fm:e.substring(0,n)+String.fromCharCode(s-1):e.substring(0,n+1)}return $r}function gm(e){for(let t=0;t<=e.length-1;t++){const n=e.charCodeAt(t);if(!(n>=Be))return e.substring(0,t)+String.fromCharCode(n+1)}return e+$r}function mm(e,t){if(e<t)return Fi(e,t);if(e>t)return Fi(t,e);throw new Error("Cannot compute value between two equal positions")}function Fi(e,t){let n=0;const s=e.length,r=t.length;for(;;){const i=n<s?e.charCodeAt(n):Jt,o=n<r?t.charCodeAt(n):Be;if(i===o){n++;continue}if(o-i===1){const c=n+1;let l=e.substring(0,c);l.length<c&&(l+=Lo.repeat(c-l.length));const u=e.substring(c);return l+Fi(u,"")}else return ym(e,n)+String.fromCharCode(o+i>>1)}}function ym(e,t){return t<e.length?e.substring(0,t):e+Lo.repeat(t-e.length)}var wm=Jt+1;function bm(e){if(e==="")return!1;const t=e.length-1,n=e.charCodeAt(t);if(n<wm||n>Be)return!1;for(let s=0;s<t;s++){const r=e.charCodeAt(s);if(r<Jt||r>Be)return!1}return!0}function _m(e){const t=[];for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t.push(s<Jt?Jt:s>Be?Be:s)}for(;t.length>0&&t[t.length-1]===Jt;)t.length--;return t.length>0?String.fromCharCode(...t):$r}function vs(e){return bm(e)?e:_m(e)}var L=Object.freeze({INIT:0,SET_PARENT_KEY:1,CREATE_LIST:2,UPDATE_OBJECT:3,CREATE_OBJECT:4,DELETE_CRDT:5,DELETE_OBJECT_KEY:6,CREATE_MAP:7,CREATE_REGISTER:8});function Sm(e){return e.type===L.DELETE_CRDT&&e.id==="ACK"}function Em(e,t){const{getCurrentConnectionId:n,onDispatch:s,isStorageWritable:r=()=>!0}=t;let i=0,o=0;const c=new Map;return{roomId:e,nodes:c,getNode:l=>c.get(l),addNode:(l,u)=>{c.set(l,u)},deleteNode:l=>{c.delete(l)},generateId:()=>`${n()}:${i++}`,generateOpId:()=>`${n()}:${o++}`,dispatch(l,u,a){s?.(l,u,a)},assertStorageIsWritable:()=>{if(!r())throw new Error("Cannot write to storage with a read only user, please ensure the user has write permissions")}}}function Fc(e,t,n=vs(t)){return Object.freeze({type:"HasParent",node:e,key:t,pos:n})}var jc=Object.freeze({type:"NoParent"});function vm(e,t=vs(e)){return Object.freeze({type:"Orphaned",oldKey:e,oldPos:t})}var Br=class{#t;#e;#n=jc;_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw new Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return Et(this.parent,"Unknown state")}}get _parentPos(){switch(this.parent.type){case"HasParent":return this.parent.pos;case"NoParent":throw new Error("Parent key is missing");case"Orphaned":return this.parent.oldPos;default:return Et(this.parent,"Unknown state")}}get _pool(){return this.#t}get roomId(){return this.#t?this.#t.roomId:null}get _id(){return this.#e}get parent(){return this.#n}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return Et(this.parent,"Unknown state")}}_apply(e,t){return e.type===L.DELETE_CRDT?this.parent.type==="HasParent"?this.parent.node._detachChild(this):{modified:!1}:{modified:!1}}_setParentLink(e,t){switch(this.parent.type){case"HasParent":if(this.parent.node!==e)throw new Error("Cannot set parent: node already has a parent");this.#n=Fc(e,t);return;case"Orphaned":case"NoParent":{this.#n=Fc(e,t);return}default:return Et(this.parent,"Unknown state")}}_attach(e,t){if(this.#e||this.#t)throw new Error("Cannot attach node: already attached");t.addNode(e,this),this.#e=e,this.#t=t}_detach(){switch(this.#t&&this.#e&&this.#t.deleteNode(this.#e),this.parent.type){case"HasParent":{this.#n=vm(this.parent.key,this.parent.pos);break}case"NoParent":{this.#n=jc;break}case"Orphaned":break;default:Et(this.parent,"Unknown state")}this.#t=void 0}_toOpsWithOpId(e,t,n){return this._toOps(e,t).map(s=>({opId:n.generateOpId(),...s}))}#s;#i;#r;invalidate(){(this.#s!==void 0||this.#r!==void 0)&&(this.#s=void 0,this.#r=void 0,this.parent.type==="HasParent"&&this.parent.node.invalidate())}toTreeNode(e){return(this.#r===void 0||this.#i!==e)&&(this.#i=e,this.#r=this._toTreeNode(e)),this.#r}toImmutable(){return this.#s===void 0&&(this.#s=this._toImmutable()),this.#s}},dt=Object.freeze({OBJECT:0,LIST:1,MAP:2,REGISTER:3}),Ve=class Kl extends Br{#t;constructor(t){super(),this.#t=t}get data(){return this.#t}static _deserialize([t,n],s,r){const i=new Kl(n.data);return i._attach(t,r),i}_toOps(t,n){if(this._id===void 0)throw new Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:L.CREATE_REGISTER,id:this._id,parentId:t,parentKey:n,data:this.data}]}_serialize(){if(this.parent.type!=="HasParent")throw new Error("Cannot serialize LiveRegister if parent is missing");return{type:dt.REGISTER,parentId:V(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(t){throw new Error("Method not implemented.")}_detachChild(t){throw new Error("Method not implemented.")}_apply(t,n){return super._apply(t,n)}_toTreeNode(t){return{type:"Json",id:this._id??$e(),key:t,payload:this.#t}}_toImmutable(){return this.#t}clone(){return Es(this.data)}};function Cm(e,t){const n=e._parentPos,s=t._parentPos;return n===s?0:n<s?-1:1}var Kn=class ji extends Br{#t;#e;#n;constructor(t){super(),this.#t=[],this.#e=new WeakSet,this.#n=new Map;let n;for(const s of t){const r=ue(n),i=On(s);i._setParentLink(this,r),this.#t.push(i),n=r}}static _deserialize([t],n,s){const r=new ji([]);r._attach(t,s);const i=n.get(t);if(i===void 0)return r;for(const[o,c]of i){const l=Wl([o,c],n,s);l._setParentLink(r,c.parentKey),r._insertAndSort(l)}return r}_toOps(t,n){if(this._id===void 0)throw new Error("Cannot serialize item is not attached");const s=[],r={id:this._id,type:L.CREATE_LIST,parentId:t,parentKey:n};s.push(r);for(const i of this.#t){const o=i._getParentKeyOrThrow(),c=Ys(i._toOps(this._id,o),void 0);s.push(...c)}return s}_insertAndSort(t){this.#t.push(t),this._sortItems()}_sortItems(){this.#t.sort(Cm),this.invalidate()}_indexOfPosition(t){return this.#t.findIndex(n=>n._getParentKeyOrThrow()===t)}_attach(t,n){super._attach(t,n);for(const s of this.#t)s._attach(n.generateId(),n)}_detach(){super._detach();for(const t of this.#t)t._detach()}#s(t){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const{id:n,parentKey:s}=t,r=Qn(t);r._attach(n,this._pool),r._setParentLink(this,s);const i=t.deletedId,o=this._indexOfPosition(s);if(o!==-1){const c=this.#t[o];if(c._id===i)return c._detach(),this.#t[o]=r,{modified:Z(this,[yn(o,r)]),reverse:[]};{this.#e.add(c),this.#t[o]=r;const l=[yn(o,r)],u=this.#r(t.deletedId);return u&&l.push(u),{modified:Z(this,l),reverse:[]}}}else{const c=[],l=this.#r(t.deletedId);return l&&c.push(l),this._insertAndSort(r),c.push(qt(this._indexOfPosition(s),r)),{reverse:[],modified:Z(this,c)}}}#i(t){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const n=[],s=this.#r(t.deletedId);s&&n.push(s);const r=this.#n.get(t.parentKey);if(r!==void 0){if(r!==t.opId)return n.length===0?{modified:!1}:{modified:Z(this,n),reverse:[]};this.#n.delete(t.parentKey)}const i=this._indexOfPosition(t.parentKey),o=this.#t.find(c=>c._id===t.id);if(o!==void 0){if(o._parentKey===t.parentKey)return{modified:n.length>0?Z(this,n):!1,reverse:[]};if(i!==-1){this.#e.add(this.#t[i]);const[u]=this.#t.splice(i,1);n.push(Gs(i,u))}const c=this.#t.indexOf(o);o._setParentLink(this,t.parentKey),this._sortItems();const l=this.#t.indexOf(o);return l!==c&&n.push(ze(c,l,o)),{modified:n.length>0?Z(this,n):!1,reverse:[]}}else{const c=this._pool.getNode(t.id);if(c&&this.#e.has(c)){c._setParentLink(this,t.parentKey),this.#e.delete(c),this._insertAndSort(c);const l=this.#t.indexOf(c);return{modified:Z(this,[i===-1?qt(l,c):yn(l,c),...n]),reverse:[]}}else{i!==-1&&this.#t.splice(i,1);const{newItem:l,newIndex:u}=this.#u(t,t.parentKey);return{modified:Z(this,[i===-1?qt(u,l):yn(u,l),...n]),reverse:[]}}}}#r(t){if(t===void 0||this._pool===void 0)return null;const n=this._pool.getNode(t);if(n===void 0)return null;const s=this._detachChild(n);return s.modified===!1?null:s.modified.updates[0]}#o(t){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const n=vs(t.parentKey),s=this._indexOfPosition(n);s!==-1&&this.#d(s,n);const{newItem:r,newIndex:i}=this.#u(t,n);return{modified:Z(this,[qt(i,r)]),reverse:[]}}#c(t){const n=this.#t.find(i=>i._id===t.id),s=vs(t.parentKey),r=this._indexOfPosition(s);if(n){if(n._parentKey===s)return{modified:!1};{const i=this.#t.indexOf(n);r!==-1&&this.#d(r,s),n._setParentLink(this,s),this._sortItems();const o=this._indexOfPosition(s);return o===i?{modified:!1}:{modified:Z(this,[ze(i,o,n)]),reverse:[]}}}else{const i=V(this._pool).getNode(t.id);if(i&&this.#e.has(i)){i._setParentLink(this,s),this.#e.delete(i),this._insertAndSort(i);const o=this._indexOfPosition(s);return{modified:Z(this,[qt(o,i)]),reverse:[]}}else{r!==-1&&this.#d(r,s);const{newItem:o,newIndex:c}=this.#u(t,s);return{modified:Z(this,[qt(c,o)]),reverse:[]}}}}#a(t){const{id:n,parentKey:s}=t,r=Qn(t);if(this._pool?.getNode(n)!==void 0)return{modified:!1};r._attach(n,V(this._pool)),r._setParentLink(this,s);const i=this._indexOfPosition(s);let o=s;if(i!==-1){const l=this.#t[i]?._parentPos,u=this.#t[i+1]?._parentPos;o=ue(l,u),r._setParentLink(this,o)}this._insertAndSort(r);const c=this._indexOfPosition(o);return{modified:Z(this,[qt(c,r)]),reverse:[{type:L.DELETE_CRDT,id:n}]}}#l(t){const{id:n,parentKey:s}=t,r=Qn(t);if(this._pool?.getNode(n)!==void 0)return{modified:!1};this.#n.set(s,V(t.opId));const i=this._indexOfPosition(s);r._attach(n,V(this._pool)),r._setParentLink(this,s);const o=s;if(i!==-1){const c=this.#t[i];c._detach(),this.#t[i]=r;const l=Ys(c._toOps(V(this._id),s),t.id),u=[yn(i,r)],a=this.#r(t.deletedId);return a&&u.push(a),{modified:Z(this,u),reverse:l}}else{this._insertAndSort(r),this.#r(t.deletedId);const c=this._indexOfPosition(o);return{reverse:[{type:L.DELETE_CRDT,id:n}],modified:Z(this,[qt(c,r)])}}}_attachChild(t,n){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");let s;return t.intent==="set"?n===1?s=this.#s(t):n===2?s=this.#i(t):s=this.#l(t):n===1?s=this.#o(t):n===2?s=this.#c(t):s=this.#a(t),s.modified!==!1&&this.invalidate(),s}_detachChild(t){if(t){const n=V(t._parentKey),s=t._toOps(V(this._id),n),r=this.#t.indexOf(t);if(r===-1)return{modified:!1};const[i]=this.#t.splice(r,1);return this.invalidate(),t._detach(),{modified:Z(this,[Gs(r,i)]),reverse:s}}return{modified:!1}}#h(t,n){if(this.#e.has(n)){this.#e.delete(n),n._setParentLink(this,t),this._insertAndSort(n);const i=this.#t.indexOf(n);return{modified:Z(this,[qt(i,n)]),reverse:[]}}const s=n._parentKey;if(t===s)return{modified:!1};const r=this._indexOfPosition(t);if(r===-1){const i=this.#t.indexOf(n);n._setParentLink(this,t),this._sortItems();const o=this.#t.indexOf(n);return o===i?{modified:!1}:{modified:Z(this,[ze(i,o,n)]),reverse:[]}}else{this.#t[r]._setParentLink(this,ue(t,this.#t[r+1]?._parentPos));const i=this.#t.indexOf(n);n._setParentLink(this,t),this._sortItems();const o=this.#t.indexOf(n);return o===i?{modified:!1}:{modified:Z(this,[ze(i,o,n)]),reverse:[]}}}#p(t,n){const s=V(n._parentKey);if(this.#e.has(n)){const r=this._indexOfPosition(t);this.#e.delete(n),r!==-1&&this.#t[r]._setParentLink(this,ue(t,this.#t[r+1]?._parentPos)),n._setParentLink(this,t),this._insertAndSort(n);const i=this.#t.indexOf(n);return{modified:Z(this,[qt(i,n)]),reverse:[]}}else{if(t===s)return{modified:!1};const r=this.#t.indexOf(n),i=this._indexOfPosition(t);i!==-1&&this.#t[i]._setParentLink(this,ue(t,this.#t[i+1]?._parentPos)),n._setParentLink(this,t),this._sortItems();const o=this.#t.indexOf(n);return r===o?{modified:!1}:{modified:Z(this,[ze(r,o,n)]),reverse:[]}}}#g(t,n){const s=V(n._parentKey),r=this.#t.indexOf(n),i=this._indexOfPosition(t);let o=t;i!==-1&&(o=ue(t,this.#t[i+1]?._parentPos)),n._setParentLink(this,o),this._sortItems();const c=this.#t.indexOf(n);return r===c?{modified:!1}:{modified:Z(this,[ze(r,c,n)]),reverse:[{type:L.SET_PARENT_KEY,id:V(n._id),parentKey:s}]}}_setChildKey(t,n,s){return s===1?this.#h(t,n):s===2?this.#p(t,n):this.#g(t,n)}_apply(t,n){return super._apply(t,n)}_serialize(){if(this.parent.type!=="HasParent")throw new Error("Cannot serialize LiveList if parent is missing");return{type:dt.LIST,parentId:V(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this.#t.length}push(t){return this._pool?.assertStorageIsWritable(),this.insert(t,this.length)}insert(t,n){if(this._pool?.assertStorageIsWritable(),n<0||n>this.#t.length)throw new Error(`Cannot insert list item at index "${n}". index should be between 0 and ${this.#t.length}`);const s=this.#t[n-1]?this.#t[n-1]._parentPos:void 0,r=this.#t[n]?this.#t[n]._parentPos:void 0,i=ue(s,r),o=On(t);if(o._setParentLink(this,i),this._insertAndSort(o),this._pool&&this._id){const c=this._pool.generateId();o._attach(c,this._pool),this._pool.dispatch(o._toOpsWithOpId(this._id,i,this._pool),[{type:L.DELETE_CRDT,id:c}],new Map([[this._id,Z(this,[qt(n,o)])]]))}}move(t,n){if(this._pool?.assertStorageIsWritable(),n<0)throw new Error("targetIndex cannot be less than 0");if(n>=this.#t.length)throw new Error("targetIndex cannot be greater or equal than the list length");if(t<0)throw new Error("index cannot be less than 0");if(t>=this.#t.length)throw new Error("index cannot be greater or equal than the list length");let s=null,r=null;t<n?(r=n===this.#t.length-1?void 0:this.#t[n+1]._parentPos,s=this.#t[n]._parentPos):(r=this.#t[n]._parentPos,s=n===0?void 0:this.#t[n-1]._parentPos);const i=ue(s,r),o=this.#t[t],c=o._getParentKeyOrThrow();if(o._setParentLink(this,i),this._sortItems(),this._pool&&this._id){const l=new Map([[this._id,Z(this,[ze(t,n,o)])]]);this._pool.dispatch([{type:L.SET_PARENT_KEY,id:V(o._id),opId:this._pool.generateOpId(),parentKey:i}],[{type:L.SET_PARENT_KEY,id:V(o._id),parentKey:c}],l)}}delete(t){if(this._pool?.assertStorageIsWritable(),t<0||t>=this.#t.length)throw new Error(`Cannot delete list item at index "${t}". index should be between 0 and ${this.#t.length-1}`);const n=this.#t[t];n._detach();const[s]=this.#t.splice(t,1);if(this.invalidate(),this._pool){const r=n._id;if(r){const i=new Map;i.set(V(this._id),Z(this,[Gs(t,s)])),this._pool.dispatch([{id:r,opId:this._pool.generateOpId(),type:L.DELETE_CRDT}],n._toOps(V(this._id),n._getParentKeyOrThrow()),i)}}}clear(){if(this._pool?.assertStorageIsWritable(),this._pool){const t=[],n=[],s=[];for(const i of this.#t){i._detach();const o=i._id;o&&(t.push({type:L.DELETE_CRDT,id:o,opId:this._pool.generateOpId()}),n.push(...i._toOps(V(this._id),i._getParentKeyOrThrow())),s.push(Gs(0,i)))}this.#t=[],this.invalidate();const r=new Map;r.set(V(this._id),Z(this,s)),this._pool.dispatch(t,n,r)}else{for(const t of this.#t)t._detach();this.#t=[],this.invalidate()}}set(t,n){if(this._pool?.assertStorageIsWritable(),t<0||t>=this.#t.length)throw new Error(`Cannot set list item at index "${t}". index should be between 0 and ${this.#t.length-1}`);const s=this.#t[t],r=s._getParentKeyOrThrow(),i=s._id;s._detach();const o=On(n);if(o._setParentLink(this,r),this.#t[t]=o,this.invalidate(),this._pool&&this._id){const c=this._pool.generateId();o._attach(c,this._pool);const l=new Map;l.set(this._id,Z(this,[yn(t,o)]));const u=Ys(o._toOpsWithOpId(this._id,r,this._pool),i);this.#n.set(r,V(u[0].opId));const a=Ys(s._toOps(this._id,r),c);this._pool.dispatch(u,a,l)}}toArray(){return this.#t.map(t=>he(t))}every(t){return this.toArray().every(t)}filter(t){return this.toArray().filter(t)}find(t){return this.toArray().find(t)}findIndex(t){return this.toArray().findIndex(t)}forEach(t){return this.toArray().forEach(t)}get(t){if(!(t<0||t>=this.#t.length))return he(this.#t[t])}indexOf(t,n){return this.toArray().indexOf(t,n)}lastIndexOf(t,n){return this.toArray().lastIndexOf(t,n)}map(t){return this.#t.map((n,s)=>t(he(n),s))}some(t){return this.toArray().some(t)}[Symbol.iterator](){return new km(this.#t)}#u(t,n){const s=Qn(t);s._attach(t.id,V(this._pool)),s._setParentLink(this,n),this._insertAndSort(s);const r=this._indexOfPosition(n);return{newItem:s,newIndex:r}}#d(t,n){const s=ue(n,this.#t.length>t+1?this.#t[t+1]?._parentPos:void 0);this.#t[t]._setParentLink(this,s)}_toTreeNode(t){return{type:"LiveList",id:this._id??$e(),key:t,payload:this.#t.map((n,s)=>n.toTreeNode(s.toString()))}}toImmutable(){return super.toImmutable()}_toImmutable(){return this.#t.map(n=>n.toImmutable())}clone(){return new ji(this.#t.map(t=>t.clone()))}},km=class{#t;constructor(e){this.#t=e[Symbol.iterator]()}[Symbol.iterator](){return this}next(){const e=this.#t.next();return e.done?{done:!0,value:void 0}:{value:he(e.value)}}};function Z(e,t){return{node:e,type:"LiveList",updates:t}}function yn(e,t){return{index:e,type:"set",item:t instanceof Ve?t.data:t}}function Gs(e,t){return{type:"delete",index:e,deletedItem:t instanceof Ve?t.data:t}}function qt(e,t){return{index:e,type:"insert",item:t instanceof Ve?t.data:t}}function ze(e,t,n){return{type:"move",index:t,item:n instanceof Ve?n.data:n,previousIndex:e}}function Ys(e,t){return e.map((n,s)=>s===0?{...n,intent:"set",deletedId:t}:n)}var zn=class Ki extends Br{#t;#e;constructor(t){if(super(),this.#e=new Map,t){const n=[];for(const[s,r]of t){const i=On(r);i._setParentLink(this,s),n.push([s,i])}this.#t=new Map(n)}else this.#t=new Map}_toOps(t,n){if(this._id===void 0)throw new Error("Cannot serialize item is not attached");const s=[],r={id:this._id,type:L.CREATE_MAP,parentId:t,parentKey:n};s.push(r);for(const[i,o]of this.#t)s.push(...o._toOps(this._id,i));return s}static _deserialize([t,n],s,r){const i=new Ki;i._attach(t,r);const o=s.get(t);if(o===void 0)return i;for(const[c,l]of o){const u=Wl([c,l],s,r);u._setParentLink(i,l.parentKey),i.#t.set(l.parentKey,u),i.invalidate()}return i}_attach(t,n){super._attach(t,n);for(const[s,r]of this.#t)ct(r)&&r._attach(n.generateId(),n)}_attachChild(t,n){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const{id:s,parentKey:r,opId:i}=t,o=r,c=Qn(t);if(this._pool.getNode(s)!==void 0)return{modified:!1};if(n===2){const a=this.#e.get(o);if(a===i)return this.#e.delete(o),{modified:!1};if(a!==void 0)return{modified:!1}}else n===1&&this.#e.delete(o);const l=this.#t.get(o);let u;if(l){const a=V(this._id);u=l._toOps(a,o),l._detach()}else u=[{type:L.DELETE_CRDT,id:s}];return c._setParentLink(this,o),c._attach(s,this._pool),this.#t.set(o,c),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[o]:{type:"update"}}},reverse:u}}_detach(){super._detach();for(const t of this.#t.values())t._detach()}_detachChild(t){const n=V(this._id),s=V(t._parentKey),r=t._toOps(n,s);for(const[o,c]of this.#t)c===t&&(this.#t.delete(o),this.invalidate());return t._detach(),{modified:{node:this,type:"LiveMap",updates:{[s]:{type:"delete",deletedItem:he(t)}}},reverse:r}}_serialize(){if(this.parent.type!=="HasParent")throw new Error("Cannot serialize LiveMap if parent is missing");return{type:dt.MAP,parentId:V(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(t){const n=this.#t.get(t);if(n!==void 0)return he(n)}set(t,n){this._pool?.assertStorageIsWritable();const s=this.#t.get(t);s&&s._detach();const r=On(n);if(r._setParentLink(this,t),this.#t.set(t,r),this.invalidate(),this._pool&&this._id){const i=this._pool.generateId();r._attach(i,this._pool);const o=new Map;o.set(this._id,{node:this,type:"LiveMap",updates:{[t]:{type:"update"}}});const c=r._toOpsWithOpId(this._id,t,this._pool);this.#e.set(t,V(c[0].opId)),this._pool.dispatch(c,s?s._toOps(this._id,t):[{type:L.DELETE_CRDT,id:i}],o)}}get size(){return this.#t.size}has(t){return this.#t.has(t)}delete(t){this._pool?.assertStorageIsWritable();const n=this.#t.get(t);if(n===void 0)return!1;if(n._detach(),this.#t.delete(t),this.invalidate(),this._pool&&n._id){const s=V(this._id),r=new Map;r.set(s,{node:this,type:"LiveMap",updates:{[t]:{type:"delete",deletedItem:he(n)}}}),this._pool.dispatch([{type:L.DELETE_CRDT,id:n._id,opId:this._pool.generateOpId()}],n._toOps(s,t),r)}return!0}entries(){const t=this.#t.entries();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return{done:!0,value:void 0};const r=n.value[0],i=he(n.value[1]);return{value:[r,i]}}}}[Symbol.iterator](){return this.entries()}keys(){return this.#t.keys()}values(){const t=this.#t.values();return{[Symbol.iterator](){return this},next(){const n=t.next();return n.done?{done:!0,value:void 0}:{value:he(n.value)}}}}forEach(t){for(const n of this)t(n[1],n[0],this)}_toTreeNode(t){return{type:"LiveMap",id:this._id??$e(),key:t,payload:Array.from(this.#t.entries()).map(([n,s])=>s.toTreeNode(n))}}toImmutable(){return super.toImmutable()}_toImmutable(){const t=new Map;for(const[n,s]of this.#t)t.set(n,s.toImmutable());return Ue(t)}clone(){return new Ki(Array.from(this.#t).map(([t,n])=>[t,n.clone()]))}},fi=128*1024;function Im(e,t){return e==="root"}var an=class _n extends Br{#t;#e;static detectLargeObjects=!1;static#n(t){const n=new Map;let s=null;for(const[r,i]of t)if(Im(r))s=i;else{const o=[r,i],c=n.get(i.parentId);c!==void 0?c.push(o):n.set(i.parentId,[o])}if(s===null)throw new Error("Root can't be null");return[s,n]}static _fromItems(t,n){const[s,r]=_n.#n(t);return _n._deserialize(["root",s],r,n)}constructor(t={}){super(),this.#e=new Map;const n=Mr(t);for(const s of Object.keys(n)){const r=n[s];ct(r)&&r._setParentLink(this,s)}this.#t=new Map(Object.entries(n))}_toOps(t,n){if(this._id===void 0)throw new Error("Cannot serialize item is not attached");const s=[],r={type:L.CREATE_OBJECT,id:this._id,parentId:t,parentKey:n,data:{}};s.push(r);for(const[i,o]of this.#t)ct(o)?s.push(...o._toOps(this._id,i)):r.data[i]=o;return s}static _deserialize([t,n],s,r){const i=new _n(n.data);return i._attach(t,r),this._deserializeChildren(i,s,r)}static _deserializeChildren(t,n,s){const r=n.get(V(t._id));if(r===void 0)return t;for(const[i,o]of r){const c=Am([i,o],n,s);vn(c)&&c._setParentLink(t,o.parentKey),t.#t.set(o.parentKey,c),t.invalidate()}return t}_attach(t,n){super._attach(t,n);for(const[s,r]of this.#t)ct(r)&&r._attach(n.generateId(),n)}_attachChild(t,n){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const{id:s,opId:r,parentKey:i}=t,o=zl(t);if(this._pool.getNode(s)!==void 0)return this.#e.get(i)===r&&this.#e.delete(i),{modified:!1};if(n===0)this.#e.set(i,V(r));else if(this.#e.get(i)!==void 0)return this.#e.get(i)===r?(this.#e.delete(i),{modified:!1}):{modified:!1};const c=V(this._id),l=this.#t.get(i);let u;return ct(l)?(u=l._toOps(c,i),l._detach()):l===void 0?u=[{type:L.DELETE_OBJECT_KEY,id:c,key:i}]:u=[{type:L.UPDATE_OBJECT,id:c,data:{[i]:l}}],this.#t.set(i,o),this.invalidate(),vn(o)&&(o._setParentLink(this,i),o._attach(s,this._pool)),{reverse:u,modified:{node:this,type:"LiveObject",updates:{[i]:{type:"update"}}}}}_detachChild(t){if(t){const n=V(this._id),s=V(t._parentKey),r=t._toOps(n,s);for(const[o,c]of this.#t)c===t&&(this.#t.delete(o),this.invalidate());return t._detach(),{modified:{node:this,type:"LiveObject",updates:{[s]:{type:"delete"}}},reverse:r}}return{modified:!1}}_detach(){super._detach();for(const t of this.#t.values())ct(t)&&t._detach()}_apply(t,n){return t.type===L.UPDATE_OBJECT?this.#s(t,n):t.type===L.DELETE_OBJECT_KEY?this.#i(t,n):super._apply(t,n)}_serialize(){const t={};for(const[n,s]of this.#t)ct(s)||(t[n]=s);return this.parent.type==="HasParent"&&this.parent.node._id?{type:dt.OBJECT,parentId:this.parent.node._id,parentKey:this.parent.key,data:t}:{type:dt.OBJECT,data:t}}#s(t,n){let s=!1;const r=V(this._id),i=[],o={type:L.UPDATE_OBJECT,id:r,data:{}};for(const l in t.data){const u=this.#t.get(l);ct(u)?(i.push(...u._toOps(r,l)),u._detach()):u!==void 0?o.data[l]=u:u===void 0&&i.push({type:L.DELETE_OBJECT_KEY,id:r,key:l})}const c={};for(const l in t.data){const u=t.data[l];if(u===void 0)continue;if(n)this.#e.set(l,V(t.opId));else if(this.#e.get(l)===void 0)s=!0;else if(this.#e.get(l)===t.opId){this.#e.delete(l);continue}else continue;const a=this.#t.get(l);ct(a)&&a._detach(),s=!0,c[l]={type:"update"},this.#t.set(l,u),this.invalidate()}return Object.keys(o.data).length!==0&&i.unshift(o),s?{modified:{node:this,type:"LiveObject",updates:c},reverse:i}:{modified:!1}}#i(t,n){const s=t.key,r=this.#t.get(s);if(r===void 0)return{modified:!1};if(!n&&this.#e.get(s)!==void 0)return{modified:!1};const i=V(this._id);let o=[];return ct(r)?(o=r._toOps(i,t.key),r._detach()):r!==void 0&&(o=[{type:L.UPDATE_OBJECT,id:i,data:{[s]:r}}]),this.#t.delete(s),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[t.key]:{type:"delete",deletedItem:r}}},reverse:o}}toObject(){return Object.fromEntries(this.#t)}set(t,n){this._pool?.assertStorageIsWritable(),this.update({[t]:n})}get(t){return this.#t.get(t)}delete(t){this._pool?.assertStorageIsWritable();const n=t,s=this.#t.get(n);if(s===void 0)return;if(this._pool===void 0||this._id===void 0){ct(s)&&s._detach(),this.#t.delete(n),this.invalidate();return}let r;ct(s)?(s._detach(),r=s._toOps(this._id,n)):r=[{type:L.UPDATE_OBJECT,data:{[n]:s},id:this._id}],this.#t.delete(n),this.invalidate();const i=new Map;i.set(this._id,{node:this,type:"LiveObject",updates:{[t]:{type:"delete",deletedItem:s}}}),this._pool.dispatch([{type:L.DELETE_OBJECT_KEY,key:n,id:this._id,opId:this._pool.generateOpId()}],r,i)}update(t){if(this._pool?.assertStorageIsWritable(),_n.detectLargeObjects){const u={};for(const[f,g]of this.#t)ct(g)||(u[f]=g);for(const f of Object.keys(t)){const g=t[f];g!==void 0&&(ct(g)||(u[f]=g))}const a=JSON.stringify(u);if(a.length*4>fi){const f=new TextEncoder().encode(a).length;if(f>fi)throw new Error(`LiveObject size exceeded limit: ${f} bytes > ${fi} bytes. See https://liveblocks.io/docs/platform/limits#Liveblocks-Storage-limits`)}}if(this._pool===void 0||this._id===void 0){for(const u in t){const a=t[u];if(a===void 0)continue;const d=this.#t.get(u);ct(d)&&d._detach(),ct(a)&&a._setParentLink(this,u),this.#t.set(u,a),this.invalidate()}return}const n=[],s=[],r=this._pool.generateOpId(),i={},o={id:this._id,type:L.UPDATE_OBJECT,data:{}},c={};for(const u in t){const a=t[u];if(a===void 0)continue;const d=this.#t.get(u);if(ct(d)?(s.push(...d._toOps(this._id,u)),d._detach()):d===void 0?s.push({type:L.DELETE_OBJECT_KEY,id:this._id,key:u}):o.data[u]=d,ct(a)){a._setParentLink(this,u),a._attach(this._pool.generateId(),this._pool);const f=a._toOpsWithOpId(this._id,u,this._pool),g=f.find(m=>m.parentId===this._id);g&&this.#e.set(u,V(g.opId)),n.push(...f)}else i[u]=a,this.#e.set(u,r);this.#t.set(u,a),this.invalidate(),c[u]={type:"update"}}Object.keys(o.data).length!==0&&s.unshift(o),Object.keys(i).length!==0&&n.unshift({opId:r,id:this._id,type:L.UPDATE_OBJECT,data:i});const l=new Map;l.set(this._id,{node:this,type:"LiveObject",updates:c}),this._pool.dispatch(n,s,l)}toImmutable(){return super.toImmutable()}toTreeNode(t){return super.toTreeNode(t)}_toTreeNode(t){const n=this._id??$e();return{type:"LiveObject",id:n,key:t,payload:Array.from(this.#t.entries()).map(([s,r])=>ct(r)?r.toTreeNode(s):{type:"Json",id:`${n}:${s}`,key:s,payload:r})}}_toImmutable(){const t={};for(const[n,s]of this.#t)t[n]=vn(s)?s.toImmutable():s;return t}clone(){return new _n(Object.fromEntries(Array.from(this.#t).map(([t,n])=>[t,vn(n)?n.clone():Es(n)])))}};function Qn(e){return On(zl(e))}function zl(e){switch(e.type){case L.CREATE_REGISTER:return e.data;case L.CREATE_OBJECT:return new an(e.data);case L.CREATE_MAP:return new zn;case L.CREATE_LIST:return new Kn([]);default:return Et(e,"Unknown creation Op")}}function ql(e,t){return e===t?!0:e.parent.type==="HasParent"?ql(e.parent.node,t):!1}function Wl([e,t],n,s){switch(t.type){case dt.OBJECT:return an._deserialize([e,t],n,s);case dt.LIST:return Kn._deserialize([e,t],n,s);case dt.MAP:return zn._deserialize([e,t],n,s);case dt.REGISTER:return Ve._deserialize([e,t],n,s);default:throw new Error("Unexpected CRDT type")}}function Am([e,t],n,s){switch(t.type){case dt.OBJECT:return an._deserialize([e,t],n,s);case dt.LIST:return Kn._deserialize([e,t],n,s);case dt.MAP:return zn._deserialize([e,t],n,s);case dt.REGISTER:return t.data;default:throw new Error("Unexpected CRDT type")}}function vn(e){return Gl(e)||Tm(e)||Om(e)}function ct(e){return vn(e)||Dm(e)}function Gl(e){return e instanceof Kn}function Tm(e){return e instanceof zn}function Om(e){return e instanceof an}function Dm(e){return e instanceof Ve}function xm(e){return e===void 0?void 0:vn(e)?e.clone():Es(e)}function he(e){return e instanceof Ve?e.data:e instanceof Kn||e instanceof zn||e instanceof an?e:Et(e,"Unknown AbstractCrdt")}function On(e){return e instanceof an||e instanceof zn||e instanceof Kn?e:new Ve(e)}function Rm(e,t){const n=[];return e.forEach((s,r)=>{t.get(r)||n.push({type:L.DELETE_CRDT,id:r})}),t.forEach((s,r)=>{const i=e.get(r);if(i)s.type===dt.OBJECT&&(i.type!==dt.OBJECT||ye(s.data)!==ye(i.data))&&n.push({type:L.UPDATE_OBJECT,id:r,data:s.data}),s.parentKey!==i.parentKey&&n.push({type:L.SET_PARENT_KEY,id:r,parentKey:V(s.parentKey,"Parent key must not be missing")});else switch(s.type){case dt.REGISTER:n.push({type:L.CREATE_REGISTER,id:r,parentId:s.parentId,parentKey:s.parentKey,data:s.data});break;case dt.LIST:n.push({type:L.CREATE_LIST,id:r,parentId:s.parentId,parentKey:s.parentKey});break;case dt.OBJECT:if(s.parentId===void 0||s.parentKey===void 0)throw new Error("Internal error. Cannot serialize storage root into an operation");n.push({type:L.CREATE_OBJECT,id:r,parentId:s.parentId,parentKey:s.parentKey,data:s.data});break;case dt.MAP:n.push({type:L.CREATE_MAP,id:r,parentId:s.parentId,parentKey:s.parentKey});break}}),n}function Lm(e,t){const n=e.updates;for(const[s,r]of Ol(t.updates))n[s]=r;return{...t,updates:n}}function Pm(e,t){const n=e.updates;for(const[s,r]of Ol(t.updates))n[s]=r;return{...t,updates:n}}function Nm(e,t){const n=e.updates;return{...t,updates:n.concat(t.updates)}}function pi(e,t){return e===void 0?t:e.type==="LiveObject"&&t.type==="LiveObject"?Lm(e,t):e.type==="LiveMap"&&t.type==="LiveMap"?Pm(e,t):e.type==="LiveList"&&t.type==="LiveList"?Nm(e,t):t}var gi=class{#t;#e;#n;#s;constructor(){this.#t={},this.#e=0,this.#n=1,this.#s=0}get length(){return this.#s}*[Symbol.iterator](){const e=this.#s,t=this.#e;for(let n=0;n<e;n++)yield this.#t[t+n]}push(e){const t=Array.isArray(e)?e:[e];this.#n>Number.MAX_SAFE_INTEGER-t.length-1&&Xt("Deque full");for(const n of t)this.#t[this.#n++-1]=n;this.#s+=t.length}pop(){if(this.#s<1)return;this.#n--;const e=this.#t[this.#n-1];return delete this.#t[this.#n-1],this.#s--,e}pushLeft(e){const t=Array.isArray(e)?e:[e];this.#e<Number.MIN_SAFE_INTEGER+t.length&&Xt("Deque full");for(let n=t.length-1;n>=0;n--)this.#t[--this.#e]=t[n];this.#s+=t.length}popLeft(){if(this.#s<1)return;const e=this.#t[this.#e];return delete this.#t[this.#e],this.#e++,this.#s--,e}};function Um(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"}function Yl(e){return Array.isArray(e)}function Mm(e){return!Um(e)&&!Yl(e)}var xt=Object.freeze({UPDATE_PRESENCE:100,BROADCAST_EVENT:103,FETCH_STORAGE:200,UPDATE_STORAGE:201,FETCH_YDOC:300,UPDATE_YDOC:301});function $m(e,t){const{connectionId:n,id:s,info:r}=e,i=Hi(e.scopes);return Ue(Mr({connectionId:n,id:s,info:r,canWrite:i,canComment:jl(e.scopes),isReadOnly:!i,presence:t}))}var Bm=class{#t;#e;signal;constructor(){this.#t=new Bn({connections:new Map,presences:new Map}),this.signal=me.from(this.#t,e=>Ni(Array.from(this.#t.get().presences.keys()).map(t=>this.getUser(Number(t))))),this.#e=new Map}get(){return this.signal.get()}connectionIds(){return this.#t.get().connections.keys()}clearOthers(){this.#t.mutate(e=>{e.connections.clear(),e.presences.clear(),this.#e.clear()})}#n(e){const t=this.#t.get(),n=t.connections.get(e),s=t.presences.get(e);if(n!==void 0&&s!==void 0)return $m(n,s)}getUser(e){const t=this.#e.get(e);if(t)return t;const n=this.#n(e);if(n)return this.#e.set(e,n),n}#s(e){this.#e.delete(e)}setConnection(e,t,n,s){this.#t.mutate(r=>(r.connections.set(e,Ue({connectionId:e,id:t,info:n,scopes:s})),r.presences.has(e)?this.#s(e):!1))}removeConnection(e){this.#t.mutate(t=>{t.connections.delete(e),t.presences.delete(e),this.#s(e)})}setOther(e,t){this.#t.mutate(n=>(n.presences.set(e,Ue(Mr(t))),n.connections.has(e)?this.#s(e):!1))}patchOther(e,t){this.#t.mutate(n=>{const s=n.presences.get(e);if(s===void 0)return!1;const r=Dl(s,t);return s===r?!1:(n.presences.set(e,Ue(r)),this.#s(e))})}},zi=class Jl extends Error{context;constructor(t,n,s){super(t,{cause:s}),this.context=n,this.name="LiveblocksError"}get roomId(){return this.context.roomId}get code(){return this.context.code}static from(t,n){return new Jl(Vm(t),t,n)}};function Vm(e){switch(e.type){case"ROOM_CONNECTION_ERROR":switch(e.code){case 4001:return"Not allowed to connect to the room";case 4005:return"Room is already full";case 4006:return"Kicked out of the room, because the room ID changed";default:return"Could not connect to the room"}case"AI_CONNECTION_ERROR":return e.code===4001?"Not allowed to connect to ai":"Could not connect to the room";case"CREATE_THREAD_ERROR":return"Could not create new thread";case"DELETE_THREAD_ERROR":return"Could not delete thread";case"EDIT_THREAD_METADATA_ERROR":return"Could not edit thread metadata";case"EDIT_COMMENT_METADATA_ERROR":return"Could not edit comment metadata";case"MARK_THREAD_AS_RESOLVED_ERROR":return"Could not mark thread as resolved";case"MARK_THREAD_AS_UNRESOLVED_ERROR":return"Could not mark thread as unresolved";case"SUBSCRIBE_TO_THREAD_ERROR":return"Could not subscribe to thread";case"UNSUBSCRIBE_FROM_THREAD_ERROR":return"Could not unsubscribe from thread";case"CREATE_COMMENT_ERROR":return"Could not create new comment";case"EDIT_COMMENT_ERROR":return"Could not edit comment";case"DELETE_COMMENT_ERROR":return"Could not delete comment";case"ADD_REACTION_ERROR":return"Could not add reaction";case"REMOVE_REACTION_ERROR":return"Could not remove reaction";case"MARK_INBOX_NOTIFICATION_AS_READ_ERROR":return"Could not mark inbox notification as read";case"DELETE_INBOX_NOTIFICATION_ERROR":return"Could not delete inbox notification";case"MARK_ALL_INBOX_NOTIFICATIONS_AS_READ_ERROR":return"Could not mark all inbox notifications as read";case"DELETE_ALL_INBOX_NOTIFICATIONS_ERROR":return"Could not delete all inbox notifications";case"UPDATE_ROOM_SUBSCRIPTION_SETTINGS_ERROR":return"Could not update room subscription settings";case"UPDATE_NOTIFICATION_SETTINGS_ERROR":return"Could not update notification settings";case"LARGE_MESSAGE_ERROR":return"Could not send large message";default:return Et(e,"Unhandled case")}}var Kc=1024*1024-512;function Hm(e){let t=0;return()=>`${e}:${t++}`}function zc(e,t){return{type:"User",id:`${t.connectionId}`,key:e,payload:{connectionId:t.connectionId,id:t.id,info:t.info,presence:t.presence,isReadOnly:!t.canWrite}}}function Fm(){const e=typeof document<"u"?document:void 0,t={current:null};function n(){e?.visibilityState==="hidden"?t.current=t.current??Date.now():t.current=null}return e?.addEventListener("visibilitychange",n),[t,()=>{e?.removeEventListener("visibilitychange",n)}]}function jm(e,t){const n=t.roomId,s=e.initialPresence,r=e.initialStorage,i=t.roomHttpClient,[o,c]=Fm(),l={...t.delegates,canZombie(){return t.backgroundKeepAliveTimeout!==void 0&&o.current!==null&&Date.now()>o.current+t.backgroundKeepAliveTimeout&&fn()!=="synchronizing"}},u=new Fl(l,t.enableDebugLogging),a={buffer:{flushTimerID:void 0,lastFlushedAt:0,presenceUpdates:{type:"full",data:s},messages:[],storageOperations:[]},staticSessionInfoSig:new Nt(null),dynamicSessionInfoSig:new Nt(null),myPresence:new Xp(s),others:new Bm,initialStorage:r,idFactory:null,yjsProvider:void 0,yjsProviderDidChange:Y(),pool:Em(n,{getCurrentConnectionId:nt,onDispatch:v,isStorageWritable:U}),root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,unacknowledgedOps:new Map};let d;function f(h){const y=u.authValue;if(y!==null){const b=Ro(y);if(b!==d)if(d=b,y.type==="secret"){const E=y.token.parsed;a.staticSessionInfoSig.set({userId:E.uid,userInfo:E.ui})}else a.staticSessionInfoSig.set({userId:void 0,userInfo:void 0})}w.status.notify(h),mt()}let g,m=!1;function _(h){h==="reconnecting"?g=setTimeout(()=>{w.lostConnection.notify("lost"),m=!0,a.others.clearOthers(),F({others:[{type:"reset"}]})},t.lostConnectionTimeout):(clearTimeout(g),m&&(h==="disconnected"?w.lostConnection.notify("failed"):w.lostConnection.notify("restored"),m=!1))}function N(){a.buffer.presenceUpdates={type:"full",data:{...a.myPresence.get()}},T!==null&&jt({flush:!1}),At()}function P(){clearTimeout(a.buffer.flushTimerID)}u.events.onMessage.subscribe(Us),u.events.statusDidChange.subscribe(f),u.events.statusDidChange.subscribe(_),u.events.didConnect.subscribe(N),u.events.didDisconnect.subscribe(P),u.events.onConnectionError.subscribe(({message:h,code:y})=>{const b="ROOM_CONNECTION_ERROR",E=new zi(h,{type:b,code:y,roomId:n});t.errorEventSource.notify(E)});function v(h,y,b){if(a.activeBatch){for(const E of h)a.activeBatch.ops.push(E);for(const[E,j]of b)a.activeBatch.updates.storageUpdates.set(E,pi(a.activeBatch.updates.storageUpdates.get(E),j));a.activeBatch.reverseOps.pushLeft(y)}else A(y),a.redoStack.length=0,I(h),F({storageUpdates:b})}function U(){const h=a.dynamicSessionInfoSig.get()?.scopes;return h!==void 0?Hi(h):!0}const w={status:Y(),lostConnection:Y(),customEvent:Y(),self:Y(),myPresence:Y(),others:Y(),storageBatch:Y(),history:Y(),storageDidLoad:Y(),storageStatus:Y(),ydoc:Y(),comments:Y(),roomWillDestroy:Y()};async function k(h,y){return i.createTextMention({roomId:n,mentionId:h,mention:y})}async function x(h){return i.deleteTextMention({roomId:n,mentionId:h})}async function R(h,y){await i.reportTextEditor({roomId:n,type:h,rootKey:y})}async function q(){return i.listTextVersions({roomId:n})}async function et(h){return i.listTextVersionsSince({roomId:n,since:h.since,signal:h.signal})}async function Q(h){return i.getTextVersion({roomId:n,versionId:h})}async function W(){return i.createTextVersion({roomId:n})}async function ot(h){return i.executeContextualPrompt({roomId:n,...h})}function*O(h){const{ops:y,...b}=h;if(y.length<2)throw new Error("Cannot split ops into smaller chunks");const E=Math.floor(y.length/2),j=y.slice(0,E),G=y.slice(E);for(const wt of[j,G]){const kt={ops:wt,...b},Jn=ye([kt]);K(Jn)?yield*O(kt):yield Jn}}function*C(h){if(h.length<2)if(h[0].type===xt.UPDATE_STORAGE){yield*O(h[0]);return}else throw new Error("Cannot split into chunks smaller than the allowed message size");const y=Math.floor(h.length/2),b=h.slice(0,y),E=h.slice(y);for(const j of[b,E]){const G=ye(j);K(G)?yield*C(j):yield G}}function K(h){return h.length*4<Kc?!1:new TextEncoder().encode(h).length>=Kc}function $(h){const y=t.largeMessageStrategy??"default",b=ye(h);if(!K(b))return u.send(b);switch(y){case"default":{const E="LARGE_MESSAGE_ERROR",j=new zi("Message is too large for websockets",{type:E});t.errorEventSource.notify(j)||Ee("Message is too large for websockets.  Configure largeMessageStrategy option or useErrorListener to handle this.");return}case"split":{_t("Message is too large for websockets, splitting into smaller chunks");for(const E of C(h))u.send(E);return}case"experimental-fallback-to-http":{_t("Message is too large for websockets, so sending over HTTP instead");const E=a.dynamicSessionInfoSig.get()?.nonce??Xt("Session is not authorized to send message over HTTP");i.sendMessagesOverHTTP({roomId:n,nonce:E,messages:h}).then(j=>{!j.ok&&j.status===403&&u.reconnect()}).catch(j=>{Ee(`Failed to deliver message over HTTP: ${String(j)}`)});return}}}const z=me.from(a.staticSessionInfoSig,a.dynamicSessionInfoSig,a.myPresence,(h,y,b)=>{if(h===null||y===null)return null;{const E=Hi(y.scopes);return{connectionId:y.actor,id:h.userId,info:h.userInfo,presence:b,canWrite:E,canComment:jl(y.scopes)}}});let lt;function mt(){const h=z.get();h!==null&&h!==lt&&(w.self.notify(h),lt=h)}const Mt=me.from(z,h=>h!==null?zc("Me",h):null);function un(h){if(h.items.length===0)throw new Error("Internal error: cannot load storage without items");a.root!==void 0?Wn(h.items):a.root=an._fromItems(h.items,a.pool);const y=z.get()?.canWrite??!0,b=a.undoStack.length;for(const E in a.initialStorage)a.root.get(E)===void 0&&(y?a.root.set(E,xm(a.initialStorage[E])):_t(`Attempted to populate missing storage key '${E}', but current user has no write access`));a.undoStack.length=b}function Wn(h){if(a.root===void 0)return;const y=new Map;for(const[j,G]of a.pool.nodes)y.set(j,G._serialize());const b=Rm(y,new Map(h)),E=Ft(b);F(E.updates)}function He(h){a.undoStack.length>=50&&a.undoStack.shift(),a.undoStack.push(h),Gn()}function A(h){a.pausedHistory!==null?a.pausedHistory.pushLeft(h):He(h)}function F(h){const y=h.storageUpdates,b=h.others;if(b!==void 0&&b.length>0){const E=a.others.get();for(const j of b)w.others.notify({...j,others:E})}if((h.presence??!1)&&(mt(),w.myPresence.notify(a.myPresence.get())),y!==void 0&&y.size>0){const E=Array.from(y.values());w.storageBatch.notify(E)}Bs()}function nt(){const h=a.dynamicSessionInfoSig.get();if(h)return h.actor;throw new Error("Internal. Tried to get connection id but connection was never open")}function yt(h){const[y,b]=Zp(h,wt=>wt.type==="presence"),E=b.map(wt=>wt.opId===void 0?{...wt,opId:a.pool.generateOpId()}:wt),{reverse:j,updates:G}=Qt(y,E,!0);return{opsToEmit:E,reverse:j,updates:G}}function Ft(h){return Qt([],h,!1)}function Qt(h,y,b){const E={reverse:new gi,storageUpdates:new Map,presence:!1};for(const G of h){const wt={type:"presence",data:{}};for(const kt in G.data)wt.data[kt]=a.myPresence.get()[kt];if(a.myPresence.patch(G.data),a.buffer.presenceUpdates===null)a.buffer.presenceUpdates={type:"partial",data:G.data};else for(const kt in G.data)a.buffer.presenceUpdates.data[kt]=G.data[kt];E.reverse.pushLeft(wt),E.presence=!0}const j=new Set;for(const G of y){let wt;b?wt=0:G.opId!==void 0?(a.unacknowledgedOps.delete(G.opId),wt=2):wt=1;const kt=Fe(G,wt);if(kt.modified){const Jn=kt.modified.node._id;Jn&&j.has(Jn)||(E.storageUpdates.set(V(kt.modified.node._id),pi(E.storageUpdates.get(V(kt.modified.node._id)),kt.modified)),E.reverse.pushLeft(kt.reverse)),(G.type===L.CREATE_LIST||G.type===L.CREATE_MAP||G.type===L.CREATE_OBJECT)&&j.add(G.id)}}return{reverse:Array.from(E.reverse),updates:{storageUpdates:E.storageUpdates,presence:E.presence}}}function Fe(h,y){if(Sm(h))return{modified:!1};switch(h.type){case L.DELETE_OBJECT_KEY:case L.UPDATE_OBJECT:case L.DELETE_CRDT:{const b=a.pool.nodes.get(h.id);return b===void 0?{modified:!1}:b._apply(h,y===0)}case L.SET_PARENT_KEY:{const b=a.pool.nodes.get(h.id);return b===void 0?{modified:!1}:b.parent.type==="HasParent"&&Gl(b.parent.node)?b.parent.node._setChildKey(vs(h.parentKey),b,y):{modified:!1}}case L.CREATE_OBJECT:case L.CREATE_LIST:case L.CREATE_MAP:case L.CREATE_REGISTER:{if(h.parentId===void 0)return{modified:!1};const b=a.pool.nodes.get(h.parentId);return b===void 0?{modified:!1}:b._attachChild(h,y)}}}function dn(h,y){const b={};a.buffer.presenceUpdates===null&&(a.buffer.presenceUpdates={type:"partial",data:{}});for(const E in h){const j=h[E];j!==void 0&&(a.buffer.presenceUpdates.data[E]=j,b[E]=a.myPresence.get()[E])}a.myPresence.patch(h),a.activeBatch?(y?.addToHistory&&a.activeBatch.reverseOps.pushLeft({type:"presence",data:b}),a.activeBatch.updates.presence=!0):(At(),y?.addToHistory&&A([{type:"presence",data:b}]),F({presence:!0}))}function xs(h){if(h.targetActor!==void 0){const b=a.others.getUser(h.actor);a.others.setOther(h.actor,h.data);const E=a.others.getUser(h.actor);if(b===void 0&&E!==void 0)return{type:"enter",user:E}}else a.others.patchOther(h.actor,h.data);const y=a.others.getUser(h.actor);if(y)return{type:"update",updates:h.data,user:y}}function Vr(h){const y=a.others.getUser(h.actor);return y?(a.others.removeConnection(h.actor),{type:"leave",user:y}):null}function Hr(h){a.dynamicSessionInfoSig.set({actor:h.actor,nonce:h.nonce,scopes:h.scopes,meta:h.meta}),a.idFactory=Hm(h.actor),mt(),h.meta.showBrand===!0&&dm(t.badgeLocation??"bottom-right");for(const y of a.others.connectionIds())h.users[y]===void 0&&a.others.removeConnection(y);for(const y in h.users){const b=h.users[y],E=Number(y);a.others.setConnection(E,b.id,b.info,b.scopes)}return{type:"reset"}}function Rs(){return a.undoStack.length>0}function Ls(){return a.redoStack.length>0}function Gn(){w.history.notify({canUndo:Rs(),canRedo:Ls()})}function Fr(h){a.others.setConnection(h.actor,h.id,h.info,h.scopes),a.buffer.messages.push({type:xt.UPDATE_PRESENCE,data:a.myPresence.get(),targetActor:h.actor}),At();const y=a.others.getUser(h.actor);return y?{type:"enter",user:y}:void 0}function Ps(h){return Mm(h)?h:null}function jr(h){const y=ge(h);return y===void 0?null:Yl(y)?Ni(y.map(b=>Ps(b))):Ni([Ps(y)])}function Ns(h){if(h.size===0)return;const y=[],b=Array.from(h.values()),E=yt(b);y.push({type:xt.UPDATE_STORAGE,ops:E.opsToEmit}),F(E.updates),$(y)}function Us(h){if(typeof h.data!="string")return;const y=jr(h.data);if(y===null||y.length===0)return;const b={storageUpdates:new Map,others:[]};for(const E of y)switch(E.type){case rt.USER_JOINED:{const j=Fr(E);j&&b.others.push(j);break}case rt.UPDATE_PRESENCE:{const j=xs(E);j&&b.others.push(j);break}case rt.BROADCASTED_EVENT:{const j=a.others.get();w.customEvent.notify({connectionId:E.actor,user:E.actor<0?null:j.find(G=>G.connectionId===E.actor)??null,event:E.event});break}case rt.USER_LEFT:{const j=Vr(E);j&&b.others.push(j);break}case rt.UPDATE_YDOC:{w.ydoc.notify(E);break}case rt.ROOM_STATE:{b.others.push(Hr(E));break}case rt.STORAGE_STATE:{St(E);break}case rt.UPDATE_STORAGE:{const j=Ft(E.ops);for(const[G,wt]of j.updates.storageUpdates)b.storageUpdates.set(G,pi(b.storageUpdates.get(G),wt));break}case rt.REJECT_STORAGE_OP:{Pl("Storage mutation rejection error",E.reason);break}case rt.THREAD_CREATED:case rt.THREAD_DELETED:case rt.THREAD_METADATA_UPDATED:case rt.THREAD_UPDATED:case rt.COMMENT_REACTION_ADDED:case rt.COMMENT_REACTION_REMOVED:case rt.COMMENT_CREATED:case rt.COMMENT_EDITED:case rt.COMMENT_DELETED:case rt.COMMENT_METADATA_UPDATED:{w.comments.notify(E);break}}F(b)}function At(){const h=a.buffer.storageOperations;if(h.length>0){for(const E of h)a.unacknowledgedOps.set(E.opId,E);Bs()}if(u.getStatus()!=="connected"){a.buffer.storageOperations=[];return}const y=Date.now(),b=y-a.buffer.lastFlushedAt;if(b>=t.throttleDelay){const E=Kr();if(E.length===0)return;$(E),a.buffer={flushTimerID:void 0,lastFlushedAt:y,messages:[],storageOperations:[],presenceUpdates:null}}else clearTimeout(a.buffer.flushTimerID),a.buffer.flushTimerID=setTimeout(At,t.throttleDelay-b)}function Kr(){const h=[];a.buffer.presenceUpdates&&h.push(a.buffer.presenceUpdates.type==="full"?{type:xt.UPDATE_PRESENCE,targetActor:-1,data:a.buffer.presenceUpdates.data}:{type:xt.UPDATE_PRESENCE,data:a.buffer.presenceUpdates.data});for(const y of a.buffer.messages)h.push(y);return a.buffer.storageOperations.length>0&&h.push({type:xt.UPDATE_STORAGE,ops:a.buffer.storageOperations}),h}function p(h,y,b){const E={type:xt.UPDATE_YDOC,update:h,guid:y,v2:b};a.buffer.messages.push(E),w.ydoc.notify(E),At()}function S(h,y={shouldQueueEventIfNotReady:!1}){u.getStatus()!=="connected"&&!y.shouldQueueEventIfNotReady||(a.buffer.messages.push({type:xt.BROADCAST_EVENT,event:h}),At())}function I(h){const{storageOperations:y}=a.buffer;for(const b of h)y.push(b);At()}let T=null,ut=null;function St(h){const y=new Map(a.unacknowledgedOps);un(h),Ns(y),ut?.(),Bs(),w.storageDidLoad.notify()}async function Ie(){if(!u.authValue)return;const h=await i.streamStorage({roomId:n});St({type:rt.STORAGE_STATE,items:h})}function jt(h){const y=a.buffer.messages;t.unstable_streamData?Ie():y.some(b=>b.type===xt.FETCH_STORAGE)||y.push({type:xt.FETCH_STORAGE}),h.flush&&At()}function Kt(){return T===null&&(jt({flush:!0}),T=new Promise(h=>{ut=h}),Bs()),T}function ce(){const h=a.root;return h!==void 0?h:(Kt(),null)}async function st(){return a.root!==void 0?Promise.resolve({root:a.root}):(await Kt(),{root:V(a.root)})}function $t(h,y,b){a.buffer.messages.find(E=>E.type===xt.FETCH_YDOC&&E.vector===h&&E.guid===y&&E.v2===b)||a.buffer.messages.push({type:xt.FETCH_YDOC,vector:h,guid:y,v2:b}),At()}function ae(){if(a.activeBatch)throw new Error("undo is not allowed during a batch");const h=a.undoStack.pop();if(h===void 0)return;a.pausedHistory=null;const y=yt(h);F(y.updates),a.redoStack.push(y.reverse),Gn();for(const b of y.opsToEmit)a.buffer.storageOperations.push(b);At()}function zt(){if(a.activeBatch)throw new Error("redo is not allowed during a batch");const h=a.redoStack.pop();if(h===void 0)return;a.pausedHistory=null;const y=yt(h);F(y.updates),a.undoStack.push(y.reverse),Gn();for(const b of y.opsToEmit)a.buffer.storageOperations.push(b);At()}function Ms(){a.undoStack.length=0,a.redoStack.length=0}function zr(h){if(a.activeBatch)return h();let y;a.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:new gi};try{y=h()}finally{const b=a.activeBatch;a.activeBatch=null,b.reverseOps.length>0&&A(Array.from(b.reverseOps)),b.ops.length>0&&(a.redoStack.length=0),b.ops.length>0&&I(b.ops),F(b.updates),At()}return y}function Yn(){a.pausedHistory===null&&(a.pausedHistory=new gi)}function hn(){const h=a.pausedHistory;a.pausedHistory=null,h!==null&&h.length>0&&He(Array.from(h))}const $s=t.createSyncSource();function fn(){return a.root===void 0?T===null?"not-loaded":"loading":a.unacknowledgedOps.size===0?"synchronized":"synchronizing"}let Vo=fn();function Bs(){const h=fn();Vo!==h&&(Vo=h,w.storageStatus.notify(h)),$s.setSyncStatus(h==="synchronizing"?"synchronizing":"synchronized")}function Ho(){return z.get()!==null}async function wu(){for(;!Ho();){const{promise:h,resolve:y}=Do(),b=Vs.self.subscribeOnce(y),E=Vs.status.subscribeOnce(y);await h,b(),E()}}function Fo(){return ce()!==null}async function bu(){for(;!Fo();)await st()}const _u=me.from(a.others.signal,h=>h.map((y,b)=>zc(`Other ${b}`,y))),Vs={status:w.status.observable,lostConnection:w.lostConnection.observable,customEvent:w.customEvent.observable,others:w.others.observable,self:w.self.observable,myPresence:w.myPresence.observable,storageBatch:w.storageBatch.observable,history:w.history.observable,storageDidLoad:w.storageDidLoad.observable,storageStatus:w.storageStatus.observable,ydoc:w.ydoc.observable,comments:w.comments.observable,roomWillDestroy:w.roomWillDestroy.observable};async function Su(h){return i.getThreadsSince({roomId:n,since:h.since,signal:h.signal})}async function Eu(h){return i.getThreads({roomId:n,query:h?.query,cursor:h?.cursor})}async function vu(h){return i.getThread({roomId:n,threadId:h})}async function Cu(h){return i.createThread({roomId:n,threadId:h.threadId,commentId:h.commentId,metadata:h.metadata,body:h.body,commentMetadata:h.commentMetadata,attachmentIds:h.attachmentIds})}async function ku(h){return i.deleteThread({roomId:n,threadId:h})}async function Iu({metadata:h,threadId:y}){return i.editThreadMetadata({roomId:n,threadId:y,metadata:h})}async function Au({threadId:h,commentId:y,metadata:b}){return i.editCommentMetadata({roomId:n,threadId:h,commentId:y,metadata:b})}async function Tu(h){return i.markThreadAsResolved({roomId:n,threadId:h})}async function Ou(h){return i.markThreadAsUnresolved({roomId:n,threadId:h})}async function Du(h){return i.subscribeToThread({roomId:n,threadId:h})}async function xu(h){return i.unsubscribeFromThread({roomId:n,threadId:h})}async function Ru(h){return i.createComment({roomId:n,threadId:h.threadId,commentId:h.commentId,body:h.body,metadata:h.metadata,attachmentIds:h.attachmentIds})}async function Lu(h){return i.editComment({roomId:n,threadId:h.threadId,commentId:h.commentId,body:h.body,metadata:h.metadata,attachmentIds:h.attachmentIds})}async function Pu({threadId:h,commentId:y}){return i.deleteComment({roomId:n,threadId:h,commentId:y})}async function Nu({threadId:h,commentId:y,emoji:b}){return i.addReaction({roomId:n,threadId:h,commentId:y,emoji:b})}async function Uu({threadId:h,commentId:y,emoji:b}){return await i.removeReaction({roomId:n,threadId:h,commentId:y,emoji:b})}function Mu(h){return{type:"localAttachment",status:"idle",id:mg(),name:h.name,size:h.size,mimeType:h.type,file:h}}async function $u(h,y={}){return i.uploadAttachment({roomId:n,attachment:h,signal:y.signal})}function Bu(h){return i.getAttachmentUrl({roomId:n,attachmentId:h})}function jo(h){return i.getSubscriptionSettings({roomId:n,signal:h?.signal})}function Ko(h){return i.updateSubscriptionSettings({roomId:n,settings:h})}async function Vu(h){await i.markRoomInboxNotificationAsRead({roomId:n,inboxNotificationId:h})}const zo=t.createSyncSource();function qr(h){return zo.setSyncStatus(h==="synchronizing"||h==="loading"?"synchronizing":"synchronized")}return Object.defineProperty({[sn]:{get presenceBuffer(){return Es(a.buffer.presenceUpdates?.data??null)},get undoStack(){return Es(a.undoStack)},get nodeCount(){return a.pool.nodes.size},getYjsProvider(){return a.yjsProvider},setYjsProvider(h){a.yjsProvider?.off("status",qr),a.yjsProvider=h,h?.on("status",qr),a.yjsProviderDidChange.notify()},yjsProviderDidChange:a.yjsProviderDidChange.observable,reportTextEditor:R,createTextMention:k,deleteTextMention:x,listTextVersions:q,listTextVersionsSince:et,getTextVersion:Q,createTextVersion:W,executeContextualPrompt:ot,getSelf_forDevTools:()=>Mt.get(),getOthers_forDevTools:()=>_u.get(),simulate:{explicitClose:h=>u._privateSendMachineEvent({type:"EXPLICIT_SOCKET_CLOSE",event:h}),rawSend:h=>u.send(h)},attachmentUrlsStore:i.getOrCreateAttachmentUrlsStore(n)},id:n,subscribe:Km(n,Vs,t.errorEventSource),connect:()=>u.connect(),reconnect:()=>u.reconnect(),disconnect:()=>u.disconnect(),destroy:()=>{const{roomWillDestroy:h,...y}=w;for(const b of Object.values(y))b.dispose();w.roomWillDestroy.notify(),a.yjsProvider?.off("status",qr),$s.destroy(),zo.destroy(),c(),u.destroy(),h.dispose()},updatePresence:dn,updateYDoc:p,broadcastEvent:S,batch:zr,history:{undo:ae,redo:zt,canUndo:Rs,canRedo:Ls,clear:Ms,pause:Yn,resume:hn},fetchYDoc:$t,getStorage:st,getStorageSnapshot:ce,getStorageStatus:fn,isPresenceReady:Ho,isStorageReady:Fo,waitUntilPresenceReady:vc(wu),waitUntilStorageReady:vc(bu),events:Vs,getStatus:()=>u.getStatus(),getSelf:()=>z.get(),getPresence:()=>a.myPresence.get(),getOthers:()=>a.others.get(),getThreads:Eu,getThreadsSince:Su,getThread:vu,createThread:Cu,deleteThread:ku,editThreadMetadata:Iu,markThreadAsResolved:Tu,markThreadAsUnresolved:Ou,subscribeToThread:Du,unsubscribeFromThread:xu,createComment:Ru,editComment:Lu,editCommentMetadata:Au,deleteComment:Pu,addReaction:Nu,removeReaction:Uu,prepareAttachment:Mu,uploadAttachment:$u,getAttachmentUrl:Bu,getNotificationSettings:jo,getSubscriptionSettings:jo,updateNotificationSettings:Ko,updateSubscriptionSettings:Ko,markInboxNotificationAsRead:Vu},sn,{enumerable:!1})}function Km(e,t,n){function s(o,c){return t.storageBatch.subscribe(l=>{const u=l.filter(a=>ql(a.node,o));u.length>0&&c(u)})}function r(o,c){return t.storageBatch.subscribe(l=>{for(const u of l)u.node._id===o._id&&c(u.node)})}function i(o,c,l){if(typeof o=="string"&&zm(o)){if(typeof c!="function")throw new Error("Second argument must be a callback function");const u=c;switch(o){case"event":return t.customEvent.subscribe(u);case"my-presence":return t.myPresence.subscribe(u);case"others":{const a=u;return t.others.subscribe(d=>{const{others:f,...g}=d;return a(f,g)})}case"error":return n.subscribe(a=>{if(a.roomId===e)return u(a)});case"status":return t.status.subscribe(u);case"lost-connection":return t.lostConnection.subscribe(u);case"history":return t.history.subscribe(u);case"storage-status":return t.storageStatus.subscribe(u);case"comments":return t.comments.subscribe(u);default:return Et(o,`"${String(o)}" is not a valid event name`)}}if(c===void 0||typeof o=="function")if(typeof o=="function"){const u=o;return t.storageBatch.subscribe(u)}else throw new Error("Please specify a listener callback");if(ct(o)){const u=o;return l?.isDeep?s(u,c):r(u,c)}throw new Error(`${String(o)} is not a value that can be subscribed to.`)}return i}function zm(e){return e==="my-presence"||e==="others"||e==="event"||e==="error"||e==="history"||e==="status"||e==="storage-status"||e==="lost-connection"||e==="connection"||e==="comments"}function qm(e,t){return async()=>t.getAuthValue({requestedScope:"room:read",roomId:e})}function Wm(e,t,n,s){return r=>{const i=n??(typeof WebSocket>"u"?void 0:WebSocket);if(i===void 0)throw new we("To use Liveblocks client in a non-DOM environment, you need to provide a WebSocket polyfill.");const o=new URL(t);if(o.protocol=o.protocol==="http:"?"ws":"wss",o.pathname="/v7",o.searchParams.set("roomId",e),r.type==="secret")o.searchParams.set("tok",r.token.raw);else if(r.type==="public")o.searchParams.set("pubkey",r.publicApiKey);else return Et(r,"Unhandled case");return o.searchParams.set("version",Ur),s!==void 0&&o.searchParams.set("e",String(s)),new i(o.toString())}}var Gm=16,Ym=1e3,Jm=100,Zm=15e3,Xm=200,Qm=1e3,t0=3e4,e0=5e3,n0=50,s0=50,r0=50;function i0(e){return typeof e=="string"&&e.startsWith("http")?e:lm}function c1(e){const t=e,n=o0(t.throttle??Jm),s=c0(t.lostConnectionTimeout??e0),r=qc(t.backgroundKeepAliveTimeout),i=i0(t.baseUrl),o=new Nt(void 0),c=om(e,A=>{o.set(()=>A.uid)}),l=t.polyfills?.fetch||globalThis.fetch?.bind(globalThis),u=Sg({baseUrl:i,fetchPolyfill:l,currentUserId:o,authManager:c}),a=new Map,d=tm({userId:o.get(),lostConnectionTimeout:s,backgroundKeepAliveTimeout:qc(t.backgroundKeepAliveTimeout),polyfills:t.polyfills,delegates:{createSocket:em(i,t.polyfills?.WebSocket),authenticate:async()=>{const A=await c.getAuthValue({requestedScope:"room:read"});if(A.type==="public")throw new we("Cannot use AI Copilots with a public API key");return A},canZombie:()=>!1}});function f(A){A.id,a.delete(A.id),A.destroy()}function g(A){const F=()=>{const nt=F;A.unsubs.delete(nt)?A.unsubs.size===0&&f(A.room):_t("This leave function was already called. Calling it more than once has no effect.")};return A.unsubs.add(F),{room:A.room,leave:F}}function m(A,...F){const nt=a.get(A);if(nt!==void 0)return g(nt);const yt=F[0]??{},Ft=(typeof yt.initialPresence=="function"?yt.initialPresence(A):yt.initialPresence)??{},Qt=(typeof yt.initialStorage=="function"?yt.initialStorage(A):yt.initialStorage)??{},Fe=jm({initialPresence:Ft,initialStorage:Qt},{roomId:A,throttleDelay:n,lostConnectionTimeout:s,backgroundKeepAliveTimeout:r,polyfills:t.polyfills,delegates:t.mockedDelegates??{createSocket:Wm(A,i,t.polyfills?.WebSocket,yt.engine),authenticate:qm(A,c)},enableDebugLogging:t.enableDebugLogging,baseUrl:i,errorEventSource:z,largeMessageStrategy:t.largeMessageStrategy,unstable_streamData:!!t.unstable_streamData,roomHttpClient:u,createSyncSource:Mt,badgeLocation:t.badgeLocation??"bottom-right"}),dn={room:Fe,unsubs:new Set};if(a.set(A,dn),yt.autoConnect??!0){if(typeof atob>"u"){if(t.polyfills?.atob===void 0)throw new Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");global.atob=t.polyfills.atob}Fe.connect()}return g(dn)}function _(A){const F=a.get(A)?.room;return F||null}function N(){c.reset(),o.set(()=>{});for(const{room:A}of a.values())Og(A.getStatus())||A.reconnect()}const P=t.resolveUsers,v=new Le(async A=>{const F=A.flat(),nt=await P?.({userIds:F});return hi(!P,"Set the resolveUsers option in createClient to specify user info."),nt??F.map(()=>{})},{delay:n0}),U=Tn(v);function w(A){U.invalidate(A)}const k=t.resolveRoomsInfo,x=new Le(async A=>{const F=A.flat(),nt=await k?.({roomIds:F});return hi(!k,"Set the resolveRoomsInfo option in createClient to specify room info."),nt??F.map(()=>{})},{delay:s0}),R=Tn(x);function q(A){R.invalidate(A)}const et=t.resolveGroupsInfo,Q=new Le(async A=>{const F=A.flat(),nt=await et?.({groupIds:F});return hi(!et,"Set the resolveGroupsInfo option in createClient to specify group info."),nt??F.map(()=>{})},{delay:r0}),W=Tn(Q);function ot(A){W.invalidate(A)}const O=new Map;function C(){O.clear()}const K=[],$=new Nt("synchronized"),z=Y();function lt(){const A=$.get();return A==="synchronizing"?A:"synchronized"}function mt(){$.set(K.some(A=>A.get()==="synchronizing")?"synchronizing":K.some(A=>A.get()==="has-local-changes")?"has-local-changes":"synchronized")}function Mt(){const A=new Nt("synchronized");K.push(A);const F=A.subscribe(()=>mt());function nt(Ft){A.set(Ft)}function yt(){F();const Ft=K.findIndex(Qt=>Qt===A);if(Ft>-1){const[Qt]=K.splice(Ft,1);Qt.get()!=="synchronized"&&mt()}}return{setSyncStatus:nt,destroy:yt}}{const A=nt=>{t.preventUnsavedChanges&&$.get()!=="synchronized"&&nt.preventDefault()};(typeof window<"u"?window:void 0)?.addEventListener("beforeunload",A)}async function un(A){const F=await u.getNotificationSettings(A);return Hc(F)}async function Wn(A){const F=await u.updateNotificationSettings(A);return Hc(F)}const He=Object.defineProperty({enterRoom:m,getRoom:_,logout:N,getInboxNotifications:u.getInboxNotifications,getInboxNotificationsSince:u.getInboxNotificationsSince,getUnreadInboxNotificationsCount:u.getUnreadInboxNotificationsCount,markAllInboxNotificationsAsRead:u.markAllInboxNotificationsAsRead,markInboxNotificationAsRead:u.markInboxNotificationAsRead,deleteAllInboxNotifications:u.deleteAllInboxNotifications,deleteInboxNotification:u.deleteInboxNotification,getNotificationSettings:un,updateNotificationSettings:Wn,resolvers:{invalidateUsers:w,invalidateRoomsInfo:q,invalidateGroupsInfo:ot,invalidateMentionSuggestions:C},getSyncStatus:lt,events:{error:z,syncStatus:$},[sn]:{currentUserId:o,mentionSuggestionsCache:O,ai:d,resolveMentionSuggestions:t.resolveMentionSuggestions,usersStore:U,roomsInfoStore:R,groupsInfoStore:W,getRoomIds(){return Array.from(a.keys())},httpClient:u,as:()=>He,createSyncSource:Mt,emitError:(A,F)=>{const nt=zi.from(A,F);z.notify(nt)||Ee(nt.message)}}},sn,{enumerable:!1});return He}function No(e,t,n,s,r){if(typeof t!="number"||t<n||s!==void 0&&t>s)throw new Error(s!==void 0?`${e} should be between ${r??n} and ${s}.`:`${e} should be at least ${r??n}.`);return t}function qc(e){if(e!==void 0)return No("backgroundKeepAliveTimeout",e,Zm)}function o0(e){return No("throttle",e,Gm,Ym)}function c0(e){return No("lostConnectionTimeout",e,Xm,t0,Qm)}var a0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};new RegExp(Object.keys(a0).map(e=>`\\${e}`).join("|"),"g");var l0={_:"\\_","*":"\\*","#":"\\#","`":"\\`","~":"\\~","!":"\\!","|":"\\|","(":"\\(",")":"\\)","{":"\\{","}":"\\}","[":"\\[","]":"\\]"};new RegExp(Object.keys(l0).map(e=>`\\${e}`).join("|"),"g");Ao(Hp,Ur,Fp);var u0="@liveblocks/client",d0="3.13.4",h0="esm";Ao(u0,d0,h0);const Zl="3.7.8",f0=Zl,qn=typeof Buffer=="function",Wc=typeof TextDecoder=="function"?new TextDecoder:void 0,Gc=typeof TextEncoder=="function"?new TextEncoder:void 0,p0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ts=Array.prototype.slice.call(p0),Js=(e=>{let t={};return e.forEach((n,s)=>t[n]=s),t})(ts),g0=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,bt=String.fromCharCode.bind(String),Yc=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),Xl=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),Ql=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),tu=e=>{let t,n,s,r,i="";const o=e.length%3;for(let c=0;c<e.length;){if((n=e.charCodeAt(c++))>255||(s=e.charCodeAt(c++))>255||(r=e.charCodeAt(c++))>255)throw new TypeError("invalid character found");t=n<<16|s<<8|r,i+=ts[t>>18&63]+ts[t>>12&63]+ts[t>>6&63]+ts[t&63]}return o?i.slice(0,o-3)+"===".substring(o):i},Uo=typeof btoa=="function"?e=>btoa(e):qn?e=>Buffer.from(e,"binary").toString("base64"):tu,qi=qn?e=>Buffer.from(e).toString("base64"):e=>{let n=[];for(let s=0,r=e.length;s<r;s+=4096)n.push(bt.apply(null,e.subarray(s,s+4096)));return Uo(n.join(""))},sr=(e,t=!1)=>t?Xl(qi(e)):qi(e),m0=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?bt(192|t>>>6)+bt(128|t&63):bt(224|t>>>12&15)+bt(128|t>>>6&63)+bt(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return bt(240|t>>>18&7)+bt(128|t>>>12&63)+bt(128|t>>>6&63)+bt(128|t&63)}},y0=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,eu=e=>e.replace(y0,m0),Jc=qn?e=>Buffer.from(e,"utf8").toString("base64"):Gc?e=>qi(Gc.encode(e)):e=>Uo(eu(e)),Dn=(e,t=!1)=>t?Xl(Jc(e)):Jc(e),Zc=e=>Dn(e,!0),w0=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,b0=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return bt((n>>>10)+55296)+bt((n&1023)+56320);case 3:return bt((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return bt((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},nu=e=>e.replace(w0,b0),su=e=>{if(e=e.replace(/\s+/g,""),!g0.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,n,s,r=[];for(let i=0;i<e.length;)t=Js[e.charAt(i++)]<<18|Js[e.charAt(i++)]<<12|(n=Js[e.charAt(i++)])<<6|(s=Js[e.charAt(i++)]),n===64?r.push(bt(t>>16&255)):s===64?r.push(bt(t>>16&255,t>>8&255)):r.push(bt(t>>16&255,t>>8&255,t&255));return r.join("")},Mo=typeof atob=="function"?e=>atob(Ql(e)):qn?e=>Buffer.from(e,"base64").toString("binary"):su,ru=qn?e=>Yc(Buffer.from(e,"base64")):e=>Yc(Mo(e).split("").map(t=>t.charCodeAt(0))),iu=e=>ru(ou(e)),_0=qn?e=>Buffer.from(e,"base64").toString("utf8"):Wc?e=>Wc.decode(ru(e)):e=>nu(Mo(e)),ou=e=>Ql(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),Wi=e=>_0(ou(e)),S0=e=>{if(typeof e!="string")return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},cu=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),au=function(){const e=(t,n)=>Object.defineProperty(String.prototype,t,cu(n));e("fromBase64",function(){return Wi(this)}),e("toBase64",function(t){return Dn(this,t)}),e("toBase64URI",function(){return Dn(this,!0)}),e("toBase64URL",function(){return Dn(this,!0)}),e("toUint8Array",function(){return iu(this)})},lu=function(){const e=(t,n)=>Object.defineProperty(Uint8Array.prototype,t,cu(n));e("toBase64",function(t){return sr(this,t)}),e("toBase64URI",function(){return sr(this,!0)}),e("toBase64URL",function(){return sr(this,!0)})},E0=()=>{au(),lu()},Cn={version:Zl,VERSION:f0,atob:Mo,atobPolyfill:su,btoa:Uo,btoaPolyfill:tu,fromBase64:Wi,toBase64:Dn,encode:Dn,encodeURI:Zc,encodeURL:Zc,utob:eu,btou:nu,decode:Wi,isValid:S0,fromUint8Array:sr,toUint8Array:iu,extendString:au,extendUint8Array:lu,extendBuiltins:E0},ln=e=>Ln((t,n)=>{e.onerror=s=>n(new Error(s.target.error)),e.onsuccess=s=>t(s.target.result)}),v0=(e,t)=>Ln((n,s)=>{const r=indexedDB.open(e);r.onupgradeneeded=i=>t(i.target.result),r.onerror=i=>s(Zt(i.target.error)),r.onsuccess=i=>{const o=i.target.result;o.onversionchange=()=>{o.close()},n(o)}}),C0=e=>ln(indexedDB.deleteDatabase(e)),k0=(e,t)=>t.forEach(n=>e.createObjectStore.apply(e,n)),es=(e,t,n="readwrite")=>{const s=e.transaction(t,n);return t.map(r=>L0(s,r))},uu=(e,t)=>ln(e.count(t)),I0=(e,t)=>ln(e.get(t)),du=(e,t)=>ln(e.delete(t)),A0=(e,t,n)=>ln(e.put(t,n)),Gi=(e,t)=>ln(e.add(t)),T0=(e,t,n)=>ln(e.getAll(t,n)),O0=(e,t,n)=>{let s=null;return R0(e,t,r=>(s=r,!1),n).then(()=>s)},D0=(e,t=null)=>O0(e,t,"prev"),x0=(e,t)=>Ln((n,s)=>{e.onerror=s,e.onsuccess=async r=>{const i=r.target.result;if(i===null||await t(i)===!1)return n();i.continue()}}),R0=(e,t,n,s="next")=>x0(e.openKeyCursor(t,s),r=>n(r.key)),L0=(e,t)=>e.objectStore(t),P0=(e,t)=>IDBKeyRange.upperBound(e,t),N0=(e,t)=>IDBKeyRange.lowerBound(e,t),mi="custom",hu="updates",fu=500,pu=(e,t=()=>{},n=()=>{})=>{const[s]=es(e.db,[hu]);return T0(s,N0(e._dbref,!1)).then(r=>{e._destroyed||(t(s),J(e.doc,()=>{r.forEach(i=>Va(e.doc,i))},e,!1),n(s))}).then(()=>D0(s).then(r=>{e._dbref=r+1})).then(()=>uu(s).then(r=>{e._dbsize=r})).then(()=>s)},U0=(e,t=!0)=>pu(e).then(n=>{(t||e._dbsize>=fu)&&Gi(n,po(e.doc)).then(()=>du(n,P0(e._dbref,!0))).then(()=>uu(n).then(s=>{e._dbsize=s}))});class gu extends Wu{constructor(t,n){super(),this.doc=n,this.name=t,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=v0(t,s=>k0(s,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Ln(s=>this.on("synced",()=>s(this))),this._db.then(s=>{this.db=s,pu(this,o=>Gi(o,po(n)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(s,r)=>{if(this.db&&r!==this){const[i]=es(this.db,[hu]);Gi(i,s),++this._dbsize>=fu&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{U0(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},n.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{C0(this.name)})}get(t){return this._db.then(n=>{const[s]=es(n,[mi],"readonly");return I0(s,t)})}set(t,n){return this._db.then(s=>{const[r]=es(s,[mi]);return A0(r,n,t)})}del(t){return this._db.then(n=>{const[s]=es(n,[mi]);return du(s,t)})}}function M0(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function $o(e,...t){if(!M0(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Xc(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function $0(e,t){$o(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Yi(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function yi(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function ee(e,t){return e<<32-t|e>>>t}function B0(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function mu(e){return typeof e=="string"&&(e=B0(e)),$o(e),e}class V0{}function H0(e){const t=s=>e().update(mu(s)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function F0(e,t,n,s){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,s);const r=BigInt(32),i=BigInt(4294967295),o=Number(n>>r&i),c=Number(n&i),l=s?4:0,u=s?0:4;e.setUint32(t+l,o,s),e.setUint32(t+u,c,s)}function j0(e,t,n){return e&t^~e&n}function K0(e,t,n){return e&t^e&n^t&n}class z0 extends V0{constructor(t,n,s,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=r,this.buffer=new Uint8Array(t),this.view=yi(this.buffer)}update(t){Xc(this),t=mu(t),$o(t);const{view:n,buffer:s,blockLen:r}=this,i=t.length;for(let o=0;o<i;){const c=Math.min(r-this.pos,i-o);if(c===r){const l=yi(t);for(;r<=i-o;o+=r)this.process(l,o);continue}s.set(t.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===r&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Xc(this),$0(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:r,isLE:i}=this;let{pos:o}=this;n[o++]=128,Yi(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(s,0),o=0);for(let d=o;d<r;d++)n[d]=0;F0(s,r-8,BigInt(this.length*8),i),this.process(s,0);const c=yi(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,a=this.get();if(u>a.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)c.setUint32(4*d,a[d],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:r,finished:i,destroyed:o,pos:c}=this;return t.destroyed=o,t.finished=i,t.length=r,t.pos=c,r%n&&t.buffer.set(s),t}clone(){return this._cloneInto()}}const De=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),q0=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xe=new Uint32Array(64);class W0 extends z0{constructor(t=32){super(64,t,8,!1),this.A=De[0]|0,this.B=De[1]|0,this.C=De[2]|0,this.D=De[3]|0,this.E=De[4]|0,this.F=De[5]|0,this.G=De[6]|0,this.H=De[7]|0}get(){const{A:t,B:n,C:s,D:r,E:i,F:o,G:c,H:l}=this;return[t,n,s,r,i,o,c,l]}set(t,n,s,r,i,o,c,l){this.A=t|0,this.B=n|0,this.C=s|0,this.D=r|0,this.E=i|0,this.F=o|0,this.G=c|0,this.H=l|0}process(t,n){for(let d=0;d<16;d++,n+=4)xe[d]=t.getUint32(n,!1);for(let d=16;d<64;d++){const f=xe[d-15],g=xe[d-2],m=ee(f,7)^ee(f,18)^f>>>3,_=ee(g,17)^ee(g,19)^g>>>10;xe[d]=_+xe[d-7]+m+xe[d-16]|0}let{A:s,B:r,C:i,D:o,E:c,F:l,G:u,H:a}=this;for(let d=0;d<64;d++){const f=ee(c,6)^ee(c,11)^ee(c,25),g=a+f+j0(c,l,u)+q0[d]+xe[d]|0,_=(ee(s,2)^ee(s,13)^ee(s,22))+K0(s,r,i)|0;a=u,u=l,l=c,c=o+g|0,o=i,i=r,r=s,s=g+_|0}s=s+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,c=c+this.E|0,l=l+this.F|0,u=u+this.G|0,a=a+this.H|0,this.set(s,r,i,o,c,l,u,a)}roundClean(){Yi(xe)}destroy(){this.set(0,0,0,0,0,0,0,0),Yi(this.buffer)}}const Qc=H0(()=>new W0);var G0="@liveblocks/yjs",Y0="3.13.4",J0="esm",wi=()=>new Map,Z0=(e,t,n)=>{let s=e.get(t);return s===void 0&&e.set(t,s=n()),s},X0=()=>new Set,Q0=Array.from,Bo=class{constructor(){this._observers=wi()}on(e,t){Z0(this._observers,e,X0).add(t)}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);n!==void 0&&(n.delete(t),n.size===0&&this._observers.delete(e))}emit(e,t){return Q0((this._observers.get(e)||wi()).values()).forEach(n=>n(...t))}destroy(){this._observers=wi()}},de="__yjs",Zs="__yjs_clientid",t1=class extends Bo{room;doc;states=new Map;actorToClientMap=new Map;meta=new Map;_checkInterval=0;othersUnsub;constructor(e,t){super(),this.doc=e,this.room=t,this.room.updatePresence({[Zs]:this.doc.clientID}),this.othersUnsub=this.room.events.others.subscribe(n=>{let s;if(n.type==="leave"){const r=this.actorToClientMap.get(n.user.connectionId);r!==void 0&&(s={added:[],updated:[],removed:[r]}),this.rebuildActorToClientMap(n.others)}if(n.type==="enter"||n.type==="update"){this.rebuildActorToClientMap(n.others);const r=this.actorToClientMap.get(n.user.connectionId);r!==void 0&&(s={added:n.type==="enter"?[r]:[],updated:n.type==="update"?[r]:[],removed:[]})}n.type==="reset"&&this.rebuildActorToClientMap(n.others),s!==void 0&&(this.emit("change",[s,"presence"]),this.emit("update",[s,"presence"]))})}rebuildActorToClientMap(e){this.actorToClientMap.clear(),e.forEach(t=>{t.presence[Zs]!==void 0&&this.actorToClientMap.set(t.connectionId,t.presence[Zs])})}destroy(){this.emit("destroy",[this]),this.othersUnsub(),this.setLocalState(null),super.destroy()}getLocalState(){const e=this.room.getPresence();return Object.keys(e).length===0||typeof e[de]>"u"?null:e[de]}setLocalState(e){const t=this.room.getSelf()?.presence;if(e===null){if(t===void 0)return;this.room.updatePresence({...t,[de]:null}),this.emit("update",[{added:[],updated:[],removed:[this.doc.clientID]},"local"]);return}const n=t?.[de],s=n===void 0?[this.doc.clientID]:[],r=n===void 0?[]:[this.doc.clientID];this.room.updatePresence({[de]:{...n||{},...e||{}}}),this.emit("update",[{added:s,updated:r,removed:[]},"local"])}setLocalStateField(e,t){const n=this.room.getSelf()?.presence[de],s={[e]:t};this.room.updatePresence({[de]:{...n||{},...s}})}getStates(){const t=this.room.getOthers().reduce((s,r)=>{const i=r.presence[de],o=r.presence[Zs];return i!==void 0&&o!==void 0&&s.set(o,i||{}),s},new Map),n=this.room.getSelf()?.presence[de];return n!==void 0&&t.set(this.doc.clientID,n),t}},ta=class yu extends Bo{unsubscribers=[];_synced=!1;doc;updateRoomDoc;fetchRoomDoc;useV2Encoding;localSnapshotHash;remoteSnapshotHash;hasEverSynced;debounceTimer=null;static DEBOUNCE_INTERVAL_MS=200;isLocalAndRemoteSnapshotEqual;constructor({doc:t,isRoot:n,updateDoc:s,fetchDoc:r,useV2Encoding:i}){super(),this.doc=t,this.useV2Encoding=i,this.doc.on(i?"updateV2":"update",this.updateHandler),this.updateRoomDoc=c=>{s(c,n?void 0:this.doc.guid)},this.fetchRoomDoc=c=>{r(c,n?void 0:this.doc.guid)},this.syncDoc();const o=this.useV2Encoding?Ii(Fs(this.doc)):uc(Fs(this.doc));this.localSnapshotHash=new Nt(Cn.fromUint8Array(Qc(o))),this.remoteSnapshotHash=new Nt(null),this.hasEverSynced=new Nt(!1),this.isLocalAndRemoteSnapshotEqual=me.from(()=>{const c=this.remoteSnapshotHash.get();return!(c===null||this.localSnapshotHash.get()!==c)})}handleServerUpdate=({update:t,stateVector:n,readOnly:s,v2:r,remoteSnapshotHash:i})=>{if((r?fo:Va)(this.doc,t,"backend"),n){if(!s)try{const l=(this.useV2Encoding?Ha:po)(this.doc,Cn.toUint8Array(n));this.updateRoomDoc(l)}catch(c){console.warn(c)}this.synced=!0,this.hasEverSynced.set(!0)}this.remoteSnapshotHash.set(i)};syncDoc=()=>{this.synced=!1;const t=Cn.fromUint8Array(Wh(this.doc));this.fetchRoomDoc(t)};get synced(){return this._synced}set synced(t){this._synced!==t&&(this._synced=t,this.emit("synced",[t]),this.emit("sync",[t]))}debounced_updateLocalSnapshot(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{const t=this.useV2Encoding?Ii(Fs(this.doc)):uc(Fs(this.doc));this.localSnapshotHash.set(Cn.fromUint8Array(Qc(t))),this.debounceTimer=null},yu.DEBOUNCE_INTERVAL_MS)}updateHandler=(t,n)=>{this.debounced_updateLocalSnapshot();const s=n instanceof gu;n!=="backend"&&!s&&this.updateRoomDoc(t)};experimental_getSyncStatus(){return this.hasEverSynced.get()?this.isLocalAndRemoteSnapshotEqual.get()?"synchronized":"synchronizing":"loading"}destroy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.doc.off("update",this.updateHandler),this.unsubscribers.forEach(t=>t()),this._observers=new Map,this.doc.destroy()}},e1=class extends Bo{room;rootDoc;options;indexeddbProvider=null;isPaused=!1;unsubscribers=[];awareness;rootDocHandler;subdocHandlers=new Bn(new Map);syncStatus;permanentUserData;constructor(e,t,n={}){super(),this.rootDoc=t,this.room=e,this.options=n,this.rootDocHandler=new ta({doc:t,isRoot:!0,updateDoc:this.updateDoc,fetchDoc:this.fetchDoc,useV2Encoding:this.options.useV2Encoding_experimental??!1}),this.options.enablePermanentUserData&&(this.permanentUserData=new Yh(t)),e[sn].setYjsProvider(this),this.awareness=new t1(this.rootDoc,this.room),this.unsubscribers.push(this.room.events.status.subscribe(s=>{s==="connected"?this.rootDocHandler.syncDoc():this.rootDocHandler.synced=!1})),this.unsubscribers.push(this.room.events.ydoc.subscribe(s=>{const{type:r}=s;if(r===xt.UPDATE_YDOC)return;const{stateVector:i,update:o,guid:c,v2:l,remoteSnapshotHash:u}=s,a=this.room.getSelf()?.canWrite??!0,d=Cn.toUint8Array(o);c!==void 0?this.subdocHandlers.get().get(c)?.handleServerUpdate({update:d,stateVector:i,readOnly:!a,v2:l,remoteSnapshotHash:u}):this.rootDocHandler.handleServerUpdate({update:d,stateVector:i,readOnly:!a,v2:l,remoteSnapshotHash:u})})),n.offlineSupport_experimental&&this.setupOfflineSupport(),this.rootDocHandler.on("synced",()=>{const s=this.rootDocHandler.synced;for(const[r,i]of this.subdocHandlers.get())i.syncDoc();this.emit("synced",[s]),this.emit("sync",[s])}),this.rootDoc.on("subdocs",this.handleSubdocs),this.syncDoc(),this.syncStatus=me.from(()=>{const s=this.rootDocHandler.experimental_getSyncStatus();return s==="loading"||s==="synchronizing"?s:Array.from(this.subdocHandlers.get().values()).map(i=>i.experimental_getSyncStatus()).some(i=>i!=="synchronized")?"synchronizing":"synchronized"}),this.emit("status",[this.getStatus()]),this.unsubscribers.push(this.syncStatus.subscribe(()=>{this.emit("status",[this.getStatus()])}))}setupOfflineSupport=()=>{this.indexeddbProvider=new gu(this.room.id,this.rootDoc);const e=()=>{this.rootDocHandler.synced=!0};this.indexeddbProvider.on("synced",e),this.unsubscribers.push(()=>{this.indexeddbProvider?.off("synced",e)})};handleSubdocs=({loaded:e,removed:t,added:n})=>{e.forEach(this.createSubdocHandler);const s=this.subdocHandlers.get();if(this.options.autoloadSubdocs)for(const r of n)s.has(r.guid)||r.load();for(const r of t)s.has(r.guid)&&(s.get(r.guid)?.destroy(),s.delete(r.guid))};updateDoc=(e,t)=>{(this.room.getSelf()?.canWrite??!0)&&!this.isPaused&&this.room.updateYDoc(Cn.fromUint8Array(e),t,this.useV2Encoding)};fetchDoc=(e,t)=>{this.room.fetchYDoc(e,t,this.useV2Encoding)};createSubdocHandler=e=>{const t=this.subdocHandlers.get();if(t.has(e.guid)){t.get(e.guid)?.syncDoc();return}const n=new ta({doc:e,isRoot:!1,updateDoc:this.updateDoc,fetchDoc:this.fetchDoc,useV2Encoding:this.options.useV2Encoding_experimental??!1});t.set(e.guid,n)};loadSubdoc=e=>{for(const t of this.rootDoc.subdocs)if(t.guid===e)return t.load(),!0;return!1};syncDoc=()=>{this.rootDocHandler.syncDoc();for(const[e,t]of this.subdocHandlers.get())t.syncDoc()};get useV2Encoding(){return this.options.useV2Encoding_experimental??!1}get synced(){return this.rootDocHandler.synced}async pause(){await this.indexeddbProvider?.destroy(),this.indexeddbProvider=null,this.isPaused=!0}unpause(){this.isPaused=!1,this.options.offlineSupport_experimental&&this.setupOfflineSupport(),this.rootDocHandler.syncDoc()}getStatus(){return this.syncStatus.get()}destroy(){this.unsubscribers.forEach(e=>e()),this.awareness.destroy(),this.rootDocHandler.destroy(),this._observers=new Map;for(const[e,t]of this.subdocHandlers.get())t.destroy();this.subdocHandlers.get().clear(),super.destroy()}async clearOfflineData(){if(this.indexeddbProvider)return this.indexeddbProvider.clearData()}getYDoc(){return this.rootDoc}disconnect(){}connect(){}get subdocHandlers(){return this.subdocHandlers.get()}set subdocHandlers(e){this.subdocHandlers.mutate(t=>{t.clear();for(const[n,s]of e)t.set(n,s)})}},bi=new WeakMap,a1=(e,t={},n=!1)=>{const s=bi.get(e);if(s!==void 0){if(!n)return s;s.destroy(),bi.delete(e)}const r=new on,i=new e1(e,r,t);return e.events.roomWillDestroy.subscribeOnce(()=>{i.destroy()}),bi.set(e,i),i};Ao(G0,Y0,J0);export{Wt as Y,i1 as a,Ct as b,c1 as c,r1 as d,a1 as g,vp as r,si as s,o1 as w};
