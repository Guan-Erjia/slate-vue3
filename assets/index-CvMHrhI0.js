import{i as w,j as x,k as R,d as $,f as D,e as _,w as T,h as m,o as v,a as c,c as N,b as y,l as q,v as M,m as O,F as B,u as F,s as E,n as V}from"./index-cO_khfoC.js";import{R as L,w as P,c as U,N as W,T as z,S as X,b as H}from"./editable-OBw7MXqz.js";import{w as G,a as I,Y as j,c as J,g as Q,b as Z}from"./index-FzwapiRn.js";import{g as ee,C as k,w as te}from"./utils-CDy_PNCt.js";import{T as oe}from"./Toolbar-DItQkW23.js";import{_ as g,a as b}from"./BlockButton.vue_vue_type_script_setup_true_lang-HG5hzToY.js";import{f as A}from"./chunk-MVUZLZE2-BVB7fs3M.js";import"./Button-Bz1s__lT.js";const K="remote-cursor-",S="remote-caret-";function re(l){return Object.entries(l).filter(([n])=>n.startsWith(K)).map(([,n])=>n)}function ae(l){return Object.entries(l).filter(([n])=>n.startsWith(S)).map(([,n])=>n)}function C(l,n,u,s){if(!s){const r=`${K}${l}`;return{...u,[r]:n}}const f=`${S}${l}`;return{...u,anchor:u.focus,[f]:n}}function ne(l,n){const u=R({}),s=new Set,f=s.add.bind(s),r=t=>{if(t.added.forEach(f),t.removed.forEach(f),t.updated.forEach(f),s.size===0)return u;s.forEach(e=>{const i=k.cursorState(l,e);if(i===null){delete u.value[e.toString()];return}u.value[e]=i}),s.clear()},p=()=>(k.on(l,"change",r),()=>k.off(l,"change",r));let h;return w(()=>{h=p()}),x(()=>{h?.()}),t=>{const[,e]=t;return e.length!==1?[]:Object.entries(u.value).flatMap(([i,a])=>{const o=ee(l,a);return o?L.isCollapsed(o)?C(i,a,o,!0):[C(i,a,o,!1),C(i,a,o,!0)]:[]})}}const se=$({__name:"YjsEditor",props:{sharedType:{},provider:{}},setup(l){const n=[{type:"paragraph",children:[{text:""}]}],u=({attributes:t,children:e,element:i})=>{const a={...t,style:{"text-align":"align"in i?i.align||"left":""}};switch(i.type){case"block-quote":return m("blockquote",a,e);case"bulleted-list":return m("ul",a,e);case"heading-one":return m("h1",a,e);case"heading-two":return m("h2",a,e);case"heading-three":return m("h3",a,e);case"list-item":return m("li",a,e);case"numbered-list":return m("ol",a,e);default:return m("p",a,e)}},s=({leaf:t,attributes:e,children:i})=>{let a=i,o={};return"bold"in t&&(o.fontWeight="bold"),"italic"in t&&(o.fontStyle="italic"),"underline"in t&&(o.borderBottom="1px solid black"),"delete"in t&&(o.textDecoration="line-through"),re(t).forEach(d=>{d.data&&(o.backgroundColor="rgba(255, 0, 0, 0.5)",e.contenteditable=!1,e.unselectable="on")}),ae(t).forEach(d=>{d.data&&(o={position:"absolute",fontWeight:"normal"},a=[m("span",{contenteditable:!1,className:"cursor"}),m("span",{contenteditable:!1,className:"label"},[d.data.name]),i])}),m("code"in t?"code":"bold"in t?"strong":"span",{...e,style:o},a)},f=l,r=te(G(I(P(U()),f.sharedType)),f.provider.awareness,{data:{name:`${A.person.firstName()} ${A.person.lastName()}`}});r.children=n;const{normalizeNode:p}=r;r.normalizeNode=t=>{const[e]=t;if(W.isElement(e)&&e.children.length>0)return p(t);z.insertNodes(r,n[0],{at:[0]})},w(()=>{j.connect(r)}),x(()=>{j.disconnect(r)});const h=ne(r);return(t,e)=>(v(),D(_(X),{editor:_(r),"render-element":u,"render-leaf":s,decorate:_(h)},{default:T(()=>[c(oe,null,{default:T(()=>[c(g,{format:"bold",icon:"format_bold"}),c(g,{format:"italic",icon:"format_italic"}),c(g,{format:"underline",icon:"format_underlined"}),c(g,{format:"code",icon:"code"}),c(b,{format:"heading-one",icon:"looks_one"}),c(b,{format:"heading-two",icon:"looks_two"}),c(b,{format:"block-quote",icon:"format_quote"}),c(b,{format:"numbered-list",icon:"format_list_numbered"}),c(b,{format:"bulleted-list",icon:"format_list_bulleted"}),c(b,{format:"left",icon:"format_align_left"}),c(b,{format:"center",icon:"format_align_center"}),c(b,{format:"right",icon:"format_align_right"}),c(b,{format:"justify",icon:"format_align_justify"})]),_:1}),c(_(H),{placeholder:"Enter some rich textâ€¦",spellcheck:""})]),_:1},8,["editor","decorate"]))}}),ie={style:{display:"flex",width:"100%"}},ce={key:1,style:{height:"300px"}},_e=$({__name:"index",setup(l){const n=F(),u=V(),s=R(n.query.publicApiKey||""),f=E(),r=E(),p=E(),h=R(!1),t=o=>h.value=o,e=()=>{try{const o=J({publicApiKey:s.value}).enterRoom("remote-decorate-cursor"),d=Q(o.room);d.on("sync",t),f.value=o,r.value=d,p.value=d.getYDoc().get("slate",Z)}catch(o){alert(o),u.push({name:"remote-decorate-cursor",query:{publicApiKey:""}})}},i=()=>{f.value?.leave(),r.value?.off("sync",t),f.value=void 0,r.value=void 0,p.value=void 0,h.value=!1,s.value=""};w(()=>{s.value&&e()}),x(()=>{i()});const a=o=>{o.key==="Enter"&&(u.push({name:"remote-decorate-cursor",query:{publicApiKey:s.value}}),e())};return(o,d)=>(v(),N(B,null,[d[1]||(d[1]=y("a",{href:"https://liveblocks.io/dashboard",style:{"margin-bottom":"12px",display:"block"},target:"_blank"}," ðŸ‘‰ Click it and get a publicApiKey from liveblocks",-1)),y("div",ie,[q(y("input",{"onUpdate:modelValue":d[0]||(d[0]=Y=>s.value=Y),onKeyup:a,placeholder:"paste your liveblocks publicApiKey, and press Enter to connect",style:{width:"100%","margin-bottom":"10px"}},null,544),[[M,s.value]])]),p.value&&h.value&&r.value?(v(),D(se,{key:0,sharedType:p.value,provider:r.value},null,8,["sharedType","provider"])):O("",!0),p.value&&!h.value?(v(),N("div",ce,"Loading...")):O("",!0)],64))}});export{_e as default};
